define(["require","exports"],function(e,t){"use strict";function n(e){if(!e)throw new Error("Missing validateAppshell config");if("number"!=typeof e.appshellVersion)throw new Error("Invalid appshellVersion");if("number"!=typeof e.appshellTimestamp)throw new Error("Invalid appshellTimestamp");var t=new XMLHttpRequest;t.open("POST","/validate_appshell");var n=window.ensemble.viewer.getActiveUser().userId.toString();t.setRequestHeader("X-Dropbox-UID",n),t.setRequestHeader("X-Dropbox-Request-Id",window.ensemble.getRequestId()),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded");var r="_subject_uid="+encodeURIComponent(n)+"&t="+encodeURIComponent(window.ensemble.getCsrfToken())+"&is_xhr=true&appshell_version="+encodeURIComponent(e.appshellVersion.toString())+"&appshell_timestamp="+encodeURIComponent(e.appshellTimestamp.toString());window.hasOwnProperty("_csp_external_script_nonce")&&(r+="&csp_external_script_nonce="+encodeURIComponent(window._csp_external_script_nonce)),t.onload=function(){if(403===t.status)return void o();if(200===t.status){JSON.parse(t.responseText).refresh&&o()}},t.send(r)}function o(){try{localStorage.clear()}catch(e){}window.caches?window.caches.keys().then(function(e){return window.Promise.all(e.map(function(e){return window.caches.delete(e)}))}).then(r).catch(r):r()}function r(){var e,t=(new Date).getTime();try{var n=sessionStorage.getItem("reload-timestamp");if(!n)throw new Error;var o=JSON.parse(n);if("number"!=typeof o)throw new Error;e=o}catch(e){return void i(t)}if(t-e>3e4)return void i(t)}function i(e){try{sessionStorage.setItem("reload-timestamp",JSON.stringify(e))}catch(e){}t.mockable.windowLocationReload()}t.validateAppshell=n;t.mockable={windowLocationReload:function(){window.location.reload(!0)}}});
//# sourceMappingURL=validate_appshell.min.js-vflLI7ekn.map