(function(){define(["external/underscore","external/react","modules/constants/comments_panel","modules/core/exception","modules/clean/comments/annotation_utils","modules/clean/comments/constants","modules/clean/comments/flux","modules/clean/comments/store","modules/clean/comments/utils","modules/clean/react/file_comments/annotation_bubble","modules/clean/react/file_comments/annotation_comments_list_ui_bubble"],function(n,t,e,o,i,a,r,s,u,c,l){var p,d,v,m,b,y;return p=e.ALLOW_VIEW_ANNOTATE_MODES,o.assert,d=a.AnnotationTypes,m=t.DOM,v=t.createClass({displayName:"FilePreviewOverlay",mixins:[t.addons.PureRenderMixin],propTypes:{previewContainer:t.PropTypes.instanceOf(HTMLElement).isRequired,activity:t.PropTypes.object,actorId:t.PropTypes.number,context:t.PropTypes.number.isRequired,useAnnotationCreationExpand:t.PropTypes.bool.isRequired,showCreateBubble:t.PropTypes.bool.isRequired,draftAnnotation:t.PropTypes.object,viewingAnnotation:t.PropTypes.object,viewingAnnotationHover:t.PropTypes.bool.isRequired,viewingCommentActivity:t.PropTypes.object,viewingAnnotationReplyDraft:t.PropTypes.string,actionCreators:t.PropTypes.object.isRequired,isDemoMode:t.PropTypes.bool},getInitialState:function(){return{isExpanded:!1}},onConversationExpand:function(){return this.setState({isExpanded:!0})},onMouseEnterAnnotationConversationBubble:function(){return this.props.actionCreators.updateAnnotationConversationHover(!0)},onMouseLeaveAnnotationConversationBubble:function(){var n;if(this.props.actionCreators.updateAnnotationConversationHover(!1),null==this.props.draftAnnotation&&!this.state.isExpanded)return n=(function(n){return function(){if(n.isMounted()&&!n.props.viewingAnnotationHover)return n.props.actionCreators.hideAnnotationConversation()}})(this),window.setTimeout(n,50)},maybeRenderAnnotationInputBubble:function(){var e,o,a,r,s,l,p,d,v,m,b,y,A,x,f,C,h;if(b=this.props,e=b.activity,o=b.actorId,r=b.context,m=b.previewContainer,l=b.draftAnnotation,p=b.draftAnnotationText,x=b.showCreateBubble,f=b.useAnnotationCreationExpand,null!=l)return a={context:r,activity:e,user:u.getActivityUser(o),shouldShowExpandBubble:f,commentText:p,position:"top",x:0,y:0,showBubble:!1,actionCreators:this.props.actionCreators,isDemoMode:this.props.isDemoMode},x&&(d=!i.isAnnotationOffscreen(l,m),d&&(y=i.getBubblePosition(l,m),s=y[0],A=y[1],C=A.x,h=A.y,v=y[2],null!=s&&null!=C&&null!=h))?(n.extend(a,{showBubble:!0,position:s,x:C,y:h,maxHeight:v}),t.createElement(c,a)):t.createElement(c,a)},maybeRenderAnnotationConversationBubble:function(){var n,e,o,a,r,s,c,p,d,v,m,b,y,A;if(c=this.props,e=c.actorId,o=c.context,n=c.activity,s=c.previewContainer,m=c.viewingAnnotationReplyDraft,b=c.viewingCommentActivity,v=c.viewingAnnotation,b&&v&&!i.isAnnotationOffscreen(v,s)&&(p=i.getBubblePosition(v,s),a=p[0],d=p[1],y=d.x,A=d.y,r=p[2],null!=a&&null!=y&&null!=A&&null!=r))return t.createElement(l,{context:o,activity:n,commentActivity:b,user:u.getActivityUser(e),position:a,replyText:m,x:y,y:A,maxHeight:r,onMouseEnter:this.onMouseEnterAnnotationConversationBubble,onMouseLeave:this.onMouseLeaveAnnotationConversationBubble,onConversationExpand:this.onConversationExpand,actionCreators:this.props.actionCreators,isDemoMode:this.props.isDemoMode})},render:function(){return m.div({},this.maybeRenderAnnotationInputBubble(),this.maybeRenderAnnotationConversationBubble())}}),y=function(n){return p&&(null!=n?n.annotation.type:void 0)===d.HIGHLIGHT},b=function(t){var e,o,i,a,r,s;return e=t.activity,a=t.viewAnnotation,o=t.createAnnotation,a&&(s=n.findWhere(e.comment_activities,{activity_key:a.activityKey}),s&&(r=t.annotationReplyTextByKey[s.activity_key])),o&&(i=o.showBubble),{activity:e,actorId:t.actorId,context:t.viewing.context,useAnnotationCreationExpand:y(o),showCreateBubble:!!i,draftAnnotation:null!=o?o.annotation:void 0,draftAnnotationText:t.annotationText,viewingAnnotation:null!=a?a.annotation:void 0,viewingAnnotationHover:!!(null!=a?a.annotationHover:void 0),viewingCommentActivity:s,viewingAnnotationReplyDraft:r}},r.connect(s,b)(v)})}).call(this);
//# sourceMappingURL=file_preview_overlay.min.js-vflqAraC2.map