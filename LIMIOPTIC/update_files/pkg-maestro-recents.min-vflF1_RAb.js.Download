(function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/comments/comment_dom",["external/react","modules/clean/referrer_cleansing_redirect"],function(t,n){var i,r,a;return i="…",r=function(i,r,o){var s,c,l,u,d,h,m,p,_,f,g,v,y,I,E,A,R,w;for(null==r&&(r=!0),null==o&&(o=null),c=t.DOM,m=/@\[(?:\s*(?:dbid:)?[^:\[\]]+):(?:[^\[]+)\]/i,h=/@\[(\s*(?:dbid:)?[^:\[\]]+):([^\[]+)\]/i,w="(?:[-a-zA-Z0-9@:%_+~#=]+[.])+[a-z]{2,6}(?:[:./?#][-a-zA-Z0-9@%_+~&=]+)*(?=[^a-zA-Z0-9_]|$)",A="http://"+w+"|https://"+w+"|www."+w+"|"+w,R=new RegExp(A,"i"),d=/\n/,v=[m,d],r&&v.push(R),y=RegExp("("+(function(){var e,t,n;for(n=[],e=0,t=v.length;e<t;e++)f=v[e],n.push(f.source);return n})().join("|")+")","gi"),_=[],g=i.split(y),l=0,u=g.length;l<u;l++)if(s=g[l])if(s.match(m))I=s.match(h),p=I[2].trim(),_.push(c.span({className:"comment-mention"},p));else if(e.call(v,R)>=0&&s.match(R)){E=s,E.indexOf("http://")<0&&E.indexOf("https://")<0&&(E="http://"+E);try{E=n.get_redirect_uri(E),_.push(c.a({href:E,target:"_blank",rel:"noopener noreferrer"},s))}catch(e){e,_.push(s)}}else s.match(d)?_.push(c.br({})):_.push(s);return a(_,o)},a=function(e,t){var n,r,a,o,s,c,l,u,d;if(null==t&&(t=null),!t)return e;if(n=0,d=[],t<=0)return e.length>0?i:e;for(r=0,o=e.length;r<o;r++)if(u=e[r],"object"==typeof u){if(null!=(null!=(s=u.props)?s.children:void 0)&&(n+=null!=(c=u.props)&&null!=(l=c.children)?l.length:void 0),d.push(u),n>=t)return d.push(i),d}else{if(n+u.length>=t)return a=t-n,d.push(u.substring(0,a)),d.push(i),d;n+=u.length,d.push(u)}return e},{convertRawCommentTextToReactDom:r}})}).call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("modules/clean/deprecated/dbmodal_loading",["modules/clean/dbmodal","modules/clean/deprecated/uirequest"],function(t,n){return(function(t){function i(e){i.__super__.constructor.call(this,e)}return e(i,t),i.prototype.on_show=function(){return this.fetch()},i.prototype.fetch=function(){return new n(this.$modal_window,this.options.endpoint_url,{data:this.options.parameters||{},subject_user:this.options.subject_user,html_in_error_msg:this.options.html_in_error_msg,error:(function(e){return function(t,n,i){return e.hide()}})(this)})},i.prototype.on_confirm_button_click=null,i.prototype.on_cancel_button_click=null,i})(t.DBModal)})}.call(this),define("modules/clean/fileops",["require","exports","tslib","jquery","modules/clean/ajax","modules/core/i18n","modules/core/notify","modules/core/uri"],function(e,t,n,i,r,a,o,s){"use strict";function c(e,t){var n=i.Deferred(),s=a.ungettext("Deleted %(file_count)s item.","Deleted %(file_count)s items.",t.length).format({file_count:t.length});return o.success(s),r.WebRequest({url:"/cmd/delete",data:{files:t},subject_user:e,success:function(e){n.resolve(e)},error:function(e){o.error(a._("Failed to perform the delete. Please try again later.")),n.reject(e)}}),n.promise()}function l(e,t,i){return void 0===i&&(i={}),i=n.__assign((r={},r._subject_uid=String(t),r),i),new s({path:"/history"+e,query:i});var r}t.do_nonbrowse_delete=c,t.build_revisions_uri=l}),function(){define("modules/clean/page_role_observer",["modules/core/exception"],function(e){var assert;return assert=e.assert,new((function(){function e(){this._listeners=[]}return e.prototype.addListener=function(e){return assert("function"==typeof e,"PageRoleState.addListener expects a function, got: "+typeof e),this._listeners.push(e)},e.prototype.removeListener=function(e){var t;return assert("function"==typeof e,"PageRoleState.removeListener expects a function, got: "+typeof e),this._listeners=function(){var n,i,r,a;for(r=this._listeners,a=[],n=0,i=r.length;n<i;n++)t=r[n],t!==e&&a.push(t);return a}.call(this)},e.prototype.removeAllListeners=function(){return this._listeners=[]},e.prototype.emit=function(e){var t,n,i,r,a;for(r=this._listeners.slice(),a=[],n=0,i=r.length;n<i;n++)t=r[n],a.push(t(e));return a},e})())})}.call(this),define("modules/clean/react/home/home_access/recents/actions",["require","exports","modules/clean/flux/dispatcher","modules/clean/react/home/home_access/recents/constants"],function(e,t,n,i){"use strict";t.HomeRecentsActions={logEvent:function(e,t,r,a,o){var s={actionType:e,cellView:t,fqPaths:r,totalCount:a,index:o};n.dispatch({type:i.HomeRecentsActionTypes.LOG_EVENT,event:s})}}}),define("modules/clean/react/home/home_access/recents/constants",["require","exports"],function(e,t){"use strict";t.HomeRecentsActionTypes={LOG_EVENT:"HOME_RECENTS_LOG_EVENT"}}),define("modules/clean/recent_activity/actions/error_actions",["require","exports","external/underscore","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_dispatcher","modules/core/exception","modules/core/i18n","modules/core/notify"],function(e,t,n,i,r,a,o,s){"use strict";var c=(function(){function e(e){var t=this;this._flushQueues=function(){t._rafId=null;var e=t._recentActivityQueue;t._recentActivityQueue=[],e.length&&t._dispatcher.dispatch({type:i.RAW_RECENT_ACTIVITY_PARSE_ERROR,errors:e});var n=t._relatedActivityQueue;t._relatedActivityQueue=[],n.length&&t._dispatcher.dispatch({type:i.RAW_RELATED_ACTIVITY_PARSE_ERROR,errors:n})},this._notify=n.throttle(function(){var e=o._("Sorry, we were unable to show some recent items. The team has been notified");s.error(e)},500,{trailing:!1}),this._dispatcher=e,this._recentActivityQueue=[],this._relatedActivityQueue=[],this._rafId=null}return e.prototype.recentActivityParseError=function(e,t){a.reportException({err:t}),this._notify(),this._enqueueError(this._recentActivityQueue,e,t)},e.prototype.relatedActivityParseError=function(e,t){a.reportException({err:t}),this._notify(),this._enqueueError(this._relatedActivityQueue,e,t)},e.prototype._enqueueError=function(e,t,n){e.push({activityKey:t,error:n}),this._rafId||(this._rafId=window.requestAnimationFrame(this._flushQueues))},e})();t.ErrorActions=c,t.errorActions=new c(r.recentActivityDispatcher)}),define("modules/clean/recent_activity/actions/recent_activity_action_permissions",["require","exports","modules/clean/recent_activity/recent_activity_model"],function(e,t,n){"use strict";function i(e,t){return n.isShareLinkRecentItem(e)?r(!!t.canOpen):{open:!!t.canOpen,delete:!t.isReadOnly,download:!0,comment:!t.isDir,versions:!t.isDir,archive:!1,share:!1}}function r(e){return{archive:!1,comment:!1,delete:!1,download:!1,open:e,share:!1,versions:!1}}function a(e,t,i){if(e.federatedRecentItem)return{archive:e.federatedRecentItem.isArchiveable(),comment:!1,delete:!1,download:!1,open:!1,share:e.federatedRecentItem.isShareable(),versions:!1};var a=e.attachmentIds.length>1,s=t[0],c=i.length,l=!a||1===c;if(n.isShareLinkRecentItem(e))return r(!!(l&&s&&s.canOpen));var u=o(t,i),d=c>0,h=!s||!s.isDir;return{archive:!1,comment:l&&h,delete:d&&u.allSelectedItemsAreNotReadOnly||a&&u.allItemsAreNotReadOnly||!a&&s&&!s.isReadOnly,download:l,open:!!(l&&s&&s.canOpen),share:!!(l||d&&u.allSelectedItemsAreInRootCollections||u.allItemsAreInRootCollection),versions:l&&h}}function o(e,t){for(var n={allItemsAreInRootCollection:!0,allItemsAreNotReadOnly:!0,allSelectedItemsAreInRootCollections:!0,allSelectedItemsAreNotReadOnly:!0},i=0,r=e;i<r.length;i++){var a=r[i];a.inRootCollection||(n.allItemsAreInRootCollection=!1),a.isReadOnly&&(n.allItemsAreNotReadOnly=!1),t.indexOf(a.id)>=0&&(a.inRootCollection||(n.allSelectedItemsAreInRootCollections=!1),a.isReadOnly&&(n.allSelectedItemsAreNotReadOnly=!1))}return n}t.getDocAttachmentViewPermissions=i,t.getRecentActivityItemViewPermissions=a}),define("modules/clean/recent_activity/actions/recent_activity_actions",["require","exports","tslib","external/underscore","modules/clean/dbmodal","modules/clean/deprecated/dbmodal_loading","modules/clean/downloads","modules/clean/fileops","modules/clean/react/home/home_access/recents/actions","modules/clean/react/modal","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_client","modules/clean/recent_activity/recent_activity_dispatcher","modules/clean/recent_activity/recent_activity_logger","modules/clean/recent_activity/recent_activity_logger_utils","modules/clean/recent_activity/store_utils","modules/clean/recent_activity/stores/attachment_store","modules/clean/recent_activity/stores/recent_activity_store","modules/clean/sharing/async_share_modal_util","modules/clean/viewer","modules/clean/web_timing_logger","modules/constants/python","modules/constants/python","modules/core/browser","modules/core/exception","modules/core/i18n","modules/core/notify","modules/core/uri","modules/clean/recent_activity/store_utils","modules/clean/recent_activity/store_utils"],function(e,t,n,i,r,a,o,s,c,l,u,d,h,m,p,_,f,g,v,y,I,E,A,R,w,T,S,C,N,b){"use strict";function L(e){return i.pluck(e,"previewInfo").filter(function(e){return e&&!e.is_dir})}function D(t,r,a){var o=y.get_viewer().get_user_by_id(t);a=n.__assign({index:0,shouldFocusCommentInput:!1},a),I.waitForTTI().then(function(){e(["modules/clean/react/file_viewer/controller"],function(e){e.isShown()?e.updateFiles(r):e.open(r,a.index,o,"react-file-viewer",{disableRouting:!0,oref:E.OREF_CONSTANTS.RECENTS,fileViewTarget:A.FileViewTargetType.PRIVATE,fileViewOrigin:A.FileViewOriginType.RECENTS,fileViewAction:A.FileViewActionType.CLICK,shouldFocusCommentInput:a.shouldFocusCommentInput,onCloseViewer:a.onCloseViewer||i.noop})},function(){return S.error(T._("There was a problem completing this request."))})})}function O(e){return i.compact(i.pluck(e,"fqPath"))}function P(e,t,r){void 0===r&&(r={});var a=!1,o=f.attachmentStore.getByIds(t);if(!i.all(i.pluck(o,"isLoaded"))){var s=n.__assign({},r),c=s.onCloseViewer||i.noop;s.onCloseViewer=function(){a=!0,c()};var l=L(o);l.length&&D(e,l,s)}return function(){return a}}function V(e){var t=g.recentActivityStore.cursorForUser(e);return t&&_.loadRecentItems(e,{cursor:t}),!!t}function x(e,t,n){_.ensureAttachments(e,[t],function(t){var i=t[0],r=i.fqPath||"",a=y.get_viewer().get_user_by_id(e);if(v.asyncShowShareModal(a,{fqPath:r,isFolder:i.previewInfo.is_dir,origin:"RECENTS"}),n){var o=O(t);p.logShareFile(e,r,n.totalCount,n.cellView),c.HomeRecentsActions.logEvent(m.ActionTypes.SHARE,n.cellView,o,n.totalCount,o.indexOf(r))}})}function k(e,t,n){_.ensureAttachments(e,t,function(t){var i=t.map(function(e){return{ns_id:e.nsId,ns_path:e.nsPath}});d.createCollectionSharedLink(e,i).then(function(t){if(t.shareableItemCount<i.length){var n=i.length-t.shareableItemCount;S.error(T.ungettext("%(missing)s file can’t be shared.","%(missing)s files can’t be shared.",n).format({missing:n}))}var o=new C({path:"/sm/get_link_modal_content/"+t.tkey}).toString();r.DBModalStack.push(new a({element_id:"share-link-modal",endpoint_url:o,subject_user:e,parameters:{origin:"recents"}}))}),n&&p.logShareCollection(e,O(t),n.totalCount,n.cellView)})}function F(e){R.redirect(e)}function M(e,t,n,i){void 0===n&&(n={});var r=P(e,t,n);_.ensureAttachments(e,t,function(t){var a=t[0],o=O(t),s=L(t),l=n.shouldFocusCommentInput?m.ActionTypes.COMMENT:m.ActionTypes.VIEW_FILE;if(i&&c.HomeRecentsActions.logEvent(l,i.cellView,o,i.totalCount,n.index),s.length){if(r()||D(e,s,n),i){var u=i.totalCount,d=i.cellView;n.shouldFocusCommentInput?p.logCommentFile(e,o[n.index||0],u,d):p.logPreviewFiles(e,o,u,d)}}else a.entityUri&&F(a.entityUri)})}function H(t,n,r,a){void 0===a&&(a=i.noop),e(["modules/clean/unity/features"],function(e){w.assert(!!e,"Unity is not supported by this browser"),_.ensureAttachments(t,[n],function(n){var o=n[0],s=o.nsId,l=o.nsPath,u=n[0].fqPath||"";if(e.open_file(s,l,t,i.noop,function(e){S.error("We were unable to open this file"),w.reportException({err:Error(e),tags:["recents"],severity:w.SEVERITY.NONCRITICAL})}),r){var d=r.totalCount,h=r.cellView,_=O(n);p.logUnityOpenFile(t,u,d,h),c.HomeRecentsActions.logEvent(m.ActionTypes.OPEN,h,_,d,_.indexOf(u))}a()})})}function U(e,t,n){var r,a,o=function(){return _.ensureAttachments(e,t,function(r){var a=O(r);if(n){var o=n.totalCount,l=n.cellView;p.logDeleteFiles(e,a,o,l),c.HomeRecentsActions.logEvent(m.ActionTypes.DELETE,l,a,o,void 0)}var d=i.uniqueId("DELETE_FILES");h.recentActivityDispatcher.dispatch({type:u.DELETE_FILES_PENDING,attachmentIds:t,transactionId:d});var _=function(){return h.recentActivityDispatcher.dispatch({type:u.DELETE_FILES_COMMIT,transactionId:d})},f=function(){return h.recentActivityDispatcher.dispatch({type:u.DELETE_FILES_ROLLBACK,transactionId:d})};s.do_nonbrowse_delete(e,a).then(_,f)})};if(1===t.length){a=T._("Delete file?");var d=f.attachmentStore.getById(t[0]);r=d&&d.isLoaded?T._("Do you want to delete <b>%(file_name)s</b>?").format({file_name:i.escape(d.displayName||"")}):T._("Do you want to delete this file?")}else a=T._("Delete files?"),r=T._("Do you want to delete <b>%(num)s files</b>?").format({num:i.escape(String(t.length))});l.SimpleModal.show({title_text:a,body_html:r,confirm_text:T._("Delete"),confirm_callback:o,cancel_text:T._("Cancel"),autoclose:!0})}function q(e,t){h.recentActivityDispatcher.dispatch({type:u.RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY,rawRelatedActivitiesByKey:e,userId:t})}function B(e,t){h.recentActivityDispatcher.dispatch({type:u.SELECT_ATTACHMENTS,recentItemId:e,attachmentIds:t})}function W(e,t){h.recentActivityDispatcher.dispatch({type:u.DESELECT_ATTACHMENTS,recentItemId:e,attachmentIds:t})}function j(e,t,n){_.ensureAttachments(e,t,function(t){if(n){var i=O(t),r=n.totalCount,a=n.cellView;p.logDownloadFile(e,i,r,a),c.HomeRecentsActions.logEvent(m.ActionTypes.DOWNLOAD,a,i,r)}for(var s=0,l=t;s<l.length;s++){var u=l[s];if(u.isDir&&u.fqPath&&null!=u.previewInfo&&null!=u.previewInfo.block_hash)o.get_zip({fq_paths:[u.fqPath],subject_uid:e,block_hash:u.previewInfo.block_hash,parent_path:u.fqPath});else{var d=null!=u.previewInfo?u.previewInfo.direct_blockserver_link:void 0;d&&o.get_blockserver_link({url:d})}}})}function Y(e,t,n){_.ensureAttachments(e,[t],function(t){var i=t[0].fqPath||"",r=s.build_revisions_uri(i,e);if(n){var a=n.totalCount,o=n.cellView,l=O(t);p.logOpenVersions(e,i,a,o),c.HomeRecentsActions.logEvent(m.ActionTypes.VERSIONS,o,l,a,l.indexOf(i))}R.redirect(r.toString())})}t.loadNextPage=V,t.loadAttachmentsForRecentActivities=N.loadAttachmentsForRecentActivities,t.shareFile=x,t.shareCollection=k,t.browseFile=F,t.previewFiles=M,t.openFile=H,t.promptAndDeleteAttachments=U,t.loadAttachments=b.loadAttachments,t.updateRecentActivities=b.updateRecentActivities,t.updateRelatedActivities=q,t.selectAttachments=B,t.deselectAttachments=W,t.downloadFiles=j,t.openVersions=Y}),define("modules/clean/recent_activity/models/attachment",["require","exports"],function(e,t){"use strict";function n(e){var t=e.preview_jsinfo||null,n=null,i=null;if(t&&(t.thumbnail_url_tmpl&&(n=t.thumbnail_url_tmpl),t.thumbnail_dimensions)){var r=t.thumbnail_dimensions,a=r[0];i={height:r[1],width:a}}var o=e.comment||{},s=o.commenter_dict||{};return{id:e.activity_key,isLoaded:!0,viewingUserId:e.viewing_user.id,displayName:e.name||null,entityUri:e.entity_uri||null,previewInfo:e.preview_jsinfo||null,fqPath:e.fq_path||null,nsPath:e.ns_path||null,nsId:e.ns_id||null,thumbnailUrl:n||null,thumbnailDimensions:i||null,canOpen:!1,inRootCollection:!1,isReadOnly:!!e.is_read_only,isDir:!!e.is_dir,commentRawText:o.raw_comment_text||null,commenterId:s.id||null,commenterDisplayName:s.display_name||null,commenterPhotoUrl:s.photo_circle_url||null}}function i(e){return(e.related_activity_keys||[]).map(function(t){return{id:t,viewingUserId:e.viewing_user.id,displayName:null,isLoaded:!1,canOpen:!1,inRootCollection:!1,isReadOnly:!1,isDir:!1,entityUri:null,previewInfo:null,fqPath:null,nsPath:null,nsId:null,thumbnailUrl:null,thumbnailDimensions:null,commentRawText:null,commenterId:null,commenterDisplayName:null,commenterPhotoUrl:null}})}t.convertFileActivityToAttachmentItem=n,t.createPartialAttachmentsFromRecentActivity=i}),define("modules/clean/recent_activity/react/attachment_file_icon_view",["require","exports","tslib","external/classnames","external/react","external/underscore","modules/clean/em_string","modules/clean/react/sprite","modules/clean/recent_activity/react/selectable_view"],function(e,t,n,i,r,a,o,s,c){"use strict";var l=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onClick=function(e){e.preventDefault(),t.props.handleClick(t.props.id)},t.onContextMenu=function(e){e.preventDefault(),t.props.handleContextMenu(t.props.id)},t}return n.__extends(t,e),t.prototype.renderFilename=function(){var e=this.props.file.displayName.split("."),t="."+e.pop(),n=o.em_snippet(e.join("."),10);return r.createElement("span",{className:"attachment-item__filename"},n,r.createElement("wbr",null),r.createElement("span",{className:"nowrap"},t))},t.prototype.renderIcon=function(){return r.createElement(s,{alt:"",group:"web",name:this.props.file.icon,className:"attachment-item__icon"})},t.prototype.render=function(){var e,t,n=this.renderIcon(),a=this.renderFilename(),o=this.props,s=o.overlayText,l=o.isSelected,u=o.file;return s&&(t=r.createElement("span",{className:"attachment-item__overlay"},s)),this.props.showCheckmark&&(e=r.createElement(c.SelectableView,{id:this.props.id,handleToggleSelect:this.props.handleToggleSelect,isSelected:l})),r.createElement("div",{className:i({"attachment-item":!0,"attachment-item--file-thumb":!0,"attachment-item--show-more":!!s,"attachment-item--selected":l})},r.createElement("a",{href:u.entityUri,title:u.displayName,className:"attachment-item__anchor",onClick:this.onClick,onContextMenu:this.onContextMenu},n,a,t,e))},t})(r.Component);l.defaultProps={handleClick:a.noop,handleContextMenu:a.noop},t.AttachmentFileIconView=l}),define("modules/clean/recent_activity/react/attachment_grid",["require","exports"],function(e,t){"use strict";var n=(function(){function e(e,t){this._gridWidth=e,this._gutterWidth=t}return e.create=function(t,n){return new e(t,n)},e.prototype.generate=function(e,t){void 0===t&&(t=1/0);for(var n=[],i=0;n.length<t&&i<e.length;){var r=this.buildRow(e.slice(i));i+=r.length,n.push(r)}return n},e.prototype.buildRow=function(e){for(var t=[],n=this._gridWidth+this._gutterWidth,i=0,r=e;i<r.length;i++){var a=r[i];if(n=n-a.width-this._gutterWidth,!(n>=0||0===t.length))break;t.push(a)}return t},e})();t.AttachmentGrid=n}),define("modules/clean/recent_activity/react/attachment_image_expanded_view",["require","exports","tslib","external/react","modules/clean/accessibility/utils","modules/clean/recent_activity/react/attachment_image_view"],function(e,t,n,i,r,a){"use strict";var o=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleCornerClick=function(e){e.preventDefault();var n=t.props.handleCornerClick;n&&n(t.props.id)},t}return n.__extends(t,e),t.prototype.render=function(){var e=this.props.image;return i.createElement("div",{className:"attachment-item attachment-item--expanded",style:{width:e.width,height:e.height}},i.createElement("div",{className:"attachment-item--expanded__image"},i.createElement(a.AttachmentImageView,n.__assign({},this.props))),i.createElement("a",n.__assign({},r.accessibleTriggerProps(this.handleCornerClick),{className:"attachment-item--expanded__corner"}),"-"))},t})(i.Component);t.AttachmentImageExpandedView=o}),define("modules/clean/recent_activity/react/attachment_image_stack_view",["require","exports","tslib","external/react","modules/clean/recent_activity/react/attachment_image_view"],function(e,t,n,i,r){"use strict";var a=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleCornerClick=function(e){e.preventDefault();var n=t.props.handleCornerClick;n&&n(t.props.id)},t}return n.__extends(t,e),t.prototype.render=function(){var e=this.props.image,t=e.width,a=e.height,o=t-4,s=a-4,c=n.__assign({},e,{width:o,height:s});return i.createElement("div",{className:"attachment-item attachment-item--stacked",style:{width:t,height:a}},i.createElement("div",{className:"attachment-item--stacked__front"},i.createElement(r.AttachmentImageView,n.__assign({},this.props,{image:c}))),i.createElement("div",{className:"attachment-item--stacked__back"},i.createElement(r.AttachmentImageView,{image:c})),i.createElement("a",{className:"attachment-item--stacked__corner",onClick:this.handleCornerClick},"+%(count)s".format({count:this.props.stackLength-1})))},t})(i.Component);t.AttachmentImageStackView=a}),define("modules/clean/recent_activity/react/attachment_image_view",["require","exports","tslib","external/classnames","external/react","modules/clean/recent_activity/react/selectable_view"],function(e,t,n,i,r,a){"use strict";var o=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isLoading:!0},t.onClick=function(e){e.preventDefault(),t.props.handleClick(t.props.id)},t.onContextMenu=function(e){e.preventDefault(),t.props.handleContextMenu(t.props.id)},t.onLoad=function(){t.setState({isLoading:!1})},t.onError=function(){t.props.handleLoadError(t.props.id),t.setState({isLoading:!1})},t}return n.__extends(t,e),t.prototype.render=function(){var e,t,n=this.props,o=n.overlayText,s=n.showCheckmark,c=n.isSelected,l=n.badgeType,u=n.image;return o&&(t=r.createElement("span",{className:"attachment-item__overlay"},o)),s&&(e=r.createElement(a.SelectableView,{id:this.props.id,handleToggleSelect:this.props.handleToggleSelect,isSelected:c})),r.createElement("div",{className:i((d={"attachment-item":!0,"attachment-item--show-more":!!o,"attachment-item--is-loading":this.state.isLoading,"attachment-item--selected":c},d["attachment-item--badge-"+l]=!!l,d))},r.createElement("a",{href:u.entityUri,onClick:this.onClick,onContextMenu:this.onContextMenu,title:u.displayName,className:"attachment-item__anchor",style:{width:u.width,height:u.height},tabIndex:0},r.createElement("img",{alt:u.displayName,className:"attachment-item__thumbnail",src:u.thumbnailUrl,onLoad:this.onLoad,onError:this.onError}),t),e);var d},t})(r.PureComponent);o.defaultProps={handleClick:function(){},handleContextMenu:function(){},handleLoadError:function(){},handleToggleSelect:function(){},showCheckmark:!1,isSelected:!1},t.AttachmentImageView=o}),define("modules/clean/recent_activity/react/attachment_list_layout",["require","exports","external/underscore","modules/clean/photos/thumbnail_url_util","modules/clean/recent_activity/react/attachment_file_icon_view","modules/clean/recent_activity/react/attachment_grid","modules/clean/recent_activity/react/attachment_image_view","modules/core/browser","modules/core/exception"],function(e,t,n,i,r,a,o,s,c){"use strict";function l(e,t){var n,r,a,o=s.is_high_density_display();switch(t){case"aggregated-scaled":a=o?200:100,n=o?200:100,r=u;break;case"aggregated-cropped":a=o?200:100,n=o?200:100,r=d;break;case"aggregated-wide-cropped":a=o?718:359,n=o?200:100,r=d;break;default:return c.assert(!1,"invalid ThumbnailVariant: "+t),""}return i.thumbnailUrlForSize(e,a,n,r)}var u=i.ThumbnailSizeMode.FIT_ONE,d=i.ThumbnailSizeMode.EXACT_NO_BACKGROUND,h=(function(){function e(e,t,n){this._gridWidth=e,this._columnWidth=t,this._gutterWidth=n,this._grid=a.AttachmentGrid.create(e,n)}return e.create=function(t,n,i){return new e(t,n,i)},e.prototype.generate=function(e,t,n){var i=this.cellMetadata(e,n);return this._grid.generate(i,t)},e.prototype.cellMetadata=function(e,t){var i=this,r=n.object(t,t);return e.map(function(e){return r[e.id]||e.isLoaded&&!e.thumbnailUrl?i.buildFileIconViewMetadata(e):e.isLoaded?i.buildImageViewMetadata(e):i.buildLoadingImageViewMetadata(e)})},e.prototype.buildFileIconViewMetadata=function(e){return{id:e.id,scaledThumbnailUrl:null,view:r.AttachmentFileIconView,width:92,height:100,attachment:e}},e.prototype.buildLoadingImageViewMetadata=function(e){return{id:e.id,scaledThumbnailUrl:null,view:null,width:100,height:100,attachment:e}},e.prototype.buildImageViewMetadata=function(e){var t=e.thumbnailUrl,n=this.calculateThumbnailDimensions(e.thumbnailDimensions),i=n.width,r=n.height,a=n.variant;return t.startsWith("data:")||(t=l(t,a)),{id:e.id,view:o.AttachmentImageView,scaledThumbnailUrl:t,width:i+6,height:r+6,attachment:e}},e.prototype.calculateThumbnailDimensions=function(e){var t,n,i;if(e){i="aggregated-scaled";var r=e.width/e.height;t=100,n=Math.floor(r*t),n>this._columnWidth-6&&(i="aggregated-wide-cropped",n=this._columnWidth-6)}return(!e||n<75)&&(i="aggregated-cropped",n=100,t=100),{width:n,height:t,variant:i}},e})();t.AttachmentListLayout=h}),define("modules/clean/recent_activity/react/attachment_list_view",["require","exports","tslib","external/react","external/underscore","jquery","modules/clean/components/loading_indicator","modules/clean/recent_activity/actions/recent_activity_actions","modules/clean/recent_activity/react/attachment_file_icon_view","modules/clean/recent_activity/react/attachment_image_expanded_view","modules/clean/recent_activity/react/attachment_image_stack_view","modules/clean/recent_activity/react/attachment_image_view","modules/clean/recent_activity/react/attachment_list_layout","modules/clean/recent_activity/recent_activity_constants","modules/clean/react_logger","modules/core/exception","modules/core/i18n"],function(e,t,n,i,r,a,o,s,c,l,u,d,h,m,p,_,f){"use strict";var g=(function(e){function t(t){var i=e.call(this,"AttachmentListView",t)||this;return i.setAttachmentListRef=function(e){return i.attachmentsList=e},i.state={rows:i.isAllSelected(i.props)?1/0:1,errored:[],containerWidth:null,expandedAttachments:{}},i.previewAttachment=function(e){var t=i.props.attachments,n=r.findWhere(t,{id:e}),a=n.viewingUserId,o=r.pluck(t,"id"),c={totalCount:t.length,cellView:i};s.previewFiles(a,o,{index:t.indexOf(n)},c)},i.expandStack=function(e){for(var t=i.dedupeMetadata(),a=r.find(t,function(t){return t.attachment.id===e}),o=n.__assign({},i.state.expandedAttachments),s=i.props.attachments.indexOf(a.attachment),c=a.stackLength,l=s;l<s+c;l++)o[i.props.attachments[l].id]=e;i.setState({expandedAttachments:o})},i.collapseStack=function(e){for(var t=i.state.expandedAttachments[e],a=i.dedupeMetadata(),o=r.find(a,function(e){return e.attachment.id===t}),s=n.__assign({},i.state.expandedAttachments),c=i.props.attachments.indexOf(o.attachment),l=o.stackLength,u=c;u<c+l;u++)delete s[i.props.attachments[u].id];i.setState({expandedAttachments:s})},i.handleImageToggleSelect=function(e,t){var n=r.findWhere(i.props.attachments,{id:e});i.props.handleToggleSelect(n,t)},i.handleImageLoadError=function(e){var t=i.state.errored.slice();t.push(e),i.setState({errored:t})},i.revealNextGroup=function(){i.setState({rows:i.state.rows+m.SHOW_MORE_THUMBNAIL_ROW_INCREMENT})},i}return n.__extends(t,e),t.prototype.isAllSelected=function(e){return r.size(e.selectedAttachmentIds)===e.attachments.length},t.prototype.componentDidMount=function(){this.updateLayoutController(),this.state.rows>1&&this.loadRemainingAttachments(),e.prototype.componentDidMount.call(this)},t.prototype.componentWillReceiveProps=function(e){this.isAllSelected(e)&&this.setState({rows:1/0})},t.prototype.componentDidUpdate=function(e){this.updateLayoutController(),this.state.rows>1&&this.loadRemainingAttachments()},t.prototype.updateLayoutController=function(){var e=a(this.attachmentsList),t=e.innerWidth();if(t!==this.state.containerWidth){var n=Math.abs(parseFloat(e.css("margin-left")))||0,i=Math.floor(t/2)-n;this.layoutController=h.AttachmentListLayout.create(t,i,n),this.setState({containerWidth:t})}},t.prototype.loadRemainingAttachments=function(){var e=this.props.attachments[0].viewingUserId,t=this.props.attachments.filter(function(e){return!e.isLoaded}).map(function(e){return e.id});t.length&&s.loadAttachments(e,t)},t.prototype.renderFileIconView=function(e,t,n){var r=e.attachment;return i.createElement(c.AttachmentFileIconView,{key:"attachment-"+e.id,id:e.id,file:{icon:r.previewInfo.icon,displayName:r.displayName||"",entityUri:r.entityUri||""},overlayText:t,handleClick:n,showCheckmark:this.props.attachments.length>1&&!t,handleToggleSelect:this.handleImageToggleSelect,isSelected:this.props.selectedAttachmentIds.includes(r.id)})},t.prototype.renderStackedImageView=function(e,t,r){var a=this.propsForImageView(e,r);return i.createElement(u.AttachmentImageStackView,n.__assign({},a,{key:"attachment-stacked-"+e.id,handleClick:this.expandStack,handleCornerClick:this.expandStack,stackLength:t}))},t.prototype.renderExpandedImageView=function(e,t,r){var a=this.propsForImageView(e,r);return i.createElement(l.AttachmentImageExpandedView,n.__assign({},a,{showCheckmark:this.props.attachments.length>1,handleCornerClick:this.collapseStack}))},t.prototype.renderImageView=function(e,t,r){var a=this.propsForImageView(e,r);return i.createElement(d.AttachmentImageView,n.__assign({},a,{key:"attachment-expanded-"+e.id,overlayText:t,showCheckmark:this.props.attachments.length>1&&!t}))},t.prototype.propsForImageView=function(e,t){var n=e.attachment,i=n.previewInfo,r="video"===(i&&i.preview_type);return{id:e.id,image:{thumbnailUrl:e.scaledThumbnailUrl,entityUri:n.entityUri||"",displayName:n.displayName||"",width:e.width,height:e.height},badgeType:r?"video":void 0,handleClick:t,handleLoadError:this.handleImageLoadError,handleToggleSelect:this.handleImageToggleSelect,isSelected:this.props.selectedAttachmentIds.includes(n.id)}},t.prototype.dedupeMetadata=function(){var e,t=[],n={},i={},r={};if(this.props.duplicateIds)for(var a=0;a<this.props.attachments.length;a++){e=this.props.attachments[a];var o=this.props.duplicateIds[a];n.hasOwnProperty(o)||(n[o]=[],r[e.id]=e),n[o].push(e),i[e.id]=n[o]}for(var s=0,c=this.props.attachments;s<c.length;s++){e=c[s];var l=this.state.expandedAttachments.hasOwnProperty(e.id),u=i[e.id],d=u&&u.length,h=r.hasOwnProperty(e.id),m=d>1&&h;d>1&&!h&&!l||t.push({attachment:e,stackLength:d,isParentOfStack:h,isStacked:m,isExpanded:l})}return t},t.prototype.isLoading=function(){return this.state.rows>1&&this.props.attachments.some(function(e){return!e.isLoaded})},t.prototype.renderAttachmentItems=function(){if(!this.state.containerWidth)return[];for(var e=this.dedupeMetadata(),t=r.pluck(e,"attachment"),n=this.isLoading()?1:this.state.rows,a=this.layoutController.generate(t,n,this.state.errored),o=r.flatten(a),s=this.previewAttachment,l=o.length,u=t.length,h=u-l+1,m=!this.isLoading()&&l<u,p=[],g=0;g<o.length;g++){var v=void 0,y=void 0,I=o[g],E=g===o.length-1,A=e[g],R=A.isStacked,w=A.isParentOfStack,T=A.isExpanded,S=A.stackLength;E&&m&&(s=this.revealNextGroup,y=f._("+%(count)s").format({count:h}));var C="attachment-item-"+I.attachment.id;switch(I.view){case c.AttachmentFileIconView:v=this.renderFileIconView(I,y,s);break;case d.AttachmentImageView:var N=m&&E;S>1&&!N?w&&T?v=this.renderImageView(I,y,s):R&&!T?v=this.renderStackedImageView(I,S,s):T&&(v=this.renderExpandedImageView(I,y,s)):v=this.renderImageView(I,y,s);break;default:I.view&&_.assert(!1,I.view.name+" is not supported by AttachmentListView")}p.push(i.createElement("li",{key:C},v))}return p},t.prototype.renderLoadingView=function(){return i.createElement("div",{className:"attachment-loading"},i.createElement(o,{style:o.LoadingIndicatorStyle.BLUE_SPINNER,className:"recents-loading-indicator"}))},t.prototype.render=function(){var e=null;return this.isLoading()&&(e=this.renderLoadingView()),i.createElement("div",{className:"recents-item__attachments"},i.createElement("ul",{ref:this.setAttachmentListRef,className:"attachment-list"},this.renderAttachmentItems()),e)},t})(p.ReactLogger);g.defaultProps={handleToggleSelect:function(){},selectedAttachmentIds:[]},t.AttachmentListView=g}),define("modules/clean/recent_activity/react/comment_attachment_view",["require","exports","tslib","external/react","modules/clean/avatar/avatar_with_default","modules/clean/avatar/initials_avatar","modules/clean/avatar/viewer_avatar","modules/clean/comments/comment_dom","modules/clean/viewer","modules/core/user_i18n"],function(e,t,n,i,r,a,o,s,c,l){"use strict";var u=(function(e){
function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleClick=function(){t.props.handlePreview()},t}return n.__extends(t,e),t.prototype.renderCommentText=function(){var e=s.convertRawCommentTextToReactDom(this.props.attachment.commentRawText,!1);return i.createElement("div",{className:"comment-attachment-item__comment"},i.createElement("div",{className:"comment-bubble"},e))},t.prototype.renderAvatar=function(){var e=this.props.attachment,t={dimension:24,defaultAvatar:i.createElement(a,{key:"commenter-"+e.commenterId,dimension:24,shape:"CIRCLE",initials:l.getInitials(e.commenterDisplayName)}),photoUrl:null};""!==e.commenterPhotoUrl&&(t.photoUrl=e.commenterPhotoUrl);var s;return s=c.get_viewer().get_user_ids(!0).includes(e.commenterId)?i.createElement(o,n.__assign({},t)):i.createElement(r,n.__assign({},t)),i.createElement("div",{className:"comment-attachment-item__avatar"},s)},t.prototype.render=function(){var e=this.renderAvatar(),t=this.renderCommentText();return i.createElement("div",{className:"comment-attachment-item",onClick:this.handleClick},e,t)},t})(i.PureComponent);u.defaultProps={handlePreview:function(){}},t.CommentAttachmentView=u}),define("modules/clean/recent_activity/react/doc_attachment_list_view",["require","exports","tslib","external/classnames","external/react","modules/clean/components/loading_indicator","modules/clean/react_logger","modules/clean/recent_activity/actions/recent_activity_actions","modules/clean/recent_activity/react/doc_attachment_view","modules/clean/recent_activity/recent_activity_constants","modules/core/exception","modules/core/i18n"],function(e,t,n,i,r,a,o,s,c,l,u,d){"use strict";var h=(function(e){function t(t){var n=e.call(this,"DocAttachmentListView",t)||this;return n.state={numberOfRows:l.MAX_INITIAL_DOC_ATTACHMENTS},n.revealNextGroup=function(e){e.preventDefault(),n.setState({numberOfRows:n.state.numberOfRows+l.SHOW_MORE_DOC_ATTACHMENT_INCREMENT})},n}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.state.numberOfRows>l.MAX_INITIAL_DOC_ATTACHMENTS&&this.loadRemainingAttachments(),e.prototype.componentDidMount.call(this)},t.prototype.componentDidUpdate=function(){this.state.numberOfRows>l.MAX_INITIAL_DOC_ATTACHMENTS&&this.loadRemainingAttachments()},t.prototype.componentWillReceiveProps=function(e){var t=this.props.attachments,n=this.state.numberOfRows,i=t.slice(0,n).filter(function(e){return e.isLoaded}).map(function(e){return e.id}),r=i.length,a=e.attachments.map(function(e){return e.id}).filter(function(e){return i.includes(e)}).length;if(a<r){var o=n+a-r;u.assert(o>=0,"number of rows removed cannot be greater than the total number of rows"),this.setState({numberOfRows:n+a-r})}},t.prototype.loadRemainingAttachments=function(){var e=this.props.attachments;if(e.length){var t=e[0].viewingUserId,n=e.filter(function(e){return!e.isLoaded}).map(function(e){return e.id});n.length&&s.loadAttachments(t,n)}},t.prototype.shouldShowSubheading=function(){return!1},t.prototype.renderFileView=function(e){return r.createElement(c.DocAttachmentView,{key:"attachment-"+e.id,attachment:e,recentItem:this.props.recentItem,showSubHeading:this.shouldShowSubheading(),renderingInfo:this.props.renderingInfo})},t.prototype.renderLoadMoreView=function(e){var t=d._("Show %(num)s more").format({num:e});return r.createElement("button",{key:"attachment-load-more",className:"attachment-load-more button-as-link",onClick:this.revealNextGroup},t)},t.prototype.renderLoadingView=function(){return r.createElement("li",{key:"attachment-loading",className:"attachment-loading"},r.createElement(a,{style:a.LoadingIndicatorStyle.BLUE_SPINNER,className:"recents-loading-indicator"}))},t.prototype.renderFooter=function(e){var t=Math.min(e,l.SHOW_MORE_DOC_ATTACHMENT_INCREMENT);return r.createElement("li",{key:"attachment-footer",className:"doc-attachment-list__footer"},r.createElement("div",{className:"doc-attachment-list__footer--cell"},this.renderLoadMoreView(t)))},t.prototype.renderAttachmentItems=function(){var e=this,t=this.props.attachments,n=t.slice(0,this.state.numberOfRows),i=n.filter(function(e){return e.isLoaded}).map(function(t){return e.renderFileView(t)}),r=t.length-i.length;return n.filter(function(e){return!e.isLoaded}).length>0?i.push(this.renderLoadingView()):r>0&&i.push(this.renderFooter(r)),i},t.prototype.render=function(){var e=this.renderAttachmentItems(),t=this.props.attachments,n=null;0!==t.length&&(n=r.createElement("div",{className:"doc-attachment-list__spacer"}));var a={"recents-item__doc-attachments":!0,"recents-item__doc-attachments--collapsed":this.props.isCollapsed};return r.createElement("div",{className:i(a)},n,r.createElement("ul",{className:"doc-attachment-list"},e))},t})(o.ReactLogger);t.DocAttachmentListView=h}),define("modules/clean/recent_activity/react/doc_attachment_view",["require","exports","tslib","external/classnames","external/react","modules/clean/em_string","modules/clean/react/file_path_breadcrumb","modules/clean/recent_activity/actions/recent_activity_action_permissions","modules/clean/recent_activity/actions/recent_activity_actions","modules/clean/recent_activity/react/recent_activity_item_actions_view","modules/clean/recent_activity/react/recent_activity_item_header_view","modules/clean/recent_activity/recent_activity_model","modules/clean/recent_activity/recent_activity_view_helper","modules/core/exception","modules/core/i18n"],function(e,t,n,i,r,a,o,s,c,l,u,d,h,m,p){"use strict";var _=(function(e){function t(t){var n=e.call(this,t)||this;return n.previewOrOpenFiles=function(e){n.getVersion().previewOrOpenRecentItem(n.getRecentItem(),n.getAttachments(),{shouldFocusCommentInput:e},n.getLogData())},n.onBlur=function(e){n.setState({isFocused:!1})},n.onFocus=function(e){n.setState({isFocused:!0})},n.onMouseEnter=function(e){n.setState({isHovered:!0})},n.onMouseLeave=function(e){n.setState({isHovered:!1})},n.onPreview=function(e){e.preventDefault(),n.previewOrOpenFiles(!1)},n.handleArchive=function(){},n.handleComment=function(){n.previewOrOpenFiles(!0)},n.handleDelete=function(){n.getVersion().deleteRecentItem(n.getRecentItem(),n.getAttachments(),n.getLogData())},n.handleDeselectAll=function(){},n.handleDownload=function(){c.downloadFiles(n.getViewingUserId(),[n.getAttachmentId()],n.getLogData())},n.handleSelectAll=function(){},n.handleOpen=function(){m.assert(!!n.getAttachment().canOpen,"This item does not support opening"),c.openFile(n.getViewingUserId(),n.getAttachmentId(),n.getLogData())},n.handleShare=function(){n.getVersion().shareRecentItem(n.getRecentItem(),n.getAttachments(),n.getLogData())},n.handleVersions=function(){c.openVersions(n.getViewingUserId(),n.getAttachmentId(),n.getLogData())},n.onShowTooltip=function(){n.setState({tooltipShown:!0})},n.onHideTooltip=function(){n.setState({tooltipShown:!1})},n.state={tooltipShown:!1,isHovered:!1,isFocused:!1},n}return n.__extends(t,e),t.prototype.getVersion=function(){return this.props.renderingInfo.version},t.prototype.getRecentItem=function(){return this.props.recentItem},t.prototype.getAttachment=function(){return this.props.attachment},t.prototype.getAttachments=function(){return[this.props.attachment]},t.prototype.getAttachmentId=function(){return this.props.attachment.id},t.prototype.getViewingUserId=function(){return this.props.attachment.viewingUserId},t.prototype.getLogData=function(){return{totalCount:this.getRecentItem().attachmentIds.length,cellView:this}},t.prototype.isSharedLink=function(){return d.isShareLinkRecentItem(this.getRecentItem())},t.prototype.getIcon=function(){var e=this.getAttachment().previewInfo;return e&&e.icon||"page_white_text"},t.prototype.getHeaderProps=function(){var e=this.getAttachment(),t={heading:e.displayName&&a.em_snippet(e.displayName,35)||"",icon:this.getIcon(),star:this.getVersion().renderStar(this.props.renderingInfo.role,this.getRecentItem())};return this.props.showSubHeading&&(t.subheading=this.renderSubheading()),e.thumbnailUrl&&(t.thumbnailUrl=e.thumbnailUrl),t},t.prototype.renderSubheading=function(){return this.getRecentItem().paths.length?r.createElement(o,{handlePathClick:this.props.handlePathClick,paths:this.getRecentItem().paths,viewingUserId:this.getViewingUserId()}):null},t.prototype.renderShareButton=function(){return r.createElement("a",{ref:"shareLink",className:"recents-item__share-link button-secondary",href:"#share",onClick:this.handleShare},p._("Share"))},t.prototype.renderActions=function(){return r.createElement(l.RecentActivityItemActionsView,{ref:"recentsItemActionsView",permissions:s.getDocAttachmentViewPermissions(this.getRecentItem(),this.getAttachment()),handler:this,tooltipHandler:this,selectCount:0,attachmentCount:1,disableActions:!1,type:this.getRecentItem().type,rowIsHovered:this.state.isHovered,renderingInfo:this.props.renderingInfo})},t.prototype.renderHeading=function(){return r.createElement(u.RecentActivityItemHeaderView,{ref:"recentsItemHeader",header:this.getHeaderProps(),tooltipShown:this.state.tooltipShown,handleClick:this.onPreview},this.isSharedLink()?null:r.createElement("div",{className:"recents-item__sharing recents-item__action-button"},this.renderShareButton()),this.renderActions())},t.prototype.render=function(){return r.createElement("li",{className:i((e={},e["doc-attachment-item"]=!0,e["doc-attachment-item--focused-in"]=this.state.isFocused,e)),onClick:h.ensureUserIntentToClick(this.onPreview),onBlur:this.onBlur,onFocus:this.onFocus,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave},this.renderHeading());var e},t})(r.PureComponent);_.defaultProps={showSubheading:!1},t.DocAttachmentView=_}),define("modules/clean/recent_activity/react/pending_attachment_list_view",["require","exports","tslib","external/classnames","external/react","external/underscore"],function(e,t,n,i,r,a){"use strict";var o=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this.props.count,t=a.times(Math.min(e,4),function(){return r.createElement("li",{className:"attachment-item attachment-item--placeholder"})}),n={"attachment-list":!0,"attachment-list--is-pending":!0,"attachment-list--standalone":1===e};return r.createElement("div",{className:"recents-item__attachments"},r.createElement("ul",{className:i(n)},t))},t})(r.Component);t.PendingAttachmentListView=o}),define("modules/clean/recent_activity/react/recent_activity_container",["require","exports","tslib","jquery","external/underscore","external/react","modules/clean/react_logger","modules/clean/page_role_observer","modules/clean/web_timing_logger","modules/clean/recent_activity/actions/recent_activity_actions","modules/clean/recent_activity/react/recent_activity_view","modules/clean/recent_activity/recent_activity_constants","modules/clean/viewer"],function(e,t,n,i,r,a,o,s,c,l,u,d,h){"use strict";function m(e){var t=0,n=function(){var n=i(window).scrollTop()/(document.documentElement.scrollHeight-window.innerHeight);n>.8&&n>t&&e(),t=n};window.addEventListener("scroll",r.throttle(n,150,{trailing:!1}),!1)}function p(e){"function"==typeof e&&e()}var _=(function(t){function i(e){var n=t.call(this,i.displayName,e)||this;return n.onShouldLoadMore=function(){var e=n.getCurrentUser();e&&!n.state.isPending&&n.getVersion().shouldLoadMore(e.id,n.state.filter)&&l.loadNextPage(e.id)&&n.setState({isPending:!0})},n.onUpdateFromStore=function(){var e=n.getRecentItems(),t=n.getVersion().isStoreReadyForUserId(n.getCurrentUserId(),n.hasRecentItems());n.setState({isPending:!t,items:e})},n.onRoleUpdate=function(e){if(e!==n.state.role){var t=n.getRecentItems(e);n.getVersion().loadPage(n.getUserId(e)),n.setState({role:e,items:t,filter:d.RECENT_EVENT_FILTER_TYPE.ALL,isPending:0===t.length,renderingInfo:n.createRenderingInfo(e,null)})}},n.removeStoreListeners=null,n.logTimeToInteractive=null,n._timer=0,n.state={items:[],role:n.props.initialRole,filter:d.RECENT_EVENT_FILTER_TYPE.ALL,isPending:!1,renderingInfo:n.createRenderingInfo(n.props.initialRole,!1)},n}return n.__extends(i,t),i.prototype.componentWillMount=function(){t.prototype.componentWillMount.call(this),this.removeStoreListeners=this.getVersion().getRemoveStoreListeners(this.onUpdateFromStore),this.getVersion().prefetchOnMount(this.getCurrentUserId());var e=this.getRecentItems();this.didReceiveRecentActivities()?this.setState({isPending:!1,items:e}):this.setState({isPending:0===e.length,items:e}),s.addListener(this.onRoleUpdate),this.logTimeToInteractive=this.getVersion().maybeInitLoggingAndGetTTILogger()},i.prototype.hasRecentItems=function(){return this.state.items.length>0},i.prototype.componentDidMount=function(){var n=this;m(r.throttle(this.onShouldLoadMore,2e3,{trailing:!1})),c.waitForTTI().then(function(){e(["modules/clean/react/file_viewer/controller","modules/clean/sharing/share_modal_util","modules/clean/sharing/wizard/wizard_modals","modules/clean/unity/features"],function(e,t,i,r){null!=r&&n.setState({renderingInfo:n.createRenderingInfo(null,!0)})})}),!this.hasRecentItems()&&this.didReceiveRecentActivities()&&(p(this.logTimeToInteractive),this.setState({isPending:!1})),t.prototype.componentDidMount.call(this)},i.prototype.clearLoadNewItemsTimer=function(){this._timer&&(clearInterval(this._timer),this._timer=null)},i.prototype.didReceiveRecentActivities=function(){return this.getVersion().didReceiveRecentActivities()},i.prototype.componentDidUpdate=function(){this.hasRecentItems()&&p(this.logTimeToInteractive)},i.prototype.componentWillUnmount=function(){this.clearLoadNewItemsTimer(),p(this.removeStoreListeners),s.removeListener(this.onRoleUpdate)},i.prototype.createRenderingInfo=function(e,t){return{isUnityAvailable:null===t?this.state.renderingInfo.isUnityAvailable:t,version:this.getVersion(),role:null===e?this.state.role:e}},i.prototype.getRecentItems=function(e){var t=this.getUserId(e||this.state.role);return this.getVersion().getRecentItems(t,this.state.filter)},i.prototype.getCurrentUser=function(){return h.get_viewer().get_user_by_role(this.state.role)},i.prototype.getUserId=function(e){return h.get_viewer().get_user_by_role(e).id},i.prototype.getCurrentUserId=function(){return this.getCurrentUser().id},i.prototype.getVersion=function(){return this.props.version},i.prototype.renderBody=function(){return a.createElement(u.RecentActivityView,{items:this.state.items,filter:this.state.filter,isPending:this.state.isPending,userId:this.getCurrentUserId(),localDatetime:this.props.localDatetime,renderingInfo:this.state.renderingInfo})},i.prototype.render=function(){return this.getVersion().renderRecentActivityContainer(this.renderBody(),this.props.user,this.getCurrentUser())},i})(o.ReactPureLogger);_.displayName="RecentActivityContainer",_.defaultProps={initialRole:"personal"},t.RecentActivityContainer=_}),define("modules/clean/recent_activity/react/recent_activity_item_actions_view",["require","exports","tslib","external/classnames","external/react","modules/core/i18n","modules/clean/recent_activity/recent_activity_rendering_models","modules/clean/recent_activity/recent_activity_model"],function(e,t,n,i,r,a,o,s){"use strict";var c=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onOpen=function(e){e.preventDefault(),t.getHandler().handleOpen()},t.onDelete=function(e){e.preventDefault(),t.getHandler().handleDelete()},t.onArchive=function(e){e.preventDefault(),t.getHandler().handleArchive()},t.onSelectAll=function(e){e.preventDefault(),t.getHandler().handleSelectAll()},t.onDeselectAll=function(e){e.preventDefault(),t.getHandler().handleDeselectAll()},t.onDownload=function(e){e.preventDefault(),t.getHandler().handleDownload()},t.onComment=function(e){e.preventDefault(),t.getHandler().handleComment()},t.onVersions=function(e){e.preventDefault(),t.props.permissions.versions&&t.getHandler().handleVersions()},t}return n.__extends(t,e),t.prototype.getHandler=function(){return this.props.handler},t.prototype.canOpen=function(){return this.props.permissions.open&&this.props.renderingInfo.isUnityAvailable},t.prototype.canSelect=function(){var e=this.props;return e.attachmentCount>1&&e.selectCount>0&&e.selectCount<e.attachmentCount},t.prototype.canDeselect=function(){return this.props.attachmentCount>1&&this.props.selectCount>0},t.prototype.getDeleteLabel=function(){var e=this.props.selectCount;return e>1?a._("Delete (%(count)s)…").format({count:e}):0===e&&this.props.attachmentCount>1?a._("Delete all…"):a._("Delete…")},t.prototype.getDownloadLabel=function(){var e=this.props.selectCount;return e>1?a._("Download (%(count)s)").format({count:e}):a._("Download")},t.prototype.render=function(){if(this.props.renderingInfo.version.shouldRenderItemActions(this.props.permissions)){var e=i((t={},t["recents-item__more-actions"]=!0,t["recents-item__more-actions--disabled"]=this.props.disableActions,t));return s.isShareLinkEventType(this.props.type)?r.createElement("div",{className:e}):r.createElement("div",{className:e},this.props.renderingInfo.version.renderItemActionsPlaceholder(),r.createElement("div",{className:"recents-item__more-actions-button recents-item__action-button",tabIndex:-1},this.props.renderingInfo.version.renderMoreActionsElement(this)))}return null;var t},t})(r.PureComponent);c.defaultProps={handler:o.getStubRecentActivityItemContainerHandler(),tooltipHandler:o.getStubRecentActivityTooltipHandler(),selectCount:0,attachmentCount:1,disableActions:!1},t.RecentActivityItemActionsView=c}),define("modules/clean/recent_activity/react/recent_activity_item_container",["require","exports","tslib","external/underscore","external/react","modules/core/exception","modules/clean/react/home/home_access/recents/actions","modules/clean/recent_activity/actions/recent_activity_actions","modules/clean/recent_activity/react/recent_activity_item_view","modules/clean/recent_activity/recent_activity_logger_utils","modules/clean/recent_activity/recent_activity_model","modules/clean/recent_activity/stores/attachment_store","modules/clean/recent_activity/stores/selection_store","modules/clean/react_logger"],function(e,t,n,i,r,a,o,s,c,l,u,d,h,m){"use strict";var p=(function(e){function t(n){var i=e.call(this,t.displayName,n)||this;return i.onSelectionStoreChange=function(){i.setState({selectedAttachmentIds:h.selectionStore.getByRecentItemId(i.getRecentItemId())})},i.onAttachmentStoreChange=function(){i.setState({attachments:i.getAttachmentsFromStore()})},i.handleArchive=function(){i.getVersion().archiveRecentItem(i.getRecentItem(),i.getLogData()),i.clearSelection()},i.handleComment=function(){var e=i.getSingleAttachment("handleComment only supports a single attachment"),t=Math.max(0,i.getStateAttachments().indexOf(e));i.previewOrOpenFiles({index:t,shouldFocusCommentInput:!0})},i.handleDelete=function(){i.getVersion().deleteRecentItem(i.getRecentItem(),i.getSelectedAttachments(),i.getLogData()),i.clearSelection()},i.handleDeselectAll=function(){s.deselectAttachments(i.getRecentItemId(),i.getSelectedAttachmentIds())},i.handleDownload=function(){var e=i.getSingleAttachment("handleDownload only supports a single attachment");s.downloadFiles(i.getViewingUserId(),[e.id],i.getLogData())},i.handleHeaderClick=function(){if(i.isSubset()){var e=i.state.isCollapsed?"uncollapse":"collapse";o.HomeRecentsActions.logEvent(e,i,i.getStateAttachmentFqPaths(),i.getStateAttachments().length)}i.setState({isCollapsed:!i.state.isCollapsed})},i.handleOpen=function(){var e=i.getSingleAttachment("handleOpen only supports a single attachment");s.openFile(i.getViewingUserId(),e.id,i.getLogData())},i.handlePathClick=function(e){var t=i.getStateAttachmentFqPaths();l.logOpenPathUrl(i.getViewingUserId(),t,i.props.recentItem.attachmentIds.length,i),i.getVersion().handlePathClick(e,i.getRecentItem(),i.getLogData())},i.handlePreview=function(){i.previewOrOpenFiles({shouldFocusCommentInput:!1})},i.handleSelectAll=function(){var e=u.extractAttachmentIds(i.getStateAttachments());s.selectAttachments(i.getRecentItemId(),e)},i.handleShare=function(){i.getVersion().shareRecentItem(i.getRecentItem(),i.getSelectedAttachments(),i.getLogData())},i.handleToggleSelect=function(e,t){t?s.selectAttachments(i.getRecentItemId(),[e.id]):s.deselectAttachments(i.getRecentItemId(),[e.id])},i.handleVersions=function(){var e=i.getSingleAttachment("handleVersions only supports a single attachment");s.openVersions(i.getViewingUserId(),e.id,i.getLogData())},i.removeStoreListeners=null,i.state={attachments:[],selectedAttachmentIds:[],isCollapsed:!0},i}return n.__extends(t,e),t.prototype.getStateAttachments=function(){return this.state.attachments},t.prototype.getSelectedAttachmentIds=function(){return this.state.selectedAttachmentIds},t.prototype.getVersion=function(){return this.props.renderingInfo.version},t.prototype.isSubset=function(){return i.uniq(i.values(this.getRecentItem().filterTypesByKey)).length>1},t.prototype.getViewingUserId=function(){return this.props.recentItem.viewingUserId},t.prototype.getRecentItem=function(){return this.props.recentItem},t.prototype.getRecentItemId=function(){return this.props.recentItem.id},t.prototype.getLogData=function(){return{totalCount:this.props.recentItem.attachmentIds.length,cellView:this}},t.prototype.getStateAttachmentFqPaths=function(){return i.compact(i.pluck(this.getStateAttachments(),"fqPath"))},t.prototype.getAttachmentsFromStore=function(){return d.attachmentStore.getByIds(this.getRecentItem().attachmentIds)},t.prototype.getSelectedAttachments=function(){var e=this.getSelectedAttachmentIds();return e.length?this.getStateAttachments().filter(function(t){return e.indexOf(t.id)>=0}):this.getStateAttachments()},t.prototype.getSingleAttachment=function(e){var t=this.getSelectedAttachments();return a.assert(1===t.length,e),t[0]},t.prototype.previewOrOpenFiles=function(e){e.shouldBrowse=u.isShareLinkRecentItem(this.props.recentItem);var t=e.shouldBrowse?[this.getSingleAttachment("previewOrOpenFiles only supports a single shared link")]:this.getStateAttachments();this.getVersion().previewOrOpenRecentItem(this.getRecentItem(),t,e,this.getLogData())},t.prototype.clearSelection=function(){s.deselectAttachments(this.getRecentItemId(),this.getSelectedAttachmentIds())},t.prototype.componentWillMount=function(){e.prototype.componentWillMount.call(this);var t=h.selectionStore.addListener(this.onSelectionStoreChange),n=d.attachmentStore.addListener(this.onAttachmentStoreChange);this.removeStoreListeners=function(){t(),n()},this.setState({attachments:this.getAttachmentsFromStore(),selectedAttachmentIds:h.selectionStore.getByRecentItemId(this.getRecentItemId())})},t.prototype.componentWillUnmount=function(){this.removeStoreListeners&&this.removeStoreListeners()},t.prototype.render=function(){return r.createElement(c.RecentActivityItemView,{recentItem:this.getRecentItem(),attachments:this.getStateAttachments(),handler:this,isCollapsed:this.state.isCollapsed,selectedAttachmentIds:this.getSelectedAttachmentIds(),renderingInfo:this.props.renderingInfo})},t})(m.ReactPureLogger);p.displayName="RecentActivityItemContainer",t.RecentActivityItemContainer=p}),define("modules/clean/recent_activity/react/recent_activity_item_header_view",["require","exports","tslib","external/classnames","external/react","modules/clean/accessibility/utils","modules/clean/react/helpers","modules/clean/react/file_icon_view","modules/clean/recent_activity/recent_activity_model","modules/clean/recent_activity/recent_activity_view_helper","modules/clean/user_education/user_education_client"],function(e,t,n,i,r,a,o,s,c,l,u){"use strict";var d=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onClick=function(e){e.stopPropagation(),e.preventDefault(),t.props.handleClick(e)},t.shouldComponentUpdate=o.compareStateAndProps,t}return n.__extends(t,e),t.prototype.getHeaderProps=function(){return this.props.header},t.prototype.renderIcon=function(){var e=this.getHeaderProps();return r.createElement("div",{className:"recents-item__icon"},r.createElement(s,{icon:e.icon,className:"recents-item__img",src:e.thumbnailUrl}))},t.prototype.renderHeading=function(){return r.createElement("a",n.__assign({ref:"heading",className:"recents-item__heading"},a.accessibleTriggerProps(this.props.handleClick)),this.getHeaderProps().heading)},t.prototype.renderSubheading=function(){var e=this.getHeaderProps().subheading;return e?r.createElement("div",{ref:"subheading",className:"recents-item__subheading"},e):null},t.prototype.renderDetails=function(){return r.createElement("div",{ref:"recentsItemDetails",className:"recents-item__details"},r.createElement("div",{className:"recents-item__heading-group"},this.renderHeading(),this.renderStar()),this.renderSubheading())},t.prototype.renderStar=function(){var e=this.getHeaderProps().star,t=i((n={},n.item__star=!0,n["item__star--onboarding"]=this.props.onboardingItem,n));return e?r.createElement("div",{className:t},r.createElement(u.UserEducationEffect,{containerName:"RecentActivityItemHeaderView",name:"recent-item-star-"+this.props.onboardingItem},e)):null;var n},t.prototype.renderActions=function(){if(this.props.recentActivityType&&c.isShareLinkEventType(this.props.recentActivityType)||0===r.Children.count(this.props.children))return null;var e=i((t={},t["recents-item__actions-inner"]=!0,t["recents-item__actions-inner--tooltip-shown"]=this.props.tooltipShown,t));return r.createElement("div",{ref:"actions",className:"recents-item__actions"},r.createElement("div",{className:e},this.props.children));var t},t.prototype.renderOnboardingSpotlight=function(){return this.props.onboardingItem?r.createElement(u.UserEducationEffect,{containerName:"RecentActivityItemHeaderView",name:"recent-item-spotlight"}):null},t.prototype.render=function(){return r.createElement("div",{className:"recents-item__wrapper",onClick:l.ensureUserIntentToClick(this.onClick)},this.renderIcon(),this.renderOnboardingSpotlight(),this.renderDetails(),this.renderActions())},t})(r.PureComponent);d.defaultProps={handleClick:function(e){return null},tooltipShown:!1},t.RecentActivityItemHeaderView=d}),define("modules/clean/recent_activity/react/recent_activity_item_view",["require","exports","tslib","external/underscore","external/classnames","external/react","modules/core/i18n","modules/clean/em_string","modules/clean/react/file_path_breadcrumb","modules/clean/react/helpers","modules/clean/recent_activity/actions/recent_activity_action_permissions","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_view_models","modules/clean/recent_activity/recent_activity_model","modules/clean/recent_activity/recent_activity_rendering_models","modules/clean/recent_activity/recent_activity_view_helper","modules/clean/recent_activity/recent_activity_text_helper","modules/clean/recent_activity/react/attachment_list_view","modules/clean/recent_activity/react/comment_attachment_view","modules/clean/recent_activity/react/pending_attachment_list_view","modules/clean/recent_activity/react/recent_activity_item_header_view","modules/clean/recent_activity/react/recent_activity_item_actions_view","modules/clean/recent_activity/react/doc_attachment_list_view","modules/clean/react_logger"],function(e,t,n,i,r,a,o,s,c,l,u,d,h,m,p,_,f,g,v,y,I,E,A,R){"use strict";var w=(function(e){function t(n){var i=e.call(this,t.displayName,n)||this;return i.onDisabled=function(e){e.preventDefault()},i.handleBlur=function(){i.setState({isFocused:!1})},i.handleFocus=function(){i.setState({isFocused:!0})},i.handleMouseEnter=function(){i.setState({isHovered:!0})},i.handleMouseLeave=function(){i.setState({isHovered:!1})},i.onShare=function(e){e.preventDefault(),i.getHandler().handleShare()},i.onSelectAll=function(e){e.preventDefault(),i.getHandler().handleSelectAll()},i.onShowTooltip=function(){i.setState({tooltipShown:!0})},i.onHideTooltip=function(){i.setState({tooltipShown:!1})},i.shouldComponentUpdate=l.compareStateAndProps,i.state={tooltipShown:!1,isFocused:!1,isHovered:!1},i}return n.__extends(t,e),t.prototype.getRecentItem=function(){return this.props.recentItem},t.prototype.getAttachments=function(){return this.props.attachments},t.prototype.getHandler=function(){return this.props.handler},t.prototype.getSelectedAttachmentIds=function(){return this.props.selectedAttachmentIds},t.prototype.shouldDisableActions=function(){var e=this.getRecentItem().federatedRecentItem;return e?!e.hasMenuActions():!this.hasLoadedAttachments()},t.prototype.isAggregation=function(){return this.props.recentItem.attachmentIds.length>1},t.prototype.shouldShowComment=function(){var e=this.getAttachments()[0];return!(!e||!e.commentRawText)},t.prototype.shouldShowThumbnails=function(){return!m.isShareLinkRecentItem(this.props.recentItem)&&h.shouldShowThumbnails(this.getRecentItem().filterTypesByKey)},t.prototype.getLoadedAttachmentsCount=function(){return this.getAttachments().filter(function(e){return e.isLoaded}).length},t.prototype.canRenderAttachmentView=function(){var e=this.getLoadedAttachmentsCount();return e===this.getRecentItem().attachmentIds.length||e>=d.MAX_INITIAL_THUMBNAIL_ATTACHMENTS},t.prototype.hasLoadedAttachments=function(){return!(!this.getAttachments().length||!this.getLoadedAttachmentsCount())},t.prototype.getHeading=function(){var e=this.getAttachments();if(e.length<2)return s.em_snippet(this.getRecentItem().displayName,30);for(var t=this.getRecentItem(),n=t.attachmentIds.length,r=i.uniq(i.values(t.filterTypesByKey)),a=[],c=0,l=e;c<l.length;c++){var u=l[c];u.isLoaded&&u.displayName&&a.push(u.displayName)}switch(r.length){case 1:switch(r[0]){case d.RECENT_EVENT_FILTER_TYPE.PHOTOS:return o.ungettext("%(count)s image","%(count)s images",n).format({count:n});case d.RECENT_EVENT_FILTER_TYPE.VIDEOS:return o.ungettext("%(count)s video","%(count)s videos",n).format({count:n});case d.RECENT_EVENT_FILTER_TYPE.VISUAL_NOTES:return o.ungettext("%(count)s visual note","%(count)s visual notes",n).format({count:n})}break;case 2:if(r.indexOf(d.RECENT_EVENT_FILTER_TYPE.PHOTOS)>=0&&r.indexOf(d.RECENT_EVENT_FILTER_TYPE.VIDEOS)>=0)return o._("%(count)s images and videos").format({count:n})}return a.length?f.snippetList(a,30,{totalCount:n}):o.ungettext("%(count)s file","%(count)s files",n).format({count:n})},t.prototype.getSubheading=function(){var e=this.getRecentItem();return m.isShareLinkRecentItem(this.props.recentItem)?e.type===d.RECENT_EVENT_TYPES.FILE_SHARED_ADD?a.createElement("a",{className:"recents-item__subheading-path",href:"/links/your_links",onClick:this.getHandler().handlePathClick},o._("Your links")):a.createElement("div",{className:"recents-item__subheading"},a.createElement("span",{className:"recents-item__subheading-path"},o._("Recently viewed"))):e.paths.length?a.createElement(c,{handlePathClick:this.getHandler().handlePathClick,paths:e.paths,viewingUserId:e.viewingUserId}):null},t.prototype.getIcon=function(){var e=this.getRecentItem(),t=e.icon+"_32";if(e.attachmentIds.length>1){for(var n=0,i=this.getAttachments();n<i.length;n++){var r=i[n];if(r.previewInfo){t=r.previewInfo.icon;break}}t=t.replace(/_32$/,"_stack_32")}return t},t.prototype.getThumbnailUrl=function(){var e=this.getAttachments();return 1===e.length&&e[0].thumbnailUrl||void 0},t.prototype.renderShareButton=function(){var e=this.props.renderingInfo.version.getShareButtonVisibility(this.getRecentItem(),this.hasLoadedAttachments());if(e!==d.RecentElementVisibilities.HIDDEN){var t=r({disabled:e===d.RecentElementVisibilities.DISABLED,"button-secondary":!0,"recents-item__share-link":!0});return a.createElement("a",{ref:"shareLink",className:t,href:"#share",onClick:e===d.RecentElementVisibilities.SHOWN?this.onShare:this.onDisabled},o._("Share"))}return null},t.prototype.renderAttachments=function(){return this.shouldShowThumbnails()?this.canRenderAttachmentView()?a.createElement(g.AttachmentListView,{ref:"attachments",attachments:this.getAttachments(),handleToggleSelect:this.getHandler().handleToggleSelect,selectedAttachmentIds:this.getSelectedAttachmentIds()
}):a.createElement(y.PendingAttachmentListView,{ref:"pendingAttachments",count:this.getRecentItem().attachmentIds.length}):this.isAggregation()?a.createElement(A.DocAttachmentListView,{ref:"docAttachments",recentItem:this.getRecentItem(),attachments:this.getAttachments(),isCollapsed:this.props.isCollapsed,renderingInfo:this.props.renderingInfo}):this.shouldShowComment()?a.createElement(v.CommentAttachmentView,{ref:"commentAttachment",attachment:this.getAttachments()[0],handlePreview:this.getHandler().handlePreview}):null},t.prototype.renderActions=function(e){return a.createElement(E.RecentActivityItemActionsView,{ref:"recentsItemActionsView",handler:this.getHandler(),tooltipHandler:this,type:this.getRecentItem().type,permissions:e,selectCount:this.getSelectedAttachmentIds().length,attachmentCount:this.getRecentItem().attachmentIds.length,disableActions:this.shouldDisableActions(),rowIsHovered:this.state.isHovered,renderingInfo:this.props.renderingInfo})},t.prototype.renderButton=function(e){var t=this.shouldDisableActions(),n=this.props.renderingInfo.version.maybeRenderSelectAllButton(this.shouldShowThumbnails(),this.getRecentItem(),this.getSelectedAttachmentIds(),t?this.onDisabled:this.onSelectAll,t);return n?n:e.share?a.createElement("div",{className:"recents-item__sharing recents-item__action-button"},this.renderShareButton()):null},t.prototype.getHeaderProps=function(){return{heading:this.getHeading(),subheading:this.getSubheading(),icon:this.getIcon(),thumbnailUrl:this.getThumbnailUrl(),star:this.props.renderingInfo.version.renderStar(this.props.renderingInfo.role,this.getRecentItem())}},t.prototype.renderHeader=function(){var e=u.getRecentActivityItemViewPermissions(this.getRecentItem(),this.getAttachments(),this.getSelectedAttachmentIds());return a.createElement(I.RecentActivityItemHeaderView,{ref:"header",header:this.getHeaderProps(),handleClick:this.isAggregation()?this.getHandler().handleHeaderClick:this.getHandler().handlePreview,tooltipShown:this.state.tooltipShown,recentActivityType:this.getRecentItem().type,onboardingItem:this.getRecentItem().onboardingItem},this.renderButton(e),this.renderActions(e))},t.prototype.render=function(){var e=r((i={},i["recents-item"]=!0,i["recents-item--focused-in"]=this.state.isFocused,i["recents-item--loaded"]=this.hasLoadedAttachments(),i)),t=this.shouldShowThumbnails()||!this.isAggregation()?_.ensureUserIntentToClick(this.getHandler().handlePreview):void 0,n=this.getRecentItem();return a.createElement("li",{"data-item-id":n.id,"data-item-type":n.type,"data-item-date":n.when,className:e,onClick:t,onBlur:this.handleBlur,onFocus:this.handleFocus,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave},this.renderHeader(),this.renderAttachments());var i},t})(R.ReactPureLogger);w.displayName="RecentActivityItemView",w.defaultProps={handler:p.getStubRecentActivityItemContainerHandler(),isCollapsed:!0,attachments:[],selectedAttachmentIds:[]},t.RecentActivityItemView=w}),define("modules/clean/recent_activity/react/recent_activity_list_view",["require","exports","tslib","external/classnames","external/react","modules/clean/react_logger","modules/clean/recent_activity/react/recent_activity_item_container"],function(e,t,n,i,r,a,o){"use strict";var s=(function(e){function t(t){return e.call(this,"RecentActivityListView",t)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this.props.renderingInfo,t=this.props.items.map(function(t){return r.createElement(o.RecentActivityItemContainer,{key:t.id,recentItem:t,renderingInfo:e})});return r.createElement("ul",{className:i({"recents-list":!0,"recents-list--is-pending":this.props.isPending&&0===t.length})},t)},t})(a.ReactLogger);t.RecentActivityListView=s}),define("modules/clean/recent_activity/react/recent_activity_sections_view",["require","exports","tslib","external/react","external/underscore","modules/clean/datetime","modules/clean/react_logger","modules/clean/recent_activity/react/recent_activity_list_view","modules/core/i18n"],function(e,t,n,i,r,a,o,s,c){"use strict";var l={today:c._("Today"),yesterday:c._("Yesterday"),thisWeek:c._("This week"),lastWeek:c._("Last week"),thisMonth:c._("This month"),lastMonth:c._("Last month"),lastThreeMonths:c._("Three months ago"),beforeLastThreeMonths:c._("Older")},u=(function(e){function t(t){var n=e.call(this,"RecentActivitySectionsView",t)||this;return n.state={promptBannerIsVisible:!1},n}return n.__extends(t,e),t.prototype.componentDidMount=function(){document.querySelector(".has-top-notification")&&this.setState({promptBannerIsVisible:!0}),e.prototype.componentDidMount.call(this)},t.prototype.getSections=function(){var e=a.getTimeBands(Date.parse(this.props.localDatetime));return r.groupBy(this.props.items,function(t){var n=t.when;return n>=e.today?"today":n>=e.yesterday?"yesterday":n>=e.thisWeek?"thisWeek":n>=e.lastWeek?"lastWeek":n>=e.thisMonth?"thisMonth":n>=e.lastMonth?"lastMonth":n>=e.lastThreeMonths?"lastThreeMonths":"beforeLastThreeMonths"})},t.prototype.render=function(){var e=this,t=this.getSections(),n=96;this.state.promptBannerIsVisible&&(n+=48);var r=this.props.renderingInfo,a=Object.keys(t).map(function(a){var o=t[a],c=i.createElement("h2",{className:"recents-section__title"},l[a]),u=i.createElement(s.RecentActivityListView,{items:o,isPending:e.props.isPending,renderingInfo:r});return r.version.renderSection(a,n,40,c,u)});return i.createElement("ul",{className:"recents-view__sections"},a)},t})(o.ReactLogger);u.defaultProps={localDatetime:Date.now().toString()},t.RecentActivitySectionsView=u}),define("modules/clean/recent_activity/react/recent_activity_view",["require","exports","tslib","external/classnames","external/react","modules/clean/components/loading_indicator","modules/clean/react_logger","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/react/recent_activity_sections_view"],function(e,t,n,i,r,a,o,s,c){"use strict";var l=(function(e){function t(n){return e.call(this,t.displayName,n)||this}return n.__extends(t,e),t.prototype.renderLoadingView=function(){return r.createElement("div",{className:"recents-loading-view",key:"loading"},r.createElement(a,{style:a.LoadingIndicatorStyle.BLUE_SPINNER,className:"recents-loading-indicator"}))},t.prototype.renderSectionView=function(){return r.createElement(c.RecentActivitySectionsView,{key:"sections",items:this.props.items,isPending:this.props.isPending,localDatetime:this.props.localDatetime,renderingInfo:this.props.renderingInfo})},t.prototype.renderPendingContent=function(){return[this.renderLoadingView(),this.renderSectionView()]},t.prototype.renderBlankSlateContent=function(){return[this.props.renderingInfo.version.renderEmptyState(this.props.filter)]},t.prototype.renderLoadedContent=function(){return[this.renderSectionView(),this.props.isPending?this.renderLoadingView():null]},t.prototype.renderContent=function(){return this.props.items.length?this.renderLoadedContent():this.props.isPending?this.renderPendingContent():this.renderBlankSlateContent()},t.prototype.render=function(){var e=i({"recents-view":!0,"recents-view--is-pending":this.props.isPending&&0===this.props.items.length});return r.createElement("div",{className:e},this.renderContent())},t})(o.ReactPureLogger);l.displayName="RecentActivityView",l.defaultProps={filter:s.RECENT_EVENT_FILTER_TYPE.ALL,isPending:!1},t.RecentActivityView=l}),define("modules/clean/recent_activity/react/selectable_view",["require","exports","tslib","external/react","modules/clean/accessibility/utils","modules/clean/react/sprite","modules/core/i18n"],function(e,t,n,i,r,a,o){"use strict";var s=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handletoggleSelected=function(e){e.preventDefault(),e.stopPropagation(),t.props.handleToggleSelect(t.props.id,!t.props.isSelected)},t}return n.__extends(t,e),t.prototype.render=function(){var e=this.props.isSelected?o._("Deselect"):o._("Select");return i.createElement("a",n.__assign({},r.accessibleTriggerProps(this.handletoggleSelected),{className:"attachment-item__checkmark"}),i.createElement("span",{className:"attachment-item__checkmark-inner"},i.createElement(a,{group:"web",name:"white_check",alt:e})))},t})(i.PureComponent);s.defaultProps={isSelected:!1,handleToggleSelect:function(){}},t.SelectableView=s}),define("modules/clean/recent_activity/recent_activity_client",["require","exports","tslib","jquery","external/underscore","modules/clean/ajax","modules/constants/python","modules/core/exception","external/tracekit"],function(e,t,n,i,r,a,o,s,c){"use strict";function l(e,t){return function(n){"ok"===n.status?t(n.payload):e.reject(new Error("Payload not okay: "+n))}}function u(e){return"    "+e}function d(e){return e.split("\n").map(u).join("\n")}function h(e,t){return function(n,i,r){var a="\n      Failed XHR request for "+t+":\n      Exception: "+(r.stack?r:"")+"\n      Response Status: "+JSON.stringify(n.status)+" "+n.statusText+"\n      Response Headers:\n"+d(n.getAllResponseHeaders()||"[No Headers]")+"\n      Response Body:\n"+d(n.responseText?"[No Body]":"")+"\n      ";if("abort"!==i){var o=[],l=c.computeStackTrace(r);l&&l.stack&&(o=l.stack),s._reportException({msg:a,tags:["recents"],severity:r instanceof Error?s.SEVERITY.CRITICAL:s.SEVERITY.NONCRITICAL,stack:o})}e.reject(new R(a,n))}}function m(e){return function(t,n,i){if("abort"!==n)throw new Error("Failed XHR request for "+e+": "+i)}}function p(e){return e?a.SilentBackgroundRequest:a.WebRequest}function _(e,t){void 0===t&&(t={});var n=i.Deferred();return p(t.isBackgroundRequest)({url:"/recents/json",type:"POST",subject_user:e,data:{num_activities:20,cursor:t.cursor},dataType:"json",success:l(n,function(e){n.resolve({recentActivities:e.recent_activities,cursor:e.cursor,encrypted:e.encrypted})}),error:h(n,"/recents/json")}),n.promise()}function f(e,t,n){void 0===n&&(n=!1);var r=i.Deferred();return p(n)({url:"/home_feed/retrieve_paper_recents",type:"POST",subject_user:e,data:{is_initial_fetch:t},dataType:"json",success:l(r,function(e){r.resolve({items:e.items,hasMore:e.has_more})}),error:h(r,"/home_feed/retrieve_paper_recents")}),r.promise()}function g(e,t,n){var o=i.Deferred();return a.SilentBackgroundRequest({url:"/activity/generate/json",type:"POST",subject_user:e,data:{activity_keys:JSON.stringify(r.unique(t)),loading_modes:JSON.stringify([A.PREVIEW_INFO]),encrypted:n},dataType:"json",success:l(o,function(e){o.resolve(e.activities_by_activity_key)}),error:h(o,"/activity/generate/json")}),o.promise()}function v(e,t){a.SilentBackgroundRequest({url:"/recents/logger",type:"POST",subject_user:e,data:t,error:m("/recents/logger")})}function y(e,t){var n=i.Deferred();return a.WebRequest({url:"/recents/check_files_in_root_collection",type:"POST",subject_user:e,data:{files_json:JSON.stringify(t)},dataType:"json",success:l(n,function(e){n.resolve({fileInRootCollectionInfo:e.file_in_root_collection_info})}),error:h(n,"/recents/check_files_in_root_collection")}),n.promise()}function I(e,t){var n=i.Deferred();return a.WebRequest({url:"/home_feed/archive_paper_resources",type:"POST",subject_user:e,data:{resources_json:JSON.stringify(t)},dataType:"json",success:l(n,function(e){return n.resolve(e)}),error:h(n,"/home_feed/archive_paper_resources")}),n.promise()}function E(e,t){var n=i.Deferred();return a.WebRequest({url:"/recents/create_collection_shared_link",type:"POST",subject_user:e,data:{files_json:JSON.stringify(t)},dataType:"json",success:l(n,function(e){n.resolve({link:e.link,tkey:e.tkey,shareableItemCount:e.shareable_item_count})}),error:h(n,"/recents/create_collection_shared_link")}),n.promise()}var A=o.FILE_ACTIVITY_LOADING_MODE,R=(function(e){function t(t,n){var i=e.call(this,t)||this;return i.xhr=n,i}return n.__extends(t,e),t})(Error);t.fetchRecentActivities=_,t.fetchPaperRecents=f,t.fetchActivitiesByKey=g,t.postLogEvent=v,t.checkFileInRootCollection=y,t.archivePaperResources=I,t.createCollectionSharedLink=E}),define("modules/clean/recent_activity/recent_activity_constants",["require","exports","modules/constants/python"],function(e,t,n){"use strict";t.RECENT_EVENT_TYPES=n.RECENT_EVENT_TYPES,t.RECENT_EVENT_FILTER_TYPE=n.RECENT_EVENT_FILTER_TYPE,t.RECENT_CREATE_FILTER="createFilter",t.ARCHIVE_PAPER_DOCUMENT_COMMIT="ARCHIVE_PAPER_DOCUMENT_COMMIT",t.ARCHIVE_PAPER_DOCUMENT_PENDING="ARCHIVE_PAPER_DOCUMENT_PENDING",t.ARCHIVE_PAPER_DOCUMENT_ROLLBACK="ARCHIVE_PAPER_DOCUMENT_ROLLBACK",t.DELETE_FILES_COMMIT="DELETE_FILES_COMMIT",t.DELETE_FILES_PENDING="DELETE_FILES_PENDING",t.DELETE_FILES_ROLLBACK="DELETE_FILES_ROLLBACK",t.DESELECT_ATTACHMENTS="DESELECT_ATTACHMENTS",t.RAW_RECENT_ACTIVITY_PARSE_ERROR="RAW_RECENT_ACTIVITY_PARSE_ERROR",t.RAW_RELATED_ACTIVITY_PARSE_ERROR="RAW_RELATED_ACTIVITY_PARSE_ERROR",t.RECEIVE_CAN_OPEN_INFO="RECEIVE_CAN_OPEN_INFO",t.RECEIVE_FILE_IN_ROOT_COLLECTION_INFO="RECEIVE_FILE_IN_ROOT_COLLECTION_INFO",t.RECEIVE_PAPER_RECENT_ITEMS="RECEIVE_PAPER_RECENT_ITEMS",t.RECEIVE_RAW_RECENT_ACTIVITIES="RECEIVE_RAW_RECENT_ACTIVITIES",t.RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY="RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY",t.SELECT_ATTACHMENTS="SELECT_ATTACHMENTS",t.MAX_INITIAL_DOC_ATTACHMENTS=3,t.SHOW_MORE_DOC_ATTACHMENT_INCREMENT=10,t.MAX_INITIAL_THUMBNAIL_ATTACHMENTS=8,t.SHOW_MORE_THUMBNAIL_ROW_INCREMENT=4,t.PaperRecentItemTypes={DOCUMENT:"DOCUMENT",FOLDER:"FOLDER",PROJECT:"PROJECT"},t.MAX_RECENT_ITEM_COUNT_ON_RECENTS_V2=100,t.FederatedOrigins={PAPER:"PAPER"},t.RecentElementVisibilities={SHOWN:"SHOWN",HIDDEN:"HIDDEN",DISABLED:"DISABLED"}}),define("modules/clean/recent_activity/recent_activity_dispatcher",["require","exports","external/flux"],function(e,t,n){"use strict";t.recentActivityDispatcher=new n.Dispatcher}),define("modules/clean/recent_activity/recent_activity_logger",["require","exports","tslib","external/underscore","modules/clean/recent_activity/recent_activity_client","modules/core/exception"],function(e,t,n,i,r,a){"use strict";function o(e,t,i){if(void 0===i&&(i={}),E){var a=n.__assign({},i,{event_name:t});r.postLogEvent(e,a)}}function s(e,t,n){var r=i.keys(n),o=i.difference(r,t);a.assert(0===o.length,e+" called with unsupported keys: "+o)}function c(){E=!0}function l(){E=!1}function u(){return E}function d(e,t){s("logPageLoaded",f,t),o(e,"client_page_loaded",t)}function h(e,t){s("logRequestFailed",g,t),o(e,"request_failed",t)}function m(e,t){s("logCellAction",v,t),o(e,"cell_action",t)}function p(e,t){s("logTimeToFirstAction",y,t),o(e,"time_to_first_action",t)}function _(e,t){s("logOnboardingAction",I,t),o(e,"onboarding_action",t)}t.ActionScopes={SINGLE:"single",SUBSET:"subset",AGGREGATION:"aggregation"},t.ActionTypes={VIEW_FILE:"view",OPEN:"open",SHARE:"share",SHARE_COLLECTION:"share_collection",DELETE:"delete",HIDE:"hide",UNITY_OPEN:"unity_open",OPEN_DIR:"open_dir",OPEN_PATH:"open_path",REPORT_JUNK:"report_junk",COMMENT:"comment",DOWNLOAD:"download",VERSIONS:"versions",VIEW_SHARED_LINK:"view_shared_link",PAPER_ARCHIVE:"paper_archive",PAPER_OPEN:"paper_open",PAPER_SHARE:"paper_share"},t.FilterViews={EVERYTHING:"everything"};var f=["is_full_page","item_count","contains_aggregation","latency","is_paginated"],g=["failure_type","is_paginated"],v=["in_aggregation","filter_view","action_type","target_activity_type","action_scope","position","file_extension","days_ago"],y=["latency","action_type","action_scope"],I=["action_type"],E=!0;t.enableLogging=c,t.disableLogging=l,t.isLoggingEnabled=u,t.logPageLoaded=d,t.logRequestFailed=h,t.logCellAction=m,t.logTimeToFirstAction=p,t.logOnboardingAction=_}),define("modules/clean/recent_activity/recent_activity_logger_utils",["require","exports","tslib","external/react-dom","external/underscore","jquery","modules/clean/recent_activity/recent_activity_logger","modules/clean/web_timing_logger"],function(e,t,n,i,r,a,o,s){"use strict";function c(e){return Math.floor((Date.now()-e)/864e5)}function l(e,t,n,s,l){var d,h=a(i.findDOMNode(l)),m=h.closest(".recents-item"),p=r.uniq(r.map(n,function(e){return null!=e?e.split(".").pop().toLowerCase():void 0})).filter(Boolean),_=s>1;d=1===s?E.SINGLE:n.length===s?E.AGGREGATION:E.SUBSET;var f={in_aggregation:_,filter_view:y.EVERYTHING,action_type:e,action_scope:d,target_activity_type:m.data("item-type"),position:m.prevAll().length,file_extension:p.join(","),days_ago:c(m.data("item-date"))};o.logCellAction(t,f),u(t,r.pick(f,"action_scope","action_type"))}function u(e,t){if(!A){var i=s.start_time();i&&(A=!0,o.logTimeToFirstAction(e,n.__assign({},t,{latency:Date.now()-i})))}}function d(e){return function(t,n,i,r){l(e,t,n,i,r)}}function h(e){return function(t,n,i,r){return d(e)(t,[n],i,r)}}function m(e){o.logOnboardingAction(e,{action_type:"onboarding_dismissed"})}function p(e){o.logOnboardingAction(e,{action_type:"full_onboarding_opened"})}function _(e){o.logOnboardingAction(e,{action_type:"full_onboarding_dismissed"})}function f(e,t){o.logRequestFailed(e,{failure_type:t.status,is_paginated:!1})}function g(){var e=Date.now(),t=!1;if(!R){var i=s.start_time();i&&(t=!0,e=i,R=!0)}return function(i,r){void 0===r&&(r={});var a=n.__assign({is_full_page:t},r,{latency:Date.now()-e});o.logPageLoaded(i,a)}}function v(){R=A=!1}var y=o.FilterViews,I=o.ActionTypes,E=o.ActionScopes,A=!1,R=!1;t.logShareFile=h(I.SHARE),t.logShareCollection=d(I.SHARE_COLLECTION),t.logPreviewFiles=d(I.VIEW_FILE),t.logDeleteFiles=d(I.DELETE),t.logUnityOpenFile=h(I.UNITY_OPEN),t.logOpenPathUrl=d(I.OPEN_DIR),t.logOpenSharedLinkUrl=d(I.VIEW_SHARED_LINK),t.logCommentFile=h(I.COMMENT),t.logDownloadFile=d(I.DOWNLOAD),t.logOpenVersions=h(I.VERSIONS),t.logOnboardingClosed=m,t.logOnboardingLearnMore=p,t.logOnboardingModalClosed=_,t.logRequestFailed=f,t.startRequestTimer=g,t.reset=v}),define("modules/clean/recent_activity/recent_activity_model",["require","exports","modules/clean/recent_activity/recent_activity_constants"],function(e,t,n){"use strict";function i(e){return e.map(function(e){return e.id})}function r(e){return e in o}function a(e){return r(e.type)}t.extractAttachmentIds=i;var o=(s={},s[n.RECENT_EVENT_TYPES.FILE_SHARED_ADD]=!0,s[n.RECENT_EVENT_TYPES.FILE_SHARED_VIEW]=!0,s);t.isShareLinkEventType=r,t.isShareLinkRecentItem=a;var s}),define("modules/clean/recent_activity/recent_activity_rendering_models",["require","exports"],function(e,t){"use strict";function n(){return{handleArchive:function(){},handleComment:function(){},handleDelete:function(){},handleDeselectAll:function(){},handleDownload:function(){},handleHeaderClick:function(){},handleOpen:function(){},handlePathClick:function(){},handlePreview:function(){},handleSelectAll:function(){},handleShare:function(){},handleToggleSelect:function(e,t){},handleVersions:function(){}}}function i(){return{onShowTooltip:function(){},onHideTooltip:function(){}}}t.getStubRecentActivityItemContainerHandler=n,t.getStubRecentActivityTooltipHandler=i}),define("modules/clean/recent_activity/recent_activity_text_helper",["require","exports","modules/clean/em_string","modules/core/i18n"],function(e,t,n,i){"use strict";function r(e,t){return i.ungettext("%(name)s and %(num)s other","%(name)s and %(num)s others",t).format({name:e,num:t})}function a(e,t,a){void 0===a&&(a={});var o=Math.max(Math.floor(a.totalCount||0),e.length);if(1===o)return n.em_snippet(e[0],t);var s=e[0],c=o-1,l=r(s,c);if(new n(l).length>t){var u=Math.floor(t-new n(r("",c)).length)-1;l=u<3?i.ungettext("%(num)s other","%(num)s others",o).format({num:o}):r(n.em_snippet(s,u),c)}for(var d="",h=1;h<e.length&&(h+=1,d=e.slice(0,h).join(", "),h<o&&(d=r(d,o-h)),new n(d).length<t);)l=d;return l}t.snippetList=a}),define("modules/clean/recent_activity/recent_activity_view_helper",["require","exports"],function(e,t){"use strict";function n(e){return function(t){if(!window.getSelection().toString()){for(var n=t.target;n&&n.parentNode&&n!==t.currentTarget;){if(["a","button"].includes(n.nodeName.toLowerCase()))return;n=n.parentNode}e.apply(this,arguments)}}}t.ensureUserIntentToClick=n}),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/recent_activity/recent_activity_view_models",["external/underscore","external/react","external/immutable","modules/clean/browse_interface","modules/clean/recent_activity/recent_activity_constants","modules/clean/viewer"],function(t,n,i,r,a,o){var s,c,l,u,d,h,m,p,_,f,g;return u=a.RECENT_EVENT_FILTER_TYPE,l=n.PropTypes,s=l.shape({id:l.string.isRequired,isLoaded:l.bool.isRequired,viewingUserId:l.number.isRequired,displayName:l.string,entityUri:l.string,previewInfo:l.object,fqPath:l.string,nsPath:l.string,nsId:l.number,thumbnailUrl:l.string,thumbnailDimensions:l.object,canOpen:l.bool,inRootCollection:l.bool,isReadOnly:l.bool,isDir:l.bool,commentRawText:l.string,commenterId:l.number,commenterDisplayName:l.string,commenterPhotoUrl:l.string}),d=i.Record({id:null,type:null,icon:null,when:null,viewingUserId:null,displayName:null,accountDisplayName:null,contextDisplayName:null,filterTypesByKey:{},attachmentIds:i.List(),paths:i.List(),order:null,resourceId:"",idType:""},"RecentItemRecord"),d.PropTypes=l.shape({id:l.string.isRequired,type:l.number.isRequired,icon:l.string.isRequired,when:l.number.isRequired,viewingUserId:l.number.isRequired,displayName:l.string.isRequired,accountDisplayName:l.string.isRequired,contextDisplayName:l.string.isRequired,filterTypesByKey:l.object.isRequired,attachmentIds:l.arrayOf(l.string).isRequired,paths:l.arrayOf(l.object).isRequired,order:l.number.isRequired,resourceId:l.string,idType:l.string}),c=i.Record({name:null,url:null},"PathRecord"),i.Record({width:null,height:null},"SizeRecord"),h=0,m=t.memoize(function(e){return h+=1}),p=function(e){var t,n;return n=e.skeleton_data,t=e.activity_key,new d({id:t,type:e.recent_event_type,icon:n.icon,when:e.when_milli,viewingUserId:e.viewing_user.id,displayName:n.display_name,accountDisplayName:n.account_display_name,contextDisplayName:n.context_display_name,filterTypesByKey:Object.freeze(n.filter_types_by_key),attachmentIds:i.List(e.related_activity_keys),idType:e.id_type,resourceId:e.resource_id,paths:f(n.context_display_path,e.viewing_user.id,{isDir:!0}),order:m(t)})},_=function(e){return new d(e).toJS()},f=function(e,n,a){var s,l,u,d,h,m,p;for(null==a&&(a={}),p=o.get_viewer(),m=p.get_user_by_id(n),"/"===e&&(e=""),h=[],d=e.split("/"),a.isDir!==!0&&d.pop();d.length;)u=t.last(d),l=d.join("/"),1===d.length&&""===u&&(u=o.get_root_name(m),l=""),s=r.browse_uri_for_fq_path(m,l).toString(),h.push(new c({name:u,url:s})),d.pop();return i.List(h.reverse())},g=function(n){var i,r,a,o,s,c;return s=t.uniq(t.values(n)),i=u.PHOTOS,a=u.VIDEOS,o=u.VISUAL_NOTES,r=[i,a,o],c=function(t){return e.call(r,t)>=0},t.all(s,c)&&t.size(n)>1},{createRecentItemJs:_,convertRecentActivityToRecentItem:p,shouldShowThumbnails:g,getPathsByFqPath:f,PropTypes:{recentItem:d.PropTypes,attachment:s}}})}.call(this),define("modules/clean/recent_activity/store_utils",["require","exports","jquery","external/underscore","modules/core/i18n","modules/clean/recent_activity/stores/attachment_store","modules/clean/web_timing_logger","modules/core/notify","modules/clean/recent_activity/recent_activity_dispatcher","modules/clean/recent_activity/recent_activity_logger_utils","modules/clean/recent_activity/recent_activity_client","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_view_models"],function(e,t,n,i,r,a,o,s,c,l,u,d,h){"use strict";function m(e,t){return void 0===t&&(t={}),p(u.fetchRecentActivities(e,t),e,t.cursor)}function p(e,t,n){var i=l.startRequestTimer(),r=e.then(function(e){return f(t,e)}).then(function(){},_(t));return e.then(function(e){return r.then(function(){var r=!1,a=0;e.recentActivities.forEach(function(e){e.skeleton_data&&(a+=e.skeleton_data.num_related_activities||0,(e.skeleton_data.num_related_activities||0)>1&&(r=!0))}),i(t,{is_paginated:!!n,contains_aggregation:r,item_count:a})})})}function _(e){return function(t){l.logRequestFailed(e,t)}}function f(e,t){return g(e,t.recentActivities,t.cursor,t.encrypted),v(e,t.recentActivities)}function g(e,t,n,i){c.recentActivityDispatcher.dispatch({type:d.RECEIVE_RAW_RECENT_ACTIVITIES,rawRecentActivities:t,cursor:n||"",encrypted:i||"",userId:e})}function v(e,t){var i=[];return t.forEach(function(e){if(e.skeleton_data&&e.related_activity_keys){var t=h.shouldShowThumbnails(e.skeleton_data.filter_types_by_key)?d.MAX_INITIAL_THUMBNAIL_ATTACHMENTS:d.MAX_INITIAL_DOC_ATTACHMENTS;e.related_activity_keys.slice(0,t).forEach(function(e){return i.push(e)})}}),n.Deferred(function(t){return o.waitForTTI().then(function(){return E(e,i).then(function(e){return t.resolve(e)})})})}function y(e,t,n){void 0===n&&(n=!1),I(u.fetchPaperRecents(e,t,n),e,t)}function I(e,t,n){e.then(function(e){var i=n&&e.hasMore;c.recentActivityDispatcher.dispatch({type:d.RECEIVE_PAPER_RECENT_ITEMS,items:e.items,hasMore:i,userId:t}),i&&o.waitForTTI().then(function(){return y(t,!1)})},_(t))}function E(e,t){var r=a.attachmentStore.groupIdsByEncryptedToken(t),o=i.map(r,function(t,n){return u.fetchActivitiesByKey(e,t,n).then(function(t){return A(e,t)})});return n.when.apply(n,o).then(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n={};return e.forEach(function(e){i.map(e,function(e,t){n[t]=e})}),n})}function A(e,t){return c.recentActivityDispatcher.dispatch({type:d.RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY,rawRelatedActivitiesByKey:t,userId:e}),R(t,e),S(t,e),t}function R(e,t){if(e){w(T(e),t).then(function(e){c.recentActivityDispatcher.dispatch({type:d.RECEIVE_CAN_OPEN_INFO,canOpenInfo:e})})}}function w(t,r){var a=n.Deferred();return e(["modules/clean/unity/features"],function(e){i.isUndefined(e)||e.check_file_batch(t,r).then(function(e){a.resolve(e)})}),a.promise()}function T(e){return i.values(e).map(function(e){return{ns_id:e.ns_id,ns_path:e.ns_path}})}function S(e,t){if(e){var n=T(e);u.checkFileInRootCollection(t,n).then(function(e){c.recentActivityDispatcher.dispatch({type:d.RECEIVE_FILE_IN_ROOT_COLLECTION_INFO,fileInRootCollectionInfo:e.fileInRootCollectionInfo})})}}function C(e,t,n){var o=a.attachmentStore.getByIds(t),c=o.filter(function(e){return!e.isLoaded}).map(function(e){return e.id});c.length?E(e,c).then(function(){return C(e,t,n)},function(){return s.error(r._("There was a problem completing this request."))}):i.defer(function(){return n(o)})}t.loadRecentItems=m,t.handleAndLogFetchRecentActivitiesPromise=p,t.getOnFail=_,t.updateRecentActivities=g,t.loadAttachmentsForRecentActivities=v,t.loadPaperRecentItems=y,t.handleFetchPaperRecentsPromise=I,t.loadAttachments=E,t.ensureAttachments=C}),define("modules/clean/recent_activity/stores/attachment_store",["require","exports","tslib","external/underscore","modules/clean/flux/flux_store","modules/clean/recent_activity/actions/error_actions","modules/clean/recent_activity/stores/flux_utils","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_dispatcher","modules/clean/recent_activity/models/attachment","modules/core/exception"],function(e,t,n,i,r,a,o,s,c,l,u){"use strict";var d=(function(e){function t(t,n){void 0===n&&(n={});var i=e.call(this,t)||this;return i.onCommit=function(e){delete i.transactionHistory[e.transactionId]},i._onDeleteFilesPending=function(e){for(var t=[],n=0,r=e.attachmentIds;n<r.length;n++){var a=r[n];a in i.attachmentIdToAttachment&&(t.push(i.attachmentIdToAttachment[a]),delete i.attachmentIdToAttachment[a])}i.transactionHistory[e.transactionId]={deletedAttachments:t},o.emitChangeIfNeeded(i,!!t.length)},i._onDeleteFilesRollback=function(e){var t=i.transactionHistory[e.transactionId];u.assert(!!t,"Unable to find data for transaction with id: "+e.transactionId),t.deletedAttachments.forEach(function(e){return i.attachmentIdToAttachment[e.id]=e}),o.emitChangeIfNeeded(i,!!t.deletedAttachments.length)},i.attachmentIdToEncryptedToken={},i.attachmentIdToAttachment={},(n.attachments||[]).forEach(function(e){i.attachmentIdToAttachment[e.id]=e,n.encryptedToken&&(i.attachmentIdToEncryptedToken[e.id]=n.encryptedToken)}),i.transactionHistory={},i}return n.__extends(t,e),t.prototype.getById=function(e){return this.attachmentIdToAttachment[e]||null},t.prototype.getByIds=function(e){return i.values(i.pick(this.attachmentIdToAttachment,e))},t.prototype.getByFqPath=function(e){return this.getAll().find(function(t){return t.fqPath===e})||null},t.prototype.getAll=function(){return i.values(this.attachmentIdToAttachment)},t.prototype.groupIdsByEncryptedToken=function(e){var t=this;return i.groupBy(e.filter(function(e){return e in t.attachmentIdToEncryptedToken}),function(e){return t.attachmentIdToEncryptedToken[e]})},t.prototype.__onDispatch=function(e){switch(e.type){case s.DELETE_FILES_COMMIT:this.onCommit(e);break;case s.DELETE_FILES_PENDING:this._onDeleteFilesPending(e);break;case s.DELETE_FILES_ROLLBACK:this._onDeleteFilesRollback(e);break;case s.RECEIVE_RAW_RECENT_ACTIVITIES:this.onReceiveRawRecentActivities(e);break;case s.RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY:this.onReceiveRawRelatedActivitiesByKey(e);break;case s.RECEIVE_CAN_OPEN_INFO:this._onReceiveCanOpenInfo(e);break;case s.RECEIVE_FILE_IN_ROOT_COLLECTION_INFO:this._onReceiveFileInRootCollectionInfo(e)}},t.prototype.mutateAttachmentInNsIdPath=function(e,t){if(e&&e.indexOf(":")>=0){var n=e.split(":"),i=n[0],r=n[1],a=this.getAll().find(function(e){return e.nsId===Number(i)&&e.nsPath===r})||null;if(a){var s=o.getMutatedOrOriginal(a,t);if(s!==a)return this.attachmentIdToAttachment[a.id]=s,!0}}return!1},t.prototype.onReceiveRawRecentActivities=function(e){var t=this,n=e.rawRecentActivities.map(l.createPartialAttachmentsFromRecentActivity),i=(r=[]).concat.apply(r,n).filter(function(e){var n=t.getById(e.id);return!n||!n.isLoaded});i.forEach(function(n){t.attachmentIdToAttachment[n.id]=n,t.attachmentIdToEncryptedToken[n.id]=e.encrypted}),o.emitChangeIfNeeded(this,!!i.length);var r},t.prototype.onReceiveRawRelatedActivitiesByKey=function(e){var t=this;e.rawRelatedActivitiesByKey&&o.iterateAndEmitChangesIfNeeded(this,e.rawRelatedActivitiesByKey,function(e,n){try{var r=l.convertFileActivityToAttachmentItem(e);return t.attachmentIdToAttachment[r.id]=r,!0}catch(e){return i.defer(function(){return a.errorActions.relatedActivityParseError(n,e)}),!1}})},t.prototype._onReceiveCanOpenInfo=function(e){var t=this;o.iterateAndEmitChangesIfNeeded(this,e.canOpenInfo,function(e,n){return t.mutateAttachmentInNsIdPath(n,{canOpen:e.is_locally_available})})},t.prototype._onReceiveFileInRootCollectionInfo=function(e){var t=this;o.iterateAndEmitChangesIfNeeded(this,e.fileInRootCollectionInfo,function(e,n){return t.mutateAttachmentInNsIdPath(n,{inRootCollection:e})})},t})(r);t.AttachmentStore=d,t.attachmentStore=new d(c.recentActivityDispatcher)}),define("modules/clean/recent_activity/stores/flux_utils",["require","exports","tslib","external/underscore"],function(e,t,n,i){"use strict";function r(e,t,n){var r=!1;i.each(t,function(e,t){n(e,t)&&(r=!0)}),a(e,r)}function a(e,t){t&&e.__emitChange()}function o(e,t){for(var i in t)if(t[i]!==e[i])return n.__assign({},e,t);return e}t.iterateAndEmitChangesIfNeeded=r,t.emitChangeIfNeeded=a,t.getMutatedOrOriginal=o}),define("modules/clean/recent_activity/stores/recent_activity_store",["require","exports","tslib","external/immutable","external/underscore","modules/clean/flux/flux_store","modules/clean/recent_activity/actions/error_actions","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_dispatcher","modules/clean/recent_activity/recent_activity_view_models","modules/clean/recent_activity/stores/attachment_store","modules/core/exception"],function(e,t,n,i,r,a,o,s,c,l,u,d){"use strict";var h=r.values(s.RECENT_EVENT_FILTER_TYPE),m=(function(e){function t(t,n,a){void 0===a&&(a=[]);var o=e.call(this,t)||this;return o._items=i.fromJS(r.object(r.pluck(a,"id"),a)),o._attachmentMap=i.Map(),o._cursors=i.Map(),o._loaded=i.Set(),o._attachmentStore=n,o._didReceiveRecentActivities=!1,
o._transactionHistory={},o._regenerateAttachmentMap(),o}return n.__extends(t,e),t.prototype._itemComparator=function(e,t){return e.when===t.when?e.order-t.order:t.when-e.when},t.prototype.getAll=function(){return r.values(this._items.toJS()).sort(this._itemComparator)},t.prototype.didReceiveRecentActivities=function(){return this._didReceiveRecentActivities},t.prototype.cursorForUser=function(e){return this._cursors.get(e,null)},t.prototype.isLoadedForUser=function(e){return this._loaded.contains(e)},t.prototype.getById=function(e){var t=this._items.get(e);return t?t.toJS():null},t.prototype.filterItemsForUser=function(e,t){d.assert(h.includes(t),"filter must be one of "+h);var n=s.RECENT_EVENT_FILTER_TYPE.ALL,i=s.RECENT_EVENT_FILTER_TYPE.JUNK;return this.getAll().filter(function(a){var o=r.values(a.filterTypesByKey),s=t===n&&!o.includes(i);return a.viewingUserId===e&&(s||o.includes(t))})},t.prototype.__onDispatch=function(e){switch(e.type){case s.DELETE_FILES_COMMIT:this._onCommit(e);break;case s.DELETE_FILES_PENDING:this._onDeleteFilesPending(e);break;case s.DELETE_FILES_ROLLBACK:this._onDeleteFilesRollback(e);break;case s.RECEIVE_RAW_RECENT_ACTIVITIES:this._onReceiveRawRecentActivities(e);break;case s.RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY:this._onReceiveRawRelatedActivitiesByKey(e);break;case s.RAW_RELATED_ACTIVITY_PARSE_ERROR:this._onRawRelatedActivityParseError(e)}},t.prototype._onCommit=function(e){delete this._transactionHistory[e.transactionId]},t.prototype._onReceiveRawRecentActivities=function(e){this._didReceiveRecentActivities||e.rawRecentActivities.length||(this._didReceiveRecentActivities=!0,this.__emitChange()),this._didReceiveRecentActivities=!0;var t=r.compact(e.rawRecentActivities.map(this._createRecentItem,this));this._items=this._items.withMutations(function(e){return t.forEach(function(t){var n=e.find(function(e){return e.id===t.id});n&&(t=t.set("paths",n.paths));var i=e.find(function(e){return e.id!==t.id&&e.contextDisplayName===t.contextDisplayName});if(i){r.intersection(i.attachmentIds.toArray(),t.attachmentIds.toArray()).length>0&&e.delete(i.get("id"))}e.set(t.get("id"),t)})});var n=i.Set(),a=this._items.toList().sort(this._itemComparator);a=a.filter(function(e){if(e.attachmentIds&&e.attachmentIds.size>0){if(e.attachmentIds.every(function(e){return n.has(e)}))return!1;n=n.union(e.attachmentIds)}return!0}),this._items=i.Map(a.map(function(e){return[e.get("id"),e]})),this._loaded=this._loaded.add(e.userId),this._cursors=this._cursors.set(e.userId,e.cursor),this._regenerateAttachmentMap(),this.__emitChange()},t.prototype._onReceiveRawRelatedActivitiesByKey=function(e){var t=this;this.getDispatcher().waitFor([this._attachmentStore.getDispatchToken()]);var n=r.keys(e.rawRelatedActivitiesByKey),a=i.Set(n).flatMap(function(e){return t._attachmentMap.get(e)});this._items=this._items.withMutations(function(e){a.forEach(function(n){var i=e.get(n);if(i){var r=i.get("attachmentIds");if(r){var a=t._attachmentStore.getById(r.first());if(a&&a.isLoaded){var o=a.fqPath||"";r.slice(1).forEach(function(e){var n=t._attachmentStore.getById(e);if(n.isLoaded){var i=n.fqPath||"";i.split("/").length<o.split("/").length&&(o=i)}});var s=o.split("/"),c=s[s.length-2];c&&e.setIn([n,"contextDisplayName"],c),e.setIn([n,"paths"],l.getPathsByFqPath(o,i.get("viewingUserId")))}}}})}),this.__emitChange()},t.prototype._onRawRelatedActivityParseError=function(e){var t=this;this._items=this._items.withMutations(function(n){for(var r=0,a=e.errors;r<a.length;r++){var o=a[r].activityKey;t._attachmentMap.get(o,i.Set()).forEach(n.delete,n)}}),this.__emitChange()},t.prototype._onDeleteFilesPending=function(e){this.getDispatcher().waitFor([this._attachmentStore.getDispatchToken()]);var t=this._deleteAttachments(e.attachmentIds);t&&(this._transactionHistory[e.transactionId]=t,this.__emitChange())},t.prototype._onDeleteFilesRollback=function(e){this.getDispatcher().waitFor([this._attachmentStore.getDispatchToken()]);var t=this._transactionHistory[e.transactionId];d.assert(!!t,"Unable to find data for transaction with id: "+e.transactionId),delete this._transactionHistory[e.transactionId],this._rollbackDelete(t),this.__emitChange()},t.prototype._deleteAttachments=function(e){var t=this,n=null;return this._items=this._items.withMutations(function(a){var o=t._attachmentMap.get(e[0],i.Set()).first(),s=a.get(o);if(s){o=s.get("id");var c=r.difference(s.get("attachmentIds").toArray(),e);a.mergeIn([o],{attachmentIds:i.List(c)}),n={deletedAttachmentIds:e,item:a.get(o)},0===c.length&&a.delete(o)}}),n},t.prototype._rollbackDelete=function(e){this._items=this._items.withMutations(function(t){var n=e.item.get("id"),r=t.get(n);r||(r=e.item,r=r.set("attachmentIds",i.List()));var a=r.get("attachmentIds").concat(e.deletedAttachmentIds);r=r.merge({attachmentIds:a}),t.set(n,r)})},t.prototype._createRecentItem=function(e){try{return l.convertRecentActivityToRecentItem(e)}catch(t){r.defer(function(){return o.errorActions.recentActivityParseError(e.activity_key,t)})}return null},t.prototype._regenerateAttachmentMap=function(){var e={};this._items.forEach(function(t){return t.get("attachmentIds").forEach(function(n){var r=e[n];r||(r=i.Set()),e[n]=r.add(t.get("id"))})}),this._attachmentMap=i.Map(e)},t})(a);t.RecentActivityStore=m,t.recentActivityStore=new m(c.recentActivityDispatcher,u.attachmentStore)}),define("modules/clean/recent_activity/stores/selection_store",["require","exports","tslib","external/immutable","modules/clean/flux/flux_store","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_dispatcher"],function(e,t,n,i,r,a,o){"use strict";var s=(function(e){function t(t,n,r){void 0===n&&(n=null),void 0===r&&(r=[]);var a=e.call(this,t)||this;return a._selected=i.Set(r),a._recentItemId=n,a}return n.__extends(t,e),t.prototype.getByRecentItemId=function(e){return e===this._recentItemId?this._selected.toArray():[]},t.prototype.__onDispatch=function(e){switch(e.type){case a.SELECT_ATTACHMENTS:this._onReceiveSelectAttachments(e);break;case a.DESELECT_ATTACHMENTS:this._onReceiveDeselectAttachments(e)}},t.prototype._onReceiveSelectAttachments=function(e){this._recentItemId!==e.recentItemId&&(this._recentItemId=e.recentItemId,this._selected=this._selected.clear()),this._selected=this._selected.concat(e.attachmentIds),this.__emitChange()},t.prototype._onReceiveDeselectAttachments=function(e){this._recentItemId!==e.recentItemId&&(this._recentItemId=e.recentItemId,this._selected=this._selected.clear()),this._selected=this._selected.filter(function(t){return e.attachmentIds.indexOf(t)===-1}),this.__emitChange()},t})(r);t.SelectionStore=s,t.selectionStore=new s(o.recentActivityDispatcher)});
//# sourceMappingURL=pkg-maestro-recents.min.js-vflA8zzYu.map