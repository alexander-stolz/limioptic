define("modules/clean/react/home/actions",["require","exports","modules/constants/env","modules/core/browser","modules/core/uri","modules/core/i18n","modules/core/notify","modules/clean/flux/dispatcher","modules/clean/react/home/api","modules/clean/react/home/constants"],function(e,t,n,o,r,i,a,s,c,l){"use strict";var d=(function(){function e(){}return e.initializeStore=function(e,t){s.dispatch({type:l.HomeActionTypes.INITIALIZE_STORE,payload:{role:e,sectionVisibility:t}})},e.setSectionVisibility=function(e,t,n){s.dispatch({type:l.HomeActionTypes.SET_SECTION_VISIBILITY,payload:{section:t,visible:n}}),c.setSectionVisibility(e,t,n).catch(function(e){var o=n?i._("Unable to show section."):i._("Unable to hide section.");return a.error(o),s.dispatch({type:l.HomeActionTypes.SET_SECTION_VISIBILITY,payload:{section:t,visible:!n}}),Promise.reject(e)})},e.createPaperDoc=function(e){c.createPaperDoc(e).then(function(e){o.redirect(new r({scheme:"https",authority:n.NOTES_WEBSERVER,path:"/doc/"+e.doc_id}).toString())}).catch(function(e){a.error(i._("Could not create paper document."))})},e})();t.HomeActions=d}),define("modules/clean/react/home/constants",["require","exports","modules/clean/react/user_notifications/constants"],function(e,t,n){"use strict";t.HomeActionTypes={INITIALIZE_STORE:"HOME_INITIALIZE_STORE",SET_SECTION_VISIBILITY:"HOME_SET_SECTION_VISIBILITY"},t.HomeSections={UNREAD:"unread",STARRED:"starred",RECENTS:"recents"},t.LoggingTypes={CLICK_SHOW_ALL:"click_show_all",HOME_PAGE_SHOWN:"home_page_shown",UNREAD_SHOWN:"unread_shown",STARRED_SHOWN:"starred_shown",RECENTS_SHOWN:"recents_shown",HIDE_SECTION:"hide_section",UNHIDE_SECTION:"unhide_section",RECENTS_ITEM_ACTION:"recents_item_action",OPEN_UNREAD_ITEM:"open_unread_document",MARK_AS_READ:"mark_as_read",OPEN_STARRED_ITEM:"open_starred_item",UNSTAR_ITEM:"unstar_item",UNDO_UNSTAR_ITEM:"undo_unstar_item",CLICK_STAR_OVERFLOW_MENU:"click_star_overflow_menu",CLICK_STAR_OVERFLOW_SHARE:"click_star_overflow_share",CLICK_STAR_OVERFLOW_UPLOAD:"click_star_overflow_upload",CLICK_INCOMING_ACTION:"click_incoming_action",CLICK_RIGHT_NAV_ITEM:"click_right_nav_item",CLICK_INCOMING_SHOW_READ:"click_incoming_show_read",CLICK_RECENT_ITEMS:"click_recent_item",OPEN_INCOMING:"open_incoming",OPEN_INCOMING_DOCUMENT:"open_incoming_document",OPEN_STARRED_DOCUMENT:"open_starred_item",OPEN_DOCUMENT:"open_document",CLICK_UPLOAD_FILES:"upload_files",CLICK_CREATE_PAPER_DOC:"create_paper_doc",CLICK_NEW_SHARED_FOLDER:"new_shared_folder"},t.LoggingSections={UNREAD:"home_unread",STARRED:"home_starred",RECENTS:"home_recents"},t.LoggingSectionXHRs=(o={},o[t.LoggingSections.UNREAD]=["notifications/retrieve_user"],o[t.LoggingSections.STARRED]=["retrieve_starred"],o[t.LoggingSections.RECENTS]=["recents/json","retrieve_paper_recents"],o),t.LoadingStates={LOADING:"LOADING",SUCCESS:"SUCCESS",FAILURE:"FAILURE"},t.LoadingTypes={INITIAL:"INITIAL",OLDER:"OLDER",NEWER:"NEWER"},t.DisplayTypeToSpriteName={DOC:"page_white_word_32",PDF:"page_white_acrobat_32",SPREADSHEET:"page_white_excel_32",FILE:"page_white_gray_32",FOLDER:"folder_32",SHARED_FOLDER:"folder_user_32",TEAM_FOLDER:"folder_team_32",PAPER_DOCUMENT:"paper_doc_32",PAPER_FOLDER:"folder_paper_team_32",PAPER_PUBLIC_FOLDER:"folder_team_32",PAPER_PROJECT:"paper_project_32"},t.FILE_RESOURCE_TYPE="FILE",t.FOLDER_RESOURCE_TYPE="FOLDER",t.PAPER_DOCUMENT_RESOURCE_TYPE="PAPER_DOCUMENT",t.PAPER_FOLDER_RESOURCE_TYPE="PAPER_FOLDER",t.DisplayTypeToResourceType={DOC:t.FILE_RESOURCE_TYPE,PDF:t.FILE_RESOURCE_TYPE,SPREADSHEET:t.FILE_RESOURCE_TYPE,FILE:t.FILE_RESOURCE_TYPE,FOLDER:t.FOLDER_RESOURCE_TYPE,SHARED_FOLDER:t.FOLDER_RESOURCE_TYPE,TEAM_FOLDER:t.FOLDER_RESOURCE_TYPE,PAPER_DOCUMENT:t.PAPER_DOCUMENT_RESOURCE_TYPE,PAPER_FOLDER:t.PAPER_FOLDER_RESOURCE_TYPE,PAPER_PUBLIC_FOLDER:t.PAPER_FOLDER_RESOURCE_TYPE,PAPER_PROJECT:t.PAPER_FOLDER_RESOURCE_TYPE},t.FeedTypes={UNREAD:"unread",INCOMING:"incoming"},t.ExceptionTags={UNREAD:"home_unread"},t.DisplayTypes={DOC:"DOC",PDF:"PDF",SPREADSHEET:"SPREADSHEET",FILE:"FILE",FOLDER:"FOLDER",SHARED_FOLDER:"SHARED_FOLDER",TEAM_FOLDER:"TEAM_FOLDER",PAPER_DOCUMENT:"PAPER_DOCUMENT",PAPER_FOLDER:"PAPER_FOLDER",PAPER_PUBLIC_FOLDER:"PAPER_PUBLIC_FOLDER",PAPER_PROJECT:"PAPER_PROJECT"},t.BluenoteObjectTypeToDisplayType=(r={},r[n.BluenoteObjectTypes.DROPBOX_FILE]=t.DisplayTypes.FILE,r[n.BluenoteObjectTypes.DROPBOX_FOLDER]=t.DisplayTypes.FOLDER,r[n.BluenoteObjectTypes.PAPER_PAD]=t.DisplayTypes.PAPER_DOCUMENT,r[n.BluenoteObjectTypes.PAPER_FOLDER]=t.DisplayTypes.PAPER_FOLDER,r);var o,r}),define("modules/clean/react/home/home_access/home_access_main",["require","exports","tslib","jquery","external/react","modules/clean/react/home/actions","modules/clean/react/home/constants","modules/clean/react/home/home_access/recents/store","modules/clean/react/home/home_access/onboarding/actions","modules/clean/react/home/home_access/recents/section","modules/clean/react/home/home_access/recents/utils/events","modules/clean/react/home/home_access/unread/home_access_unread","modules/clean/react/home/starred/starred_view","modules/clean/react/home/store","modules/clean/react/home/util/logging/activity_logger","modules/clean/react_logger","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/stores/federated_recent_activity_store","modules/clean/recent_activity/versions/recent_activity_version_2","modules/clean/react/home/util/constants","modules/clean/web_timing_logger","modules/clean/user_education/user_education_client","modules/clean/user_education/user_education_interface"],function(e,t,n,o,r,i,a,s,c,l,d,u,m,p,_,h,g,E,y,f,S,v,R){"use strict";var T=(function(e){function t(n){var o=e.call(this,t.displayName,n)||this;o.onHomeRecentsStoreUpdate=function(){for(var e=s.HomeRecentsStore.popEvents(),t=0,n=e;t<n.length;t++){var o=n[t],r=d.extractLogInfo(o.actionType,o.cellView,o.fqPaths,o.totalCount,o.index);_.homeActivityLogger.logRecentsAction(r.actionTaken,r.scope,r.itemNumber,r.extension,r.sprite,r.subgroupPosition)}},o.onFederatedRecentActivityStoreUpdate=function(){if(E.FederatedRecentActivityStore.didReceiveItemsFromAllStreams()){var e=y.RecentActivityVersion2.getRecentItems(o.props.user.id,g.RECENT_EVENT_FILTER_TYPE.ALL),t=!o.state.sectionVisibility[a.HomeSections.RECENTS];if(e.length){var n=d.countRecentsItem(e);_.homeActivityLogger.logRecentsShown(n.numMetaserverItems,n.numPaperItems,t)}}},o.onHomeStoreUpdate=function(){o.setState({sectionVisibility:p.HomeStore.getSectionVisibility()})},o.state={sectionVisibility:n.initialSectionVisibility};var r=s.HomeRecentsStore.addListener(o.onHomeRecentsStoreUpdate),i=E.FederatedRecentActivityStore.addListener(o.onFederatedRecentActivityStoreUpdate),c=p.HomeStore.addListener(o.onHomeStoreUpdate);return o.removeStoreListeners=function(){r(),i(),c()},o}return n.__extends(t,e),t.prototype.componentWillMount=function(){e.prototype.componentWillMount.call(this),S.log_js_modules_application_code_start(),v.eventEmitter.on(R.UserEducationStateChannel,function(e){var t=function(e){o("html, body").animate({scrollTop:e},500)},n=e.step;if(n)if(n.name===f.HOME_V0_USER_EDUCATION_STEP_NAMES.RECENTLY_VIEWED||n.name===f.HOME_V1_USER_EDUCATION_STEP_NAMES.RECENTLY_VIEWED){var r=o(".home-recents-section").offset().top,i=o(".maestro-header").outerHeight();t(r-i)}else n.name!==f.HOME_V0_USER_EDUCATION_STEP_NAMES.THANKS&&n.name!==f.HOME_V1_USER_EDUCATION_STEP_NAMES.FILES||t(0)}),i.HomeActions.initializeStore(this.props.role,this.props.initialSectionVisibility),c.updateShowUnreadOnboarding(this.props.showUnreadOnboarding),this.props.onboardingComplete===!1?c.markOnboardingNotComplete():c.markHomeOnboardingComplete(!1)},t.prototype.componentWillUnmount=function(){this.removeStoreListeners&&this.removeStoreListeners()},t.prototype.render=function(){return r.createElement("main",{className:"home-access",role:"main"},r.createElement("ul",{className:"home-access-sections"},r.createElement("li",{className:"home-access-section"},r.createElement(u.HomeAccessUnread,null)),r.createElement("li",{className:"home-access-section"},r.createElement(m.StarredView,{user:this.props.user,hideSection:this.props.hideStarredSection})),r.createElement("li",{className:"home-access-section"},r.createElement(l.HomeRecentsSection,{user:this.props.user,role:this.props.role,isHiddenByUser:!this.state.sectionVisibility[a.HomeSections.RECENTS],shouldAllowHiddenRecents:this.props.shouldAllowHiddenRecents}))))},t})(h.ReactPureLogger);T.displayName="HomeAccessMain",T.defaultProps={showUnreadOnboarding:!1},t.HomeAccessMain=T}),define("modules/clean/react/home/home_access/home_access_web",["require","exports","tslib","external/react","modules/clean/react/home/home_access/home_access_main","modules/clean/react/home/home_access/sidebar","modules/clean/react/maestro/header","modules/clean/react/maestro/layout","modules/clean/viewer","modules/core/i18n","modules/clean/history","modules/clean/react_logger"],function(e,t,n,o,r,i,a,s,c,l,d,u){"use strict";var m=(function(e){function t(n){return e.call(this,t.displayName,n)||this}return n.__extends(t,e),t.prototype.renderMain=function(e,t){return o.createElement("div",{className:"home"},o.createElement(r.HomeAccessMain,{role:this.props.initialRole,user:e,viewer:t,hideStarredSection:this.props.hideStarredSection,showUnreadOnboarding:this.props.showUnreadOnboarding,onboardingComplete:this.props.onboardingComplete,initialSectionVisibility:this.props.initialSectionVisibility,shouldAllowHiddenRecents:this.props.shouldAllowHiddenRecents}))},t.prototype.renderSidebar=function(e){return this.props.shouldShowSidebar?o.createElement(i.HomeSidebar,{user:e,isPaperEnabledForUser:this.props.isPaperEnabledForUser}):null},t.prototype.componentDidMount=function(){d.remove_query_param("role"),e.prototype.componentDidMount.call(this)},t.prototype.render=function(){var e=c.get_viewer(),t=e.get_user_by_role(this.props.initialRole);return t?o.createElement(s.MaestroChrome,{user:t,embeddedAppRegion:this.renderMain(t,e),titleRegion:o.createElement(a.MaestroHeaderTitle,null,l._("Home")),actionSidebarRegion:this.renderSidebar(t)}):null},t})(u.ReactPureLogger);m.displayName="HomeAccessWeb",t.HomeAccessWeb=m}),define("modules/clean/react/home/home_access/onboarding/actions",["require","exports","modules/clean/flux/dispatcher","modules/clean/react/home/home_access/onboarding/api","modules/clean/react/home/home_access/onboarding/constants","modules/clean/react/home/home_access/onboarding/store","modules/clean/react/home/home_access/onboarding/tooltips","modules/clean/user_education/user_education_client"],function(e,t,n,o,r,i,a,s){"use strict";function c(){n.dispatch({type:r.HomeOnboardingActionTypes.SET_ONBOARDING_STEP,onboardingStep:r.HomeOnboardingStep.START})}function l(){i.HomeOnboardingStore.getOnboardingStep()===r.HomeOnboardingStep.START&&(s.UEClient.sendEvent("Star","toggled"),n.dispatch({type:r.HomeOnboardingActionTypes.SET_ONBOARDING_STEP,onboardingStep:r.HomeOnboardingStep.FILE_STARRED}))}function d(e){void 0===e&&(e=!1),n.dispatch({type:r.HomeOnboardingActionTypes.SET_ONBOARDING_STEP,onboardingStep:e?r.HomeOnboardingStep.SKIPPED:r.HomeOnboardingStep.COMPLETE}),e&&o.hideUnreadOnboarding()}function u(){i.HomeOnboardingStore.shouldShowUnreadOnboarding()&&a.showUnreadTooltipIfRendered()&&(o.hideUnreadOnboarding(),m(!1))}function m(e){n.dispatch({type:r.HomeOnboardingActionTypes.UPDATE_SHOW_UNREAD_ONBOARDING,showUnreadOnboarding:e})}t.markOnboardingNotComplete=c,t.onFakeFileStarToggled=l,t.markHomeOnboardingComplete=d,t.showUnreadOnboardingTooltipIfNecessary=u,t.updateShowUnreadOnboarding=m}),define("modules/clean/react/home/home_access/onboarding/api",["require","exports","modules/clean/react/home/store","modules/clean/react/home/api"],function(e,t,n,o){"use strict";function r(){return o.makeRequest({url:"/home_feed/hide_unread_onboarding",type:"POST",data:{role:n.HomeStore.getRole()}})}t.hideUnreadOnboarding=r}),define("modules/clean/react/home/home_access/onboarding/constants",["require","exports","modules/core/i18n"],function(e,t,n){"use strict";t.HomeOnboardingActionTypes={SET_ONBOARDING_STEP:"HOME_ONBOARDING_SET_ONBOARDING_STEP",UPDATE_SHOW_UNREAD_ONBOARDING:"HOME_ONBOARDING_UPDATE_SHOW_UNREAD_ONBOARDING"};(function(e){e[e.START=1]="START",e[e.FILE_STARRED=2]="FILE_STARRED",e[e.COMPLETE=3]="COMPLETE",e[e.SKIPPED=4]="SKIPPED",e[e.UNINITIALIZED=5]="UNINITIALIZED"})(t.HomeOnboardingStep||(t.HomeOnboardingStep={})),t.HOME_ONBOARDING_FAKE_FILE_DATA={fileName:n._("Get Started with Dropbox.pdf"),fileType:"PDF",icon:"page_white_acrobat",idTypePair:{id:"HOME_ONBOARDING_FAKE_FILE_ID",type:"HOME_ONBOARDING_FAKE_FILE_ID_TYPE"}}}),define("modules/clean/react/home/home_access/onboarding/helpers",["require","exports","modules/clean/react/home/home_access/onboarding/actions","modules/clean/react/home/home_access/onboarding/store"],function(e,t,n,o){"use strict";function r(){var e=function(e){var t=o.HomeOnboardingStore.addListener(e);return function(){t()}};return{getState:o.HomeOnboardingStore.getFakeFileStarState,onClick:n.onFakeFileStarToggled,getRemoveStoreListeners:e}}t.getStarOverrides=r}),define("modules/clean/react/home/home_access/onboarding/store",["require","exports","tslib","modules/clean/flux/dispatcher","modules/clean/react/home/home_access/onboarding/constants","modules/clean/react/home/home_access/onboarding/tooltips","modules/clean/flux/flux_store"],function(e,t,n,o,r,i,a){"use strict";var s=(function(e){function t(){var t=e.call(this,o)||this;return t.getFakeFileStarState=function(){switch(t.onboardingStep){case r.HomeOnboardingStep.START:return{isLoading:!1,isStarred:!1};case r.HomeOnboardingStep.FILE_STARRED:return{isLoading:!1,isStarred:!0};default:return{isLoading:!0,isStarred:!1}}},t.onboardingStep=r.HomeOnboardingStep.UNINITIALIZED,t.showUnreadOnboarding=!1,t}return n.__extends(t,e),t.prototype.getOnboardingStep=function(){return this.onboardingStep},t.prototype.showFakeFileInRecents=function(){return this.isStep([r.HomeOnboardingStep.START,r.HomeOnboardingStep.FILE_STARRED])},t.prototype.isOnboardingFakeFileStarred=function(){return this.isStep([r.HomeOnboardingStep.FILE_STARRED])},t.prototype.isOnboardingComplete=function(){return this.isStep([r.HomeOnboardingStep.COMPLETE,r.HomeOnboardingStep.SKIPPED])},t.prototype.shouldShowUnreadOnboarding=function(){return this.showUnreadOnboarding&&this.isStep([r.HomeOnboardingStep.COMPLETE])},t.prototype.isStep=function(e){for(var t=0,n=e;t<n.length;t++){var o=n[t];if(this.onboardingStep===o)return!0}return!1},t.prototype.onSetOnboardingStep=function(e){this.isStep([e])||e!==r.HomeOnboardingStep.SKIPPED||i.showFilesNavItemTooltipIfRendered(),this.onboardingStep=e},t.prototype.onUpdateShowUnreadOnboarding=function(e){this.showUnreadOnboarding=e},t.prototype.__onDispatch=function(e){var t=e.action;switch(t.type){case r.HomeOnboardingActionTypes.SET_ONBOARDING_STEP:this.onSetOnboardingStep(t.onboardingStep);break;case r.HomeOnboardingActionTypes.UPDATE_SHOW_UNREAD_ONBOARDING:this.onUpdateShowUnreadOnboarding(t.showUnreadOnboarding);break;default:return}this.__emitChange()},t})(a);t.HomeOnboardingStoreClass=s,t.HomeOnboardingStore=new s}),define("modules/clean/react/home/home_access/onboarding/tooltips",["require","exports","jquery","modules/core/i18n","modules/clean/react/home/util/static_tooltip"],function(e,t,n,o,r){"use strict";function i(e,t,o,i,a){var s=n(e);return!(!s||!s.get(0))&&((new r.StaticTooltip).show(t,o,s.get(0),i,c,c,a),!0)}function a(){return i("a.maestro-nav__product#files",o._("Tip"),o._("Looking for the rest of your files? You can find them here."),r.StaticTooltip.POSITIONS.RIGHT_BOTTOM,"home-tooltip__files-nav-item")}function s(){return i(".home__unread-card--first",o._("Tip"),o._("New shared files and comments show up here."),r.StaticTooltip.POSITIONS.TOP_LEFT,"home-tooltip__unread-onboarding")}var c=function(){return null};t.showFilesNavItemTooltipIfRendered=a,t.showUnreadTooltipIfRendered=s}),define("modules/clean/react/home/home_access/recents/home_access_recents_v2",["require","exports","tslib","external/react","modules/clean/recent_activity/react/recent_activity_container","modules/clean/react/home/util/logging/timing_component","modules/clean/react/home/constants","modules/clean/recent_activity/versions/recent_activity_version_2","modules/clean/react_logger"],function(e,t,n,o,r,i,a,s,c){"use strict";var l=i.timingComponent(r.RecentActivityContainer,a.LoggingSections.RECENTS),d=(function(e){function t(n){var o=e.call(this,t.displayName,n)||this;return o.handleVisibilityChange=function(){"visible"===document.visibilityState&&s.RecentActivityVersion2.loadPage(o.props.user.id,!0)},o}return n.__extends(t,e),t.prototype.componentWillUnmount=function(){document.removeEventListener("visibilitychange",this.handleVisibilityChange)},t.prototype.componentDidMount=function(){document.addEventListener("visibilitychange",this.handleVisibilityChange,!1),e.prototype.componentDidMount.call(this)},t.prototype.render=function(){return o.createElement(l,{version:s.RecentActivityVersion2,initialRole:this.props.role,user:this.props.user})},t})(c.ReactPureLogger);d.displayName="HomeAccessRecentsV2",t.HomeAccessRecentsV2=d}),define("modules/clean/react/home/home_access/recents/section",["require","exports","tslib","external/react","modules/clean/react/home/actions","modules/clean/react/home/constants","modules/clean/react/home/home_access/recents/home_access_recents_v2","modules/clean/react/home/section_header","modules/clean/react/home/util/logging/timing_logger","modules/clean/react/home/util/logging/activity_logger","modules/core/i18n"],function(e,t,n,o,r,i,a,s,c,l,d){"use strict";var u=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onChangeRecentsVisibility=function(){var e=!t.props.isHiddenByUser;r.HomeActions.setSectionVisibility(t.props.user.id,i.HomeSections.RECENTS,!e),l.homeActivityLogger.logShowHideSection(i.HomeSections.RECENTS,e)},t.renderHiddenText=function(){return o.createElement("div",{className:"home-access__recents-hidden-text u-pad-vertical-m"},d._("Your recently viewed files are hidden")," · ",o.createElement("button",{className:"button-as-link",onClick:t.onChangeRecentsVisibility},d._("Show")))},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.props.isHiddenByUser&&this.props.shouldAllowHiddenRecents&&(c.homeTimingLogger.activate(),c.homeTimingLogger.logTTData(i.LoggingSections.RECENTS),c.homeTimingLogger.logTTI(i.LoggingSections.RECENTS))},t.prototype.render=function(){var e=null,t="initial",r=null;return this.props.shouldAllowHiddenRecents&&(this.props.isHiddenByUser?(e=d._("Show"),t="none",r=this.renderHiddenText()):e=d._("Hide")),o.createElement("span",{className:"home-recents-section"},o.createElement(s.SectionHeader,{title:d._("Recently viewed"),ueName:"recents",buttonText:e,buttonAction:this.onChangeRecentsVisibility}),o.createElement("div",{className:"home-access-section__content u-pad-vertical-s"},r,o.createElement("div",{style:{display:t}},o.createElement(a.HomeAccessRecentsV2,n.__assign({},this.props)))))},t})(o.PureComponent);u.displayName="HomeRecentsSection",t.HomeRecentsSection=u}),define("modules/clean/react/home/home_access/recents/store",["require","exports","tslib","modules/clean/flux/dispatcher","modules/clean/flux/flux_store","modules/clean/react/home/home_access/recents/constants"],function(e,t,n,o,r,i){"use strict";var a=(function(e){function t(){var t=e.call(this,o)||this;return t._logEvents=[],t}return n.__extends(t,e),t.prototype.popEvents=function(){return this._logEvents.splice(0,this._logEvents.length)},t.prototype.onNewEvent=function(e){this._logEvents.push(e)},t.prototype.__onDispatch=function(e){var t=e.action;switch(t.type){case i.HomeRecentsActionTypes.LOG_EVENT:t.event&&this.onNewEvent(t.event);break;default:return}this.__emitChange()},t})(r);t.HomeRecentsStore=new a}),define("modules/clean/react/home/home_access/recents/utils/events",["require","exports","jquery","external/underscore","external/react-dom","modules/clean/recent_activity/recent_activity_logger"],function(e,t,n,o,r,i){"use strict";var a=i.ActionScopes,s=function(e,t){return 1===e?a.SINGLE:t.length===e?a.AGGREGATION:a.SUBSET},c=function(e){var t=e.find(".recents-item__icon img.sprite");if(t.length)for(var n=t.attr("class").split(/\s+/),o=0,r=n;o<r.length;o++){var i=r[o];if(i.match(/^s_.*_32$/))return i}return"thumbnail"},l=function(e){var t=e.closest(".recents-view"),n=e.closest(".recents-item");return t.find(".recents-item").index(n)},d=function(e,t,n,o,r){if(e===a.AGGREGATION||"collapse"===n||"uncollapse"===n)return"various";for(var i=0,s=["paper_doc","folder","paper_project"];i<s.length;i++){var c=s[i];if(t.indexOf(c)>=0)return"n/a"}var l=o[r],d=l.lastIndexOf(".");return d===-1?"":l.substr(d+1)},u=function(e,t,n,o){return e===a.AGGREGATION?n.props.recentItem?0:t+1:e===a.SUBSET?o.hasClass("recents-item")?0:o.index()+1:0};t.extractLogInfo=function(e,t,o,i,a){var m=n(r.findDOMNode(t)),p=s(i,o),_=c(m);return{actionTaken:e,scope:p,itemNumber:l(m),extension:d(p,_,e,o,a||0),sprite:_,subgroupPosition:u(p,a||0,t,m)}},t.countRecentsItem=function(e){var t=o.countBy(e,function(e){switch(e.type){case 1:return"metaserver";case 16:return"paper";default:return"unknown"}});return{numMetaserverItems:t.metaserver||0,numPaperItems:t.paper||0}}}),define("modules/clean/react/home/home_access/sidebar",["require","exports","tslib","external/react","modules/core/i18n","modules/clean/react/app_actions_view","modules/clean/react/file_uploader/file_uploader","modules/clean/react/home/actions","modules/clean/react/home/constants","modules/clean/react/home/util/logging/activity_logger","modules/clean/sharing/wizard/async_wizard_modals","modules/clean/web_timing_logger"],function(e,t,n,o,r,i,a,s,c,l,d,u){"use strict";var m=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleUploadFiles=function(){t.props.user.is_cdm_member&&a.FileUploaderController.setPath(t.props.user.cdm_tmf_path),a.FileUploaderController.showModal(),l.homeActivityLogger.logClickRightMenu(c.LoggingTypes.CLICK_UPLOAD_FILES)},t.handleCreateSharedFolder=function(){d.asyncShowShareAFolderWizardModal(t.props.user,function(e){l.homeActivityLogger.logClickRightMenu(c.LoggingTypes.CLICK_NEW_SHARED_FOLDER,e)})},t.handleCreatePaperDoc=function(){s.HomeActions.createPaperDoc(t.props.user.id),l.homeActivityLogger.logClickRightMenu(c.LoggingTypes.CLICK_CREATE_PAPER_DOC)},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){a.FileUploaderController.setUser(this.props.user),u.waitForTTI().then(function(){a.FileUploaderController.loadCoreComponent()})},t.prototype.render=function(){var e=[{displayName:r._("New shared folder"),iconName:"new-shared-folder",handleClick:this.handleCreateSharedFolder}];return this.props.isPaperEnabledForUser&&e.push({displayName:r._("Create Paper doc"),iconName:"new-paper-doc",handleClick:this.handleCreatePaperDoc}),o.createElement("div",{className:"home-access-sidebar"},o.createElement(a.FileUploaderController,{loadOnRender:!1,needToSetStoreValues:!0,dragAndDropEnabled:!1}),o.createElement(i.AppActionsView,{primaryMenuItem:{displayName:r._("Upload files"),handleClick:this.handleUploadFiles},secondaryMenuItems:e}))},t})(o.PureComponent);t.HomeSidebar=m}),define("modules/clean/react/home/home_access/unread/activity_snippet",["require","exports","external/react"],function(e,t,n){"use strict";t.UnreadActivitySnippet=function(e){var t=e.snippetElement,o=e.aggregationText;return n.createElement("div",{className:"home__unread-activity"},n.createElement("div",{className:"home__unread-activity-snippet",children:t}),o?n.createElement("div",{className:"home__doc-sticker"},o):null)},t.UnreadActivitySnippet.displayName="UnreadActivitySnippet"}),define("modules/clean/react/home/home_access/unread/card",["require","exports","tslib","external/react","external/classnames","modules/clean/react/home/constants","modules/clean/react/home/home_access/unread/activity_snippet","modules/clean/react/home/home_access/unread/detail","modules/clean/react/home/home_access/unread/helpers","modules/clean/react/home/util/doc_with_avatar_icon","modules/clean/react/home/util/logging/activity_logger","modules/clean/react/home/util/navigation","modules/clean/react/user_notifications/actions","modules/core/i18n","modules/core/exception","modules/clean/react_logger"],function(e,t,n,o,r,i,a,s,c,l,d,u,m,p,_,h){"use strict";var g=(function(e){function t(n){return e.call(this,t.displayName,n)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this,t=this.props.actionMetadata,n=t.actorName,c=t.avatarIcon,d=t.notificationType,u=t.snippetText,m=this.props.resourceMetadata,_=m.resourceTitle,h=m.uriString,g=i.DisplayTypeToSpriteName[this.props.displayType]||"",E=r({"home__unread-card":!0,"home__unread-card--last-in-row":this.props.lastInRow,"home__unread-card--first":this.props.isFirstCard}),y=function(t,n,o){t.stopPropagation(),t.preventDefault(),"BUTTON"!==o.tagName&&e.props.logClickAndOpen(h,n,t)},f=function(e){return function(t){return y(t,e,t.target)}},S=function(e){return function(t){"Enter"===t.key&&y(t,e,t.target)}};return o.createElement("span",{className:E,onClick:f("card"),onKeyPress:S("card"),href:h,style:{width:this.props.width},"aria-label":"unread-item",role:"button"},o.createElement("div",{className:"home__doc-header"},o.createElement("span",{className:"home__doc-header__icon",onClick:f("icon"),onKeyPress:S("icon"),href:h,"aria-label":"unread-item-icon",role:"button"},o.createElement(l.DocWithAvatarIcon,{avatarIconModel:c,docSpriteName:g})),o.createElement("div",{className:"home__doc-text"},o.createElement("div",{className:"home__doc-title-group"},o.createElement("span",{className:"home__doc-title",onClick:f("title"),onKeyPress:S("title"),href:h,"aria-label":"unread-item-title",tabIndex:0,role:"button"},_),o.createElement("button",{className:"home__doc-unread-indicator button-as-link",title:p._("Mark as read"),"aria-label":p._("Mark as read"),onClick:this.props.markRead},p._("Mark as read"))),o.createElement("span",{className:"home__doc-detail",onClick:f("detail"),onKeyPress:S("detail"),href:h,"aria-label":"unread-item-detail",role:"button"},o.createElement(s.UnreadEntryDetail,{actorName:n,notificationType:d,feedTime:this.props.feedTime})))),o.createElement("span",{className:"home__doc-snippet",onClick:f("snippet"),onKeyPress:S("snippet"),href:h,"aria-label":"unread-item-snippet",role:"button"},o.createElement(a.UnreadActivitySnippet,{snippetElement:u,aggregationText:this.props.stickerText})))},t})(h.ReactPureLogger);g.displayName="UnreadCardView",t.UnreadCardView=g;var E=(function(e){function t(n){var o=e.call(this,t.displayName,n)||this;return o.logClickAndOpen=function(e,t,n){var r=function(){return d.homeActivityLogger.logOpenUnreadNotificationItem(o.props.notification,i.LoggingSections.UNREAD,t,o.props.position)};u.logAndNavigate(e,r,n)},o.logAndMarkRead=function(e){d.homeActivityLogger.logMarkNotificationAsRead(o.props.notification,o.props.position),e.stopPropagation(),e.preventDefault(),m.acknowledge(o.props.notification)},o}return n.__extends(t,e),t.prototype.render=function(){var e=this.props.notification,t=c.getNotificationMetadata(e);return t?o.createElement(g,{actionMetadata:t.actionMetadata,feedTime:e.feedTime,displayType:t.displayType,isFirstCard:this.props.isFirstCard,lastInRow:this.props.lastInRow,logClickAndOpen:this.logClickAndOpen,markRead:this.logAndMarkRead,resourceMetadata:t.resourceMetadata,stickerText:null,width:this.props.width}):(_.reportException({err:new Error("missing metadata for Home Access Unread card"),tags:[i.ExceptionTags.UNREAD]}),null)},t})(h.ReactPureLogger);E.displayName="UnreadNotificationCard",t.UnreadNotificationCard=E}),define("modules/clean/react/home/home_access/unread/constants",["require","exports"],function(e,t){"use strict";t.UNREAD_NOTIFICATION_TYPES={DOC_SHARE:"DOC_SHARE",FOLDER_SHARE:"FOLDER_SHARE",MENTION:"MENTION",COMMENT:"COMMENT",UNKNOWN:"UNKNOWN"}}),define("modules/clean/react/home/home_access/unread/detail",["require","exports","external/react","modules/clean/datetime","modules/clean/react_format","modules/core/i18n","modules/clean/react/home/home_access/unread/constants"],function(e,t,n,o,r,i,a){"use strict";function s(e){switch(e){case a.UNREAD_NOTIFICATION_TYPES.DOC_SHARE:return i._("<actor_span>%(actor_name)s</actor_span> shared %(ago)s");case a.UNREAD_NOTIFICATION_TYPES.FOLDER_SHARE:return i._("<actor_span>%(actor_name)s</actor_span> invited you %(ago)s");case a.UNREAD_NOTIFICATION_TYPES.MENTION:return i._("<actor_span>%(actor_name)s</actor_span> mentioned you %(ago)s");case a.UNREAD_NOTIFICATION_TYPES.COMMENT:return i._("<actor_span>%(actor_name)s</actor_span> commented %(ago)s");default:return i._("Unknown notification")}}t.UnreadEntryDetail=function(e){var t=e.actorName,i=e.feedTime,a=e.notificationType,c=r.reactFormat(s(a),{actor_name:t,actor_span:n.createElement("span",{className:"home__unread-detail-actor"}),ago:o.ago(i,!1)});return n.createElement("div",{className:"home__unread-detail-header",children:c})},t.UnreadEntryDetail.displayName="UnreadEntryDetail"}),define("modules/clean/react/home/home_access/unread/helpers",["require","exports","external/react","external/underscore","modules/clean/react/home/constants","modules/clean/react/home/util/avatar_icon","modules/clean/react/home/home_access/unread/constants","modules/clean/react/user_notifications/constants"],function(e,t,n,o,r,i,a,s){"use strict";function c(e){return e.filter(function(e){return!!(e.bluenoteActor&&e.bluenoteNotificationTypeId&&e.bluenoteObject&&e.bluenoteTypedData)&&d[e.bluenoteNotificationTypeId]}).sort(function(e,t){return t.feedTime.getTime()-e.feedTime.getTime()})}function l(e){if(!(e.bluenoteActor&&e.bluenoteNotificationTypeId&&e.bluenoteObject&&e.bluenoteTypedData))return null;var t,c,l,d=i.AvatarIconModel.deserializer({avatarInitials:e.bluenoteActor.initials,avatarUrl:e.bluenoteActor.avatarUrl});switch(e.bluenoteNotificationTypeId){case s.BNNotificationTypeIdentifier.DROPBOX_FILE_COMMENT:t=a.UNREAD_NOTIFICATION_TYPES.COMMENT,l=e.bluenoteTypedData,c=l.commentText;break;case s.BNNotificationTypeIdentifier.DROPBOX_SHARED_CONTENT:t=e.bluenoteObject.type===s.BluenoteObjectTypes.DROPBOX_FILE?a.UNREAD_NOTIFICATION_TYPES.DOC_SHARE:a.UNREAD_NOTIFICATION_TYPES.FOLDER_SHARE,l=e.bluenoteTypedData,c=l.shareText;break;case s.BNNotificationTypeIdentifier.PAPER_SHARE:t=a.UNREAD_NOTIFICATION_TYPES.DOC_SHARE,l=e.bluenoteTypedData,c=l.shareText;break;case s.BNNotificationTypeIdentifier.PAPER_COMMENT:t=a.UNREAD_NOTIFICATION_TYPES.COMMENT,l=e.bluenoteTypedData,c=l.commentText;break;case s.BNNotificationTypeIdentifier.PAPER_MENTION:t=a.UNREAD_NOTIFICATION_TYPES.MENTION,l=e.bluenoteTypedData,c=l.mentionText;break;default:t=a.UNREAD_NOTIFICATION_TYPES.UNKNOWN,c=""}return{actionMetadata:{actorName:e.bluenoteActor.displayName,avatarIcon:d,notificationType:t,snippetText:n.createElement("span",null,o.unescape(c))},resourceMetadata:{resourceTitle:o.unescape(e.bluenoteObject.name),uriString:o.unescape(e.bluenoteObject.url)},displayType:r.BluenoteObjectTypeToDisplayType[e.bluenoteObject.type]}}var d=(u={},u[s.BNNotificationTypeIdentifier.DROPBOX_FILE_COMMENT]=!0,u[s.BNNotificationTypeIdentifier.DROPBOX_SHARED_CONTENT]=!0,u[s.BNNotificationTypeIdentifier.PAPER_SHARE]=!0,u[s.BNNotificationTypeIdentifier.PAPER_COMMENT]=!0,u[s.BNNotificationTypeIdentifier.PAPER_MENTION]=!0,u);t.getValidNotifications=c,t.getNotificationMetadata=l;var u}),
define("modules/clean/react/home/home_access/unread/home_access_unread",["require","exports","tslib","external/react","modules/clean/react/home/constants","modules/clean/react/home/util/logging/timing_component","modules/clean/react/home/util/logging/timing_logger","modules/clean/react/home/section_header","modules/clean/react/home/home_access/unread/card","modules/clean/react/home/util/width_aware_component","modules/core/i18n","modules/clean/react/home/home_access/unread/helpers","modules/clean/react/home/util/logging/activity_logger","modules/clean/react/user_notifications/actions","modules/clean/react/home/home_access/onboarding/actions","modules/clean/react/user_notifications/store","modules/clean/react_logger"],function(e,t,n,o,r,i,a,s,c,l,d,u,m,p,_,h,g){"use strict";var E=(function(e){function t(n){var o=e.call(this,t.displayName,n)||this;return o.onStoreUpdate=function(){var e;if(e=o.state.loadingState===r.LoadingStates.SUCCESS?r.LoadingStates.SUCCESS:h.userNotificationsStore.isLoading()?r.LoadingStates.LOADING:r.LoadingStates.SUCCESS,e===r.LoadingStates.SUCCESS&&a.homeTimingLogger.logTTData(r.LoggingSections.UNREAD),o.setState({loadingState:e,notifications:u.getValidNotifications(h.userNotificationsStore.getUnacknowledged())}),e===r.LoadingStates.SUCCESS){var t=l.calculateItemsToShow(o.props.width,o.getNumItems(),296,416,16,1),n=t.itemsPerRow,i=t.itemWidth,s=t.numRows,c=t.hasHiddenRows;m.homeActivityLogger.logUnreadShown(o.getNumItems(),n,i,s,c)}},o.toggleShowAll=function(){m.homeActivityLogger.logClickShowAll("unread",!o.state.showAll),o.setState({showAll:!o.state.showAll})},o.state={notifications:[],loadingState:r.LoadingStates.LOADING,showAll:!1},o}return n.__extends(t,e),t.prototype.componentDidMount=function(){p.loadOnceAndWatch(!0),this.removeStoreListener=h.userNotificationsStore.addListener(this.onStoreUpdate),this.onStoreUpdate(),this.triggerOnboarding(),e.prototype.componentDidMount.call(this)},t.prototype.componentWillUnmount=function(){this.removeStoreListener&&this.removeStoreListener()},t.prototype.componentDidUpdate=function(){this.triggerOnboarding()},t.prototype.triggerOnboarding=function(){setTimeout(_.showUnreadOnboardingTooltipIfNecessary)},t.prototype.shouldShowSection=function(){return this.state.loadingState===r.LoadingStates.SUCCESS&&this.getNumItems()>0&&this.props.width},t.prototype.buttonText=function(e){return e?this.state.showAll?d._("Show less"):d._("Show all"):null},t.prototype.renderCards=function(e,t){return this.props.width?(this.state.showAll?this.state.notifications:this.state.notifications.slice(0,e)).map(function(n,r){var i=r%e===e-1;return o.createElement(c.UnreadNotificationCard,{notification:n,width:t,lastInRow:i,position:r,isFirstCard:0===r,key:n.key})}):null},t.prototype.getNumItems=function(){return this.state.notifications.length},t.prototype.render=function(){if(!this.shouldShowSection())return null;var e=l.calculateItemsToShow(this.props.width,this.getNumItems(),296,416,16,1),t=e.hasHiddenRows,n=this.renderCards(e.itemsPerRow,e.itemWidth);return o.createElement("div",null,o.createElement(s.SectionHeader,{buttonAction:this.toggleShowAll,buttonText:this.buttonText(t),title:d._("Unread"),ueName:"unread"}),o.createElement("div",{className:"home-access-section__content home__unread-items"},n))},t})(g.ReactPureLogger);E.displayName="HomeAccessUnread",t.HomeAccessUnread=l.widthAwareComponent(i.timingComponent(E,r.LoggingSections.UNREAD))}),define("modules/clean/react/home/incoming/model/core",["require","exports","external/underscore"],function(e,t,n){"use strict";function o(e){return e.replace(/_(.)/g,function(e,t){return t.toUpperCase()})}function r(e){return e.replace(/([a-z\d])([A-Z])/g,function(e,t,n){return t+"_"+n.toLowerCase()})}function i(e,t){return Object.keys(t).forEach(function(n){var o=e(n),r=t[n],a="object"==typeof r&&null!==r?i(e,r):r;if(o!==n||a!==r)try{t[o]=a,delete t[n]}catch(e){}}),t}function a(e,t){void 0===t&&(t={});var o=n.extend({},d,t);return function(t,n){var r=t.constructor.__NAME__;s.__DESERIALIZERS__[r]||(s.__DESERIALIZERS__[r]={}),s.__DESERIALIZERS__[r][n]=function(t){t=o.convertToCamelCase?c(t):l(t);try{return e(t.hasOwnProperty(n)?t[n]:o.defaultValue,t)}catch(e){throw"Error deserializing property `"+n+"` for class `"+r+"`\n"+e}}}}var s=(function(){function e(e){Object.assign(this,e)}return e.prototype._mergeProps=function(e){var t=n.omit(this,function(e){return e instanceof Function}),o=n.pick(e,Object.keys(t));return n.extend(t,o)},e.prototype.toObject=function(){var t=this._mergeProps({});return n.mapObject(t,function(t){return t instanceof e?t.toObject():t})},e.jsonToProperties=function(t){for(var o=[],r=e.__NAME__,i=this.__NAME__,a=this.prototype;i!==r;)o.unshift(i),a=Object.getPrototypeOf(a),i=a.constructor.__NAME__;for(var s={},c=function(o){var r=e.__DESERIALIZERS__[o];void 0!==r&&n.each(Object.keys(r),function(e){s[e]=r[e](t)})},l=0,d=o;l<d.length;l++){c(d[l])}return s},e})();s.__NAME__="HomeModel",s.__DESERIALIZERS__={},t.HomeModel=s;var c=i.bind(null,o),l=i.bind(null,r),d={convertToCamelCase:!0,defaultValue:void 0};t.deserializer=a}),define("modules/clean/react/home/incoming/model/deserializers",["require","exports"],function(e,t){"use strict";function n(e){return void 0===e||null===e}function o(e,t){if(n(t))return t;var o=typeof t;if(o===e)return t;throw"Expected "+e+", got "+o+" ("+t+")"}function r(e){return o("string",e)}function i(e){return o("number",e)}function a(e){return o("boolean",e)}function s(e){if(n(e))return e;var t=typeof e;if("number"===t)return new Date(e);if(e instanceof Date)return e;throw"Expected Date or number, got "+t+" ("+e+")"}function c(e){return e}function l(e){return function(t){return void 0===t&&(t=[]),t.map(function(t,n){try{return e(t)}catch(e){throw"Error deserializing array at index "+n+"\n"+e}})}}function d(e){return function(t){return new e(void 0===t||null===t?{}:e.jsonToProperties(t))}}t.StringDeserializer=r,t.NumberDeserializer=i,t.BooleanDeserializer=a,t.DateDeserializer=s,t.AnyDeserializer=c,t.ArrayDeserializer=l,t.ClassDeserializer=d}),define("modules/clean/react/home/section_header",["require","exports","tslib","external/react","modules/clean/react_logger","modules/clean/user_education/user_education_client"],function(e,t,n,o,r,i){"use strict";var a=(function(e){function t(n){return e.call(this,t.displayName,n)||this}return n.__extends(t,e),t.prototype.renderButton=function(){return this.props.buttonText&&this.props.buttonAction?o.createElement("div",{className:"home-section-header__button"},o.createElement("button",{className:"button-as-link",onClick:this.props.buttonAction},this.props.buttonText)):null},t.prototype.render=function(){return o.createElement("h2",{className:"home-access-section__header"},o.createElement("div",{className:"home-access-section__title"},o.createElement("div",{className:"home-access-section__title-text"},o.createElement(i.UserEducationEffect,{containerName:"home-section-header",name:this.props.ueName},this.props.title))),this.renderButton())},t})(r.ReactPureLogger);a.displayName="SectionHeader",t.SectionHeader=a}),define("modules/clean/react/home/starred/actions",["require","exports","modules/clean/flux/dispatcher","modules/clean/react/home/starred/constants","modules/clean/react/home/starred/api","modules/clean/react/home/starred/models/starred_item","modules/clean/react/starred/model","modules/constants/home"],function(e,t,n,o,r,i,a,s){"use strict";var c=(function(){function e(){}return e.loadInitialItems=function(){return n.dispatch({type:o.StarredResourceActionTypes.LOADING_INITIAL}),e.loadItems(s.HOME_STARRED_NUM_INITIAL_ITEMS)},e.loadAllItems=function(){return n.dispatch({type:o.StarredResourceActionTypes.LOADING_ALL}),e.loadItems(1e3)},e.loadItems=function(e){return r.getItems(e).then(function(e){var t=e.items.map(i.starredItemModelToStarredStatus);n.dispatch({type:o.StarredResourceActionTypes.LOAD_SUCCESS,items:e.items,starredStatuses:a.statusResultsToStarredStatuses(t),hasMore:e.hasMore,hideEmptySection:e.hideEmptySection})}).catch(function(e){return n.dispatch({type:o.StarredResourceActionTypes.LOAD_FAILURE,error:e}),Promise.reject(e)})},e.hideSection=function(e){void 0===e&&(e=!1),n.dispatch({type:o.StarredResourceActionTypes.HIDE_EMPTY_SECTION}),e||r.hideSection()},e})();t.StarredActions=c}),define("modules/clean/react/home/starred/api",["require","exports","modules/clean/react/home/api","modules/clean/react/home/store","modules/clean/react/home/starred/models/starred_item","modules/core/exception"],function(e,t,n,o,r,i){"use strict";function a(e){if("success"===e.status){if(void 0===e.items||void 0===e.has_more||void 0===e.hide_section)throw i.reportStack("Home starred items request returned success without items or hasMore",{severity:i.SEVERITY.NONCRITICAL}),new Error("Invalid server response for Starred getItems");return{items:e.items.map(r.starredItemFromJson),hasMore:e.has_more,hideEmptySection:e.hide_section}}throw e.status}t.getItems=function(e){var t=window.__REGISTER_RETRIEVE_STARRED_PRELOAD_HANDLER;if(t)return delete window.__REGISTER_RETRIEVE_STARRED_PRELOAD_HANDLER,new Promise(function(e,n){t(function(t){e(a(t))},n)});var r=o.HomeStore.getRole();return n.makeRequest({url:"/home_feed/retrieve_starred",type:"POST",data:{role:r,limit:e}},!0).then(a)},t.hideSection=function(){return n.makeRequest({url:"/home_feed/hide_starred_section",type:"POST",data:{role:o.HomeStore.getRole()}})}}),define("modules/clean/react/home/starred/models/starred_item",["require","exports","external/underscore","modules/clean/react/home/constants"],function(e,t,n,o){"use strict";function r(e){return{title:e.title,resourceId:e.resource_id,idType:e.id_type,displayType:e.display_type,url:e.url,details:i(e.display_type,e.details)}}function i(e,t){var n=o.DisplayTypeToResourceType[e];if(n===o.FILE_RESOURCE_TYPE){var r=t;return{fqPath:r.fq_path}}if(n===o.FOLDER_RESOURCE_TYPE){var r=t;return{fqPath:r.fq_path,targetNsId:r.target_ns_id}}return{}}function a(e){return{display_type:e.displayType,resource_id:e.resourceId,id_type:e.idType}}function s(e,t){return n.extend({latestActivity:t},e)}function c(e){return l(a(e))}function l(e){return e.display_type+"|"+e.resource_id}function d(e){return JSON.stringify(e.map(a))}function u(e){return{id:e.resourceId,type:e.idType,is_starred:!0}}t.starredItemFromJson=r,t.detailsFromJson=i,t.getResourceIdProps=a,t.addActivityToItem=s,t.getResourceKeyFromModel=c,t.getResourceKeyFromResourceIdProps=l,t.getResourcesJson=d,t.starredItemModelToStarredStatus=u}),define("modules/clean/react/home/starred/starred_item",["require","exports","tslib","external/classnames","external/mcl/overflow_button","external/react","modules/core/i18n","modules/core/uri","modules/clean/react/bubble_menu","modules/clean/react/sprite","modules/clean/react/home/store","modules/clean/react/home/util/navigation","modules/clean/react/starred/actions","modules/clean/react/starred/star","modules/clean/react/home/util/logging/activity_logger","modules/clean/react/home/constants","modules/clean/undo","modules/clean/user_education/user_education_client","modules/clean/react/home/util/async_importer","modules/clean/react/home/home_access/onboarding/helpers","modules/clean/react_logger"],function(e,t,n,o,r,i,a,s,c,l,d,u,m,p,_,h,g,E,y,f,S){"use strict";var v=(T={},T[h.FILE_RESOURCE_TYPE]=!0,T[h.FOLDER_RESOURCE_TYPE]=!0,T[h.PAPER_DOCUMENT_RESOURCE_TYPE]=!0,T),R=(function(e){function t(n){var o=e.call(this,t.displayName,n)||this;return o.getLoggingInfo=function(){var e=h.DisplayTypeToResourceType[o.props.item.displayType],t="n/a";if(e===h.FILE_RESOURCE_TYPE){var n=o.props.item.title,r=n.lastIndexOf(".");t=r===-1?"":n.substr(r+1)}return{resourceId:o.props.item.resourceId,resourceType:e,resourceExt:t,position:o.props.position}},o.onClick=function(e){e.stopPropagation(),u.logAndNavigate(o.props.item.url,o.logOpen,e)},o.onStarClick=function(e){if(!e&&!o.props.onboardingItem){var t=o.getLoggingInfo(),n=t.resourceId,r=t.resourceType,i=t.resourceExt,s=t.position;_.homeActivityLogger.logUnstarItem(n,r,i,s);var c=o.props.item,l=a._("Removed from Starred."),u=function(e){var t=e.itemToStar;m.StarredActions.update(d.HomeStore.getRole(),t.resourceId,t.idType,!0),_.homeActivityLogger.logUndoUnstarItem(n,r,i,s)};g.notifyWithUndo(l,{itemToStar:c},u,10)}},o.logEvent=function(e){var t=o.getLoggingInfo();return e(t.resourceId,t.resourceType,t.resourceExt,t.position)},o.logOpen=function(){return o.logEvent(_.homeActivityLogger.logOpenStarredItem)},o.logClickMenu=function(){return o.logEvent(_.homeActivityLogger.logClickStarOverflowMenu)},o.logClickUpload=function(){return o.logEvent(_.homeActivityLogger.logClickStarOverflowUpload)},o.logClickShare=function(){return o.logEvent(_.homeActivityLogger.logClickStarOverflowShare)},o.redirectToUpload=function(e){u.logAndNavigate(s.parse(o.props.item.url).updateQuery({upload:"1"}).toString(),o.logClickUpload)},o.handleShare=function(e){if(o.props.item.displayType===h.PAPER_DOCUMENT_RESOURCE_TYPE)return void u.logAndNavigate(o.props.item.url+"?openSharing=1",o.logClickShare,e);o.logClickShare();var t=h.DisplayTypeToResourceType[o.props.item.displayType]===h.FOLDER_RESOURCE_TYPE,n=t?o.props.item.details.targetNsId:null;y.AsyncShareModalUtil.asyncExec(function(e){return e.showShareModal(o.props.user,{fqPath:o.props.item.details.fqPath,isFolder:t,targetNsId:n})})},o.stopEvent=function(e){e.stopPropagation(),e.preventDefault()},o.getTitle=function(){var e=o.props.item.title,t=a._("Untitled");return e.trim().length?e:t},o}return n.__extends(t,e),t.prototype.renderDropdown=function(){var e=[],t=h.DisplayTypeToResourceType[this.props.item.displayType];if(t===h.FOLDER_RESOURCE_TYPE&&e.push(i.createElement(c.BubbleMenuItem,{className:"starred-context-menu-item",key:"upload",onClick:this.redirectToUpload},"Upload")),t in v&&e.push(i.createElement(c.BubbleMenuItem,{className:"starred-context-menu-item",key:"share",onClick:this.handleShare},"Share")),e.length>0){var o={"aria-label":a._("More actions"),onDoubleClick:function(e){e.stopPropagation()}},s=i.createElement(r.OverflowButton,n.__assign({className:"starred-item__context-menu-button","aria-label":a._("More Actions")},o));return i.createElement("div",{onClick:this.stopEvent},i.createElement(c.BubbleMenu,{items:e,arrow_position:"top",position:c.BubbleMenu.POSITIONS.BOTTOM,targetButton:s,onShowDropdown:this.logClickMenu}))}return null},t.prototype.componentWillMount=function(){e.prototype.componentWillMount.call(this),y.AsyncShareModalUtil.requireOnTTI()},t.prototype.render=function(){var e={"starred-item":!0,"starred-item--last-in-row":this.props.lastInRow,"starred-item--in-last-row":this.props.inLastRow};return i.createElement("div",{style:{width:this.props.width},className:o(e),onClick:this.onClick},i.createElement(l,{className:"starred-item__file-icon",group:"web",name:h.DisplayTypeToSpriteName[this.props.item.displayType],alt:""}),i.createElement("div",{className:"starred-item__content"},i.createElement(E.UserEducationEffect,{containerName:"StarredItem",name:"starred-item-"+String(this.props.position)}),i.createElement("a",{onClick:this.onClick,href:this.props.item.url,className:"starred-item__title"},this.getTitle()),i.createElement("div",{className:"starred-item__star"},i.createElement(p.Star,{role:d.HomeStore.getRole(),id:this.props.item.resourceId,idType:this.props.item.idType,itemName:this.props.item.title,onStarClick:this.onStarClick,overrides:this.props.onboardingItem?f.getStarOverrides():void 0}))),this.renderDropdown())},t})(S.ReactPureLogger);R.displayName="StarredItem",t.StarredItem=R;var T}),define("modules/clean/react/home/starred/starred_resource_store",["require","exports","tslib","external/underscore","modules/clean/flux/dispatcher","modules/clean/react/home/constants","modules/clean/react/home/starred/constants","modules/clean/react/starred/constants","modules/clean/react/home/starred/actions","modules/clean/react/starred/store","modules/clean/react/starred/id_type_pair","modules/clean/flux/flux_store"],function(e,t,n,o,r,i,a,s,c,l,d,u){"use strict";var m=(function(e){function t(){var t=e.call(this,r)||this;return t.orderedIds=[],t.itemsById={},t.loadingState=i.LoadingStates.LOADING,t.hasMore=!0,t.hideEmptySection=!1,t.areAllRequested=!1,t.isPaperUser=!0,t}return n.__extends(t,e),t.prototype.getStarredStore=function(){return l.StarredStore},t.prototype.getItems=function(){var e=this;return this.orderedIds.map(function(t){return e.itemsById[t]}).filter(function(t){var n={id:t.resourceId,type:t.idType},o=e.getStarredStore().getLoadingState(n),r=e.getStarredStore().getIsStarred(n);return o===s.StarredLoadingState.LOADING||r})},t.prototype.getItem=function(e){return this.itemsById[e]},t.prototype.getLoadingState=function(){return this.loadingState},t.prototype.getHasMore=function(){return this.hasMore},t.prototype.getHideEmptySection=function(){return this.hideEmptySection},t.prototype.getAreAllRequested=function(){return this.areAllRequested},t.prototype.getIsPaperUser=function(){return this.isPaperUser},t.prototype.onItemsLoading=function(){this.loadingState=i.LoadingStates.LOADING},t.prototype.onItemsLoadSuccess=function(e,t,n){var r=this;e.forEach(function(e){var t=e.resourceId;r.itemsById[t]?e=o.extend(e,{latestActivity:r.itemsById[t].latestActivity}):r.orderedIds.push(e.resourceId),r.itemsById[t]=e}),this.loadingState=i.LoadingStates.SUCCESS,this.hasMore=t,this.hideEmptySection=n},t.prototype.onItemsLoadFailure=function(e){this.loadingState=i.LoadingStates.FAILURE,e&&e===a.NOT_PAPER_USER_ERROR&&(this.isPaperUser=!1)},t.prototype.onStatusChange=function(){var e=this;r.waitFor([this.getStarredStore().getDispatchToken()]),this.getStarredStore().getAllStarredPairStrings().map(d.idFromIdTypePairString).filter(function(t){return!e.itemsById.hasOwnProperty(t)}).length&&setTimeout(c.StarredActions.loadAllItems,0)},t.prototype.__onDispatch=function(e){var t=e.action;switch(t.type){case a.StarredResourceActionTypes.LOADING_INITIAL:this.onItemsLoading();break;case a.StarredResourceActionTypes.LOADING_ALL:this.areAllRequested=!0,this.onItemsLoading();break;case a.StarredResourceActionTypes.LOAD_SUCCESS:this.onItemsLoadSuccess(t.items,t.hasMore,t.hideEmptySection);break;case a.StarredResourceActionTypes.LOAD_FAILURE:this.onItemsLoadFailure(t.error);break;case a.StarredResourceActionTypes.HIDE_EMPTY_SECTION:this.hideEmptySection=!0;break;case s.StarredActionTypes.SET_STATUS:this.onStatusChange()}this.__emitChange()},t})(u);t.PrivateStarredResourceStoreClass=m,t.StarredResourceStore=new m}),define("modules/clean/react/home/starred/starred_view",["require","exports","tslib","external/react","external/classnames","external/mcl/tip_card","modules/clean/components/loading_indicator","modules/clean/react/home/section_header","modules/clean/react/home/util/logging/timing_logger","modules/clean/react/home/util/logging/timing_component","modules/clean/react/home/constants","modules/clean/react/home/starred/starred_item","modules/constants/home","modules/core/i18n","modules/clean/react/home/util/logging/activity_logger","modules/clean/react/home/starred/starred_resource_store","modules/clean/react/home/starred/actions","modules/clean/react/home/util/width_aware_component","modules/clean/react/home/store","modules/clean/react/home/home_access/onboarding/store","modules/clean/react/home/home_access/onboarding/constants","modules/clean/react_logger"],function(e,t,n,o,r,i,a,s,c,l,d,u,m,p,_,h,g,E,y,f,S,v){"use strict";var R=(function(e){function t(n){var o=e.call(this,t.displayName,n)||this;return o.onStoreUpdate=function(){var e=h.StarredResourceStore.getLoadingState(),t=h.StarredResourceStore.getItems(),n=h.StarredResourceStore.getHasMore(),r=h.StarredResourceStore.getHideEmptySection();if(o.setState({itemModels:t,loadingState:e,hasMore:n,hideEmptySection:r}),e===d.LoadingStates.SUCCESS){c.homeTimingLogger.logTTData(d.LoggingSections.STARRED);var i=E.calculateItemsToShow(o.props.width,t.length,266,416,40,2),a=i.itemsPerRow,s=i.itemWidth,l=i.numRows,u=i.hasHiddenRows;_.homeActivityLogger.logStarredShown(t.length,a,s,l,u,n)}},o.onHomeStoreUpdate=function(){o.setState({showOnboardingFakeFile:f.HomeOnboardingStore.isOnboardingFakeFileStarred()})},o.toggleShowAll=function(){var e=!o.state.showAll;_.homeActivityLogger.logClickShowAll("starred",!o.state.showAll),e&&o.state.hasMore&&g.StarredActions.loadAllItems(),o.setState({showAll:e})},o.hideSection=function(){g.StarredActions.hideSection()},o.state=t.getInitialState(),o.removeStoreListener=h.StarredResourceStore.addListener(o.onStoreUpdate),o.removeHomeStoreListener=y.HomeStore.addListener(o.onHomeStoreUpdate),o}return n.__extends(t,e),t.prototype.componentWillMount=function(){e.prototype.componentWillMount.call(this),g.StarredActions.loadInitialItems(),this.props.hideSection&&g.StarredActions.hideSection(!0)},t.prototype.componentWillUnmount=function(){this.removeStoreListener&&this.removeStoreListener(),this.removeHomeStoreListener&&this.removeHomeStoreListener()},t.getInitialState=function(){return{showAll:!1,itemModels:[],loadingState:d.LoadingStates.LOADING,hasMore:!1,hideEmptySection:!1,showOnboardingFakeFile:!1}},t.prototype.renderStarredItem=function(e,t,n,r,i){return o.createElement(u.StarredItem,{key:e.resourceId,item:e,width:t,lastInRow:n%r===r-1,inLastRow:i<=r+n-n%r,user:this.props.user,position:n,onboardingItem:e.onboardingItem})},t.prototype.renderEmptyState=function(){return o.createElement("div",{className:"starred--empty"},o.createElement(i.TipCard,{onDismiss:this.hideSection},p._("When you star items, they’ll show up here for easy access.")))},t.prototype.renderItems=function(e){return e.length?e:this.state.loadingState!==d.LoadingStates.LOADING?this.renderEmptyState():null},t.prototype.buttonText=function(e){return e||this.state.hasMore&&this.state.loadingState===d.LoadingStates.SUCCESS?this.state.showAll?p._("Show less"):p._("Show all"):null},t.prototype.renderLoadingIndicator=function(){return this.state.loadingState===d.LoadingStates.LOADING?o.createElement("div",{className:"home-access__loading-indicator home--loading-indicator"},o.createElement(a,{style:a.LoadingIndicatorStyle.BLUE_SPINNER})):null},t.prototype.render=function(){var e=this,t=this.state.itemModels;if(this.state.showOnboardingFakeFile&&(t=t.slice(),t.unshift({title:S.HOME_ONBOARDING_FAKE_FILE_DATA.fileName,resourceId:S.HOME_ONBOARDING_FAKE_FILE_DATA.idTypePair.id,idType:S.HOME_ONBOARDING_FAKE_FILE_DATA.idTypePair.type,displayType:S.HOME_ONBOARDING_FAKE_FILE_DATA.fileType,url:"",onboardingItem:!0})),this.state.loadingState===d.LoadingStates.SUCCESS&&0===t.length&&this.state.hideEmptySection||!this.props.width)return null;var n=E.calculateItemsToShow(this.props.width,t.length,266,416,40,2),i=n.itemsPerRow,a=n.itemWidth,c=n.hasHiddenRows,l=t;this.state.showAll||(l=l.slice(0,2*i));var u=l.map(function(t,n){return e.renderStarredItem(t,a,n,i,l.length)}),_=this.renderLoadingIndicator(),h=r({"starred-grid":!0,"starred-grid--with-activity":m.HOME_STARRED_ACTIVITY_ENABLED});return o.createElement("div",{className:"starred"},o.createElement(s.SectionHeader,{title:p._("Starred"),ueName:"starred",buttonAction:this.toggleShowAll,buttonText:this.buttonText(c)}),o.createElement("div",{className:h},this.renderItems(u),_))},t})(v.ReactPureLogger);R.displayName="StarredView",t.StarredView=E.widthAwareComponent(l.timingComponent(R,d.LoggingSections.STARRED))}),define("modules/clean/react/home/store",["require","exports","tslib","modules/clean/flux/dispatcher","modules/clean/flux/flux_store","modules/clean/photos/thumb_loading/generic_thumb_store","modules/clean/react/home/constants","modules/clean/viewer"],function(e,t,n,o,r,i,a,s){"use strict";var c=(function(e){function t(){var t=e.call(this,o)||this;return t.thumbStore=new i,t}return n.__extends(t,e),t.prototype.getRole=function(){return this.role},t.prototype.getUser=function(){return this.user},t.prototype.getThumbStore=function(){return this.thumbStore},t.prototype.getSectionVisibility=function(){return this.sectionVisibility},t.prototype.setSectionVisibility=function(e){var t=e.section,o=e.visible;this.sectionVisibility[t]!==o&&(this.sectionVisibility=n.__assign({},this.sectionVisibility,(r={},r[t]=o,r)));var r},t.prototype.onInitializeStore=function(e){var t=e.role,n=e.sectionVisibility;this.role=t,this.sectionVisibility=n,this.user=s.get_viewer().get_user_by_role(t)},t.prototype.__onDispatch=function(e){var t=e.action;switch(t.type){case a.HomeActionTypes.INITIALIZE_STORE:this.onInitializeStore(t.payload);break;case a.HomeActionTypes.SET_SECTION_VISIBILITY:this.setSectionVisibility(t.payload)}this.__emitChange()},t})(r);t.HomeStore=new c}),define("modules/clean/react/home/util/async_importer",["require","exports","external/underscore","modules/clean/web_timing_logger","modules/core/exception"],function(e,t,n,o,r){"use strict";function i(e){return new s(e)}var a={},s=(function(){function e(e){this.id=n.uniqueId(),this.callbacker=e}return e.prototype.asyncExec=function(e){this.callbacker(function(t){t?e(t):r.reportStack("Failed to async import module",{severity:r.SEVERITY.NONCRITICAL})})},e.prototype.requireOnTTI=function(){var e=this;this.id in a||(a[this.id]=!0,o.waitForTTI().then(function(){return e.asyncExec(function(e){return null})}))},e})();t.HomeAsyncImporter=s,t.AsyncShareModalUtil=i(function(t){return e(["modules/clean/sharing/share_modal_util"],t)})}),define("modules/clean/react/home/util/avatar_icon",["require","exports","tslib","external/react","modules/clean/avatar/avatar_with_default","modules/clean/avatar/initials_avatar_with_color","modules/clean/react/home/store","modules/clean/react/home/incoming/model/core","modules/clean/react/home/incoming/model/deserializers"],function(e,t,n,o,r,i,a,s,c){"use strict";var l=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.set=function(n){return new t(e.prototype._mergeProps.call(this,n))},t})(s.HomeModel);l.__NAME__="AvatarIcon",l.deserializer=c.ClassDeserializer(l),n.__decorate([s.deserializer(c.StringDeserializer)],l.prototype,"avatarInitials",void 0),n.__decorate([s.deserializer(c.StringDeserializer)],l.prototype,"avatarUrl",void 0),t.AvatarIconModel=l;var d=(function(e){function t(t){var n=e.call(this)||this;return n.state={avatarImage:a.HomeStore.getThumbStore().get_thumb(t.avatarIcon.avatarUrl),_thumbRequestId:null},n}return n.__extends(t,e),t.prototype.componentDidMount=function(){return this.bindAvatarUrl(this.props.avatarIcon)},t.prototype.componentWillUnmount=function(){return this.unbindAvatarUrl()},t.prototype.componentWillReceiveProps=function(e){var t=this.props.avatarIcon,n=e.avatarIcon;if(t.avatarUrl!==n.avatarUrl)return this.unbindAvatarUrl(),this.bindAvatarUrl(e.avatarIcon)},t.prototype.bindAvatarUrl=function(e){var t=this;if(e.avatarUrl){var n=a.HomeStore.getThumbStore(),o=n.bind_url(e.avatarUrl,{onSuccess:function(){return t.setState({avatarImage:n.get_thumb(e.avatarUrl)})}});return this.setState({_thumbRequestId:o}),o}},t.prototype.unbindAvatarUrl=function(){if(this.state._thumbRequestId)return a.HomeStore.getThumbStore().unbind_url(this.state._thumbRequestId)},t.prototype.render=function(){var e=this.props.avatarIcon,t={alt:"",name:e.avatarInitials||"",dimension:this.props.size,initials:e.avatarInitials||"",shape:"CIRCLE",optionalClass:this.props.className},a=o.createElement(i,n.__assign({},t));return o.createElement(r,n.__assign({},t,{defaultAvatar:a,photoUrl:this.state.avatarImage}))},t})(o.PureComponent);d.displayName="AvatarIcon",t.AvatarIcon=d}),define("modules/clean/react/home/util/constants",["require","exports"],function(e,t){"use strict";t.HOME_V0_USER_EDUCATION_STEP_NAMES={START:"start",RECENTLY_VIEWED:"recently_viewed",STAR_ITEM:"star_item",STARRED:"starred",THANKS:"thanks"},t.HOME_V1_USER_EDUCATION_STEP_NAMES={START:"start",RECENTLY_VIEWED:"recently_viewed",FILES:"files"}}),define("modules/clean/react/home/util/doc_with_avatar_icon",["require","exports","external/react","modules/clean/react/home/util/avatar_icon","modules/clean/avatar/size","modules/clean/react/sprite"],function(e,t,n,o,r,i){"use strict";t.DocWithAvatarIcon=function(e){var t=e.avatarIconModel,a=e.docSpriteName;return n.createElement("div",{className:"home__doc-with-avatar-icon"},n.createElement(i,{group:"web",name:a,alt:""}),n.createElement(o.AvatarIcon,{avatarIcon:t,className:"home__doc-avatar-icon",size:r.AVATAR_DIMENSION_BY_SIZE.SMALL}))},t.DocWithAvatarIcon.displayName="DocWithAvatarIcon"}),define("modules/clean/react/home/util/logging/activity_logger",["require","exports","tslib","modules/clean/react/home/api","modules/clean/react/home/store","modules/constants/home","modules/clean/react/home/constants"],function(e,t,n,o,r,i,a){"use strict";var s=(function(){function e(){this.loggedActivity={}}return e.prototype.checkAlreadyLoggedAndMark=function(e){var t=this.loggedActivity[e];return this.loggedActivity[e]=!0,Boolean(t)},e.prototype.logNotification=function(e,t,s){if(!t.bluenoteNotificationTypeId||!t.bluenoteObject)return Promise.resolve();var c=a.BluenoteObjectTypeToDisplayType[t.bluenoteObject.type],l=a.DisplayTypeToResourceType[c],d={entry_created:t.feedTime.getTime(),notification_type:t.bluenoteNotificationTypeId,resource_type:l},u=n.__assign({},d,s);return o.logHomeActivity({eventName:e,extra:u,entryType:i.HOME_EVENT_TYPE.UNREAD_BLUENOTE_EVENT,role:r.HomeStore.getRole()})},e.prototype.reset=function(){this.loggedActivity={}},e.prototype.logClickShowAll=function(e,t){return o.logHomeActivity({eventName:a.LoggingTypes.CLICK_SHOW_ALL,role:r.HomeStore.getRole(),extra:{component_name:e,should_show_all:t}})},e.prototype.logHomePageShown=function(){if(!this.checkAlreadyLoggedAndMark(a.LoggingTypes.HOME_PAGE_SHOWN))return o.logHomeActivity({eventName:a.LoggingTypes.HOME_PAGE_SHOWN,role:r.HomeStore.getRole(),extra:{}})},e.prototype.logUnreadShown=function(e,t,n,i,s){if(!this.checkAlreadyLoggedAndMark(a.LoggingTypes.UNREAD_SHOWN))return o.logHomeActivity({eventName:a.LoggingTypes.UNREAD_SHOWN,role:r.HomeStore.getRole(),extra:{num_items:e,is_hidden:!1,items_per_row:t,item_width:n,num_rows:i,has_hidden_rows:s}})},e.prototype.logStarredShown=function(e,t,n,i,s,c){if(!this.checkAlreadyLoggedAndMark(a.LoggingTypes.STARRED_SHOWN))return o.logHomeActivity({eventName:a.LoggingTypes.STARRED_SHOWN,role:r.HomeStore.getRole(),extra:{num_items:e,is_hidden:!1,items_per_row:t,item_width:n,num_rows:i,has_hidden_rows:s,has_more:c}})},e.prototype.logRecentsShown=function(e,t,n){if(!this.checkAlreadyLoggedAndMark(a.LoggingTypes.RECENTS_SHOWN))return o.logHomeActivity({eventName:a.LoggingTypes.RECENTS_SHOWN,role:r.HomeStore.getRole(),extra:{is_hidden:n,num_metaserver_items:e,num_paper_items:t}})},e.prototype.logShowHideSection=function(e,t){return o.logHomeActivity({eventName:t?a.LoggingTypes.HIDE_SECTION:a.LoggingTypes.UNHIDE_SECTION,role:r.HomeStore.getRole(),extra:{section_name:e}})},e.prototype.logRecentsAction=function(e,t,n,i,s,c){return o.logHomeActivity({eventName:a.LoggingTypes.RECENTS_ITEM_ACTION,role:r.HomeStore.getRole(),extra:{action_taken:e,scope:t,item_number:n,extension:i,sprite:s,subgroup_position:c}})},e.prototype.logOpenUnreadNotificationItem=function(e,t,n,o){var r=a.LoggingTypes.OPEN_UNREAD_ITEM,i={source:t,click_origin:n,position:o};return this.logNotification(r,e,i)},e.prototype.logMarkNotificationAsRead=function(e,t){var n=a.LoggingTypes.MARK_AS_READ,o={position:t};return this.logNotification(n,e,o)},e.prototype.logOpenStarredItem=function(e,t,n,i){return o.logHomeActivity({eventName:a.LoggingTypes.OPEN_STARRED_ITEM,role:r.HomeStore.getRole(),extra:{resource_id:e,resource_type:t,resource_ext:n,position:i}})},e.prototype.logUnstarItem=function(e,t,n,i){return o.logHomeActivity({eventName:a.LoggingTypes.UNSTAR_ITEM,role:r.HomeStore.getRole(),extra:{resource_id:e,resource_type:t,resource_ext:n,position:i}})},e.prototype.logUndoUnstarItem=function(e,t,n,i){return o.logHomeActivity({
eventName:a.LoggingTypes.UNDO_UNSTAR_ITEM,role:r.HomeStore.getRole(),extra:{resource_id:e,resource_type:t,resource_ext:n,position:i}})},e.prototype.logClickStarOverflowMenu=function(e,t,n,i){return o.logHomeActivity({eventName:a.LoggingTypes.CLICK_STAR_OVERFLOW_MENU,role:r.HomeStore.getRole(),extra:{resource_id:e,resource_type:t,resource_ext:n,position:i}})},e.prototype.logClickStarOverflowShare=function(e,t,n,i){return o.logHomeActivity({eventName:a.LoggingTypes.CLICK_STAR_OVERFLOW_SHARE,role:r.HomeStore.getRole(),extra:{resource_id:e,resource_type:t,resource_ext:n,position:i}})},e.prototype.logClickStarOverflowUpload=function(e,t,n,i){return o.logHomeActivity({eventName:a.LoggingTypes.CLICK_STAR_OVERFLOW_UPLOAD,role:r.HomeStore.getRole(),extra:{resource_id:e,resource_type:t,resource_ext:n,position:i}})},e.prototype.logClickRightMenu=function(e,t){var n=t?{modalSessionId:t}:{};return o.logHomeActivity({eventName:e,role:r.HomeStore.getRole(),extra:n})},e})();t.HomeActivityLogger=s,t.homeActivityLogger=new s}),define("modules/clean/react/home/util/logging/timing_component",["require","exports","tslib","external/react","modules/clean/react/home/util/logging/timing_logger"],function(e,t,n,o,r){"use strict";function i(e,t){return(function(i){function a(e){var t=i.call(this,e)||this;return r.homeTimingLogger.activate(),t}return n.__extends(a,i),a.prototype.componentDidMount=function(){r.homeTimingLogger.logTTI(t);var e=this.refs.wrapped,n=e.componentDidUpdate;e.componentDidUpdate=function(){r.homeTimingLogger.logTTI(t),n&&n.call(e)}},a.prototype.render=function(){return o.createElement(e,n.__assign({ref:"wrapped"},this.props))},a})(o.PureComponent)}t.timingComponent=i}),define("modules/clean/react/home/util/logging/timing_logger",["require","exports","modules/clean/js_client_stopwatch","modules/clean/web_timing_logger","modules/clean/react/home/util/logging/timing_state","modules/clean/react/home/util/logging/activity_logger","modules/clean/react/home/constants","modules/core/exception"],function(e,t,n,o,r,i,a,s){"use strict";var c=(function(){function e(){this.timingStates=new r.HomeTimingStates,this.logEnsurerHandle=null}return e.prototype.validateActivated=function(e,t){return null!==this.logEnsurerHandle||(s.reportStack("Did not activate when "+e+" before logging "+t,{severity:s.SEVERITY.NONCRITICAL}),!1)},e.prototype.activate=function(){var e=this;null===this.logEnsurerHandle&&(n.JSStopwatch.create_stopwatch_if_not_exist("home_access_tti"),this.logEnsurerHandle=setTimeout(function(){return s.reportException({err:new Error("Some Home sections did not log TTI after 60 seconds"),tags:["js:home"],exc_extra:{unlogged_components:e.timingStates.getSectionsPreTTI()}})},n.JSStopwatch.flush_interval))},e.prototype.logTTData=function(e){if(this.validateActivated(e,r.HomeTimingState.TTDATA)){this.timingStates.progressState(e,r.HomeTimingState.TTDATA)&&(a.LoggingSectionXHRs[e].forEach(function(e){return o.log_resource_timing(e)}),this.timingStates.haveAllSectionsReachedState(r.HomeTimingState.TTDATA)&&o.log_js_modules_fetched_data_required_for_tti())}},e.prototype.logTTI=function(e){if(this.validateActivated(e,r.HomeTimingState.TTI)){this.timingStates.progressState(e,r.HomeTimingState.TTI)&&(i.homeActivityLogger.logHomePageShown(),n.JSStopwatch.recordTrace(e,{stopwatchName:"home_access_tti"}),this.timingStates.haveAllSectionsReachedState(r.HomeTimingState.TTI)&&(o.mark_time_to_interactive(),n.JSStopwatch.flush_current_data(),clearTimeout(this.logEnsurerHandle)))}},e})();t._HomeTimingLogger=c,t.homeTimingLogger=new c}),define("modules/clean/react/home/util/logging/timing_state",["require","exports","external/underscore","modules/clean/react/home/constants"],function(e,t,n,o){"use strict";var r;(function(e){e[e.INIT=0]="INIT",e[e.TTDATA=1]="TTDATA",e[e.TTI=2]="TTI"})(r=t.HomeTimingState||(t.HomeTimingState={}));var i=(function(){function e(){var e=this;this.loggingSectionToState={},n.values(o.LoggingSections).forEach(function(t){return e.loggingSectionToState[t]=r.INIT})}return e.prototype.progressState=function(e,t){return this.loggingSectionToState[e]+1===t&&(this.loggingSectionToState[e]=t,!0)},e.prototype.getSectionsPreTTI=function(){return Object.keys(n.pick(this.loggingSectionToState,function(e){return e!==r.TTI}))},e.prototype.haveAllSectionsReachedState=function(e){return n.every(this.loggingSectionToState,function(t){return t>=e})},e})();t.HomeTimingStates=i}),define("modules/clean/react/home/util/navigation",["require","exports","modules/core/browser"],function(e,t,n){"use strict";function o(e){return e.metaKey||e.ctrlKey}function r(e,t,r,i){void 0===i&&(i=!0);var a=!1;r&&(r.preventDefault(),a=!(i||o(r))),a||n.open_tab(e),t().then(function(){a&&n.redirect(e)})}t.logAndNavigate=r}),define("modules/clean/react/home/util/static_tooltip",["require","exports","external/react","external/react-dom","modules/clean/react/bubble_dropdown_v2","modules/clean/react/sprite","modules/core/i18n"],function(e,t,n,o,r,i,a){"use strict";var s=(function(){function e(){var e=this;this.isTooltipTriggered=!1,this.onTooltipTriggerRendered=function(t){e.isTooltipTriggered||(e.isTooltipTriggered=!0,e.triggerButton=t,e.simulateTriggerButtonClick())},this.simulateTriggerButtonClick=function(){e.triggerButton.click()},this.show=function(t,s,c,l,d,u,m){void 0===m&&(m="");var p=n.createElement("button",{className:"home-tooltip__trigger-button",ref:e.onTooltipTriggerRendered,"aria-label":"close"}),_=n.createElement(r,{className:"home-tooltip",position:l,targetButton:p,onShowDropdown:d||function(){},onHideDropdown:u||function(){}},n.createElement("h4",{className:"home-tooltip__title"},t),s,n.createElement("button",{className:"home-tooltip__close-button",onClick:e.simulateTriggerButtonClick,"aria-label":a._("Close tooltip")},n.createElement(i,{group:"web",name:"lightbox_close",alt:a._("Close")}))),h=e.createMountingElement(m);c.appendChild(h),o.render(_,h)},this.hide=function(){e.simulateTriggerButtonClick()}}return e.prototype.createMountingElement=function(e){var t=document.createElement("DIV");return e&&(t.className=e),t.addEventListener("click",function(e){e.preventDefault()}),t},e})();s.POSITIONS=r.POSITIONS,t.StaticTooltip=s}),define("modules/clean/react/home/util/width_aware_component",["require","exports","tslib","external/react"],function(e,t,n,o){"use strict";function r(e){return(function(t){function r(){var e=t.call(this)||this;return e.updateWidth=function(){e.setState({width:e.getNewWidth()})},e.state={width:10},e}return n.__extends(r,t),r.prototype.componentWillMount=function(){this.updateWidth()},r.prototype.componentDidMount=function(){this.updateWidth(),window.addEventListener("resize",this.updateWidth)},r.prototype.componentWillUnmount=function(){window.removeEventListener("resize",this.updateWidth)},r.prototype.getNewWidth=function(){var e=document.getElementsByClassName("home");if(e.length){var t=getComputedStyle(e[0]).getPropertyValue("width");return parseInt(t.replace("px",""),10)}return 10},r.prototype.render=function(){return o.createElement(e,n.__assign({ref:"wrapped"},this.state,this.props))},r})(o.PureComponent)}function i(e,t,n,o,r,i){var a=[0,0,0,!1],s=a[0],c=a[1],l=a[2],d=a[3];if(e){var u=Math.floor((e+r)/(n+r));s=Math.max(1,Math.min(t,u)),c=(e-r*(s-1))/s,c=Math.max(n,Math.min(c,o)),l=Math.ceil(t/s),d=l>i}return{itemsPerRow:s,itemWidth:c,numRows:l,hasHiddenRows:d}}t.widthAwareComponent=r,t.calculateItemsToShow=i}),define("modules/clean/recent_activity/actions/federated_recent_activity_actions",["require","exports","modules/core/i18n","modules/core/browser","modules/clean/react/modal","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_dispatcher","modules/clean/recent_activity/recent_activity_client","modules/clean/recent_activity/recent_activity_federated_model","modules/clean/recent_activity/stores/federated_recent_activity_store","modules/core/exception","modules/core/notify","modules/clean/react/home/home_access/recents/actions","modules/clean/recent_activity/recent_activity_logger"],function(e,t,n,o,r,i,a,s,c,l,d,u,m,p){"use strict";function _(e,t,n){e?o.open_tab(e):d.reportStack("Cannot open tab to preform the action "+t,{severity:d.SEVERITY.NONCRITICAL,exc_extra:{paperRecentItem:n.paperRecentItem}})}function h(e,t,n){m.HomeRecentsActions.logEvent(e,n.cellView,[t.getFqPath()],1,1)}function g(e,t){h(p.ActionTypes.PAPER_SHARE,e,t),_(c.getPaperShareUrl(e),p.ActionTypes.PAPER_SHARE,e)}function E(e,t){h(p.ActionTypes.PAPER_OPEN,e,t),_(e.getUrl(),p.ActionTypes.PAPER_OPEN,e)}function y(e,t){a.recentActivityDispatcher.dispatch({type:e,activityKey:t})}function f(e,t,o){var a=e.getActivityKey();if(l.FederatedRecentActivityStore.canArchiveActivityKey(a)){var d=e.getActivityKey();r.SimpleModal.show({title_text:n._("Archive document?"),body_html:n._("Do you want to archive this document?"),confirm_text:n._("Archive"),cancel_text:n._("Cancel"),autoclose:!0,confirm_callback:function(){h(p.ActionTypes.PAPER_ARCHIVE,e,o),y(i.ARCHIVE_PAPER_DOCUMENT_PENDING,d),s.archivePaperResources(t,[e.paperRecentItem]).then(function(t){t.some(function(t){return c.equalsPaperRecentItem(e,t)})?(y(i.ARCHIVE_PAPER_DOCUMENT_COMMIT,d),u.success(n._("The document was archived."))):y(i.ARCHIVE_PAPER_DOCUMENT_ROLLBACK,d)},function(){return y(i.ARCHIVE_PAPER_DOCUMENT_ROLLBACK,d)})}})}}t.shareItem=g,t.previewItem=E,t.promptAndArchiveItem=f}),define("modules/clean/recent_activity/react/recent_activity_empty_state",["require","exports","external/react","modules/core/i18n"],function(e,t,n,o){"use strict";t.RecentActivityEmptyState=function(){return n.createElement("div",{className:"recents-empty_state",key:"empty_state"},n.createElement("div",{className:"recents-empty_state_image"}),n.createElement("div",{className:"recents-empty_state_heading"},o._("Items you recently viewed will show up here.")))},t.RecentActivityEmptyState.displayName="RecentActivityEmptyState"}),define("modules/clean/recent_activity/recent_activity_federated_converters",["require","exports","external/immutable","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_federated_model","modules/clean/recent_activity/recent_activity_view_models"],function(e,t,n,o,r,i){"use strict";function a(e,t,a){var s=new r.FederatedRecentItem(e),c=s.getActivityKey(),l={id:c,idType:e.id_type,resourceId:e.resource_id,type:o.RECENT_EVENT_TYPES.PAPER_VIEW,icon:s.getIcon(),when:e.time,viewingUserId:t.id,displayName:e.name,accountDisplayName:t.display_name,contextDisplayName:s.getFolderPath()||t.display_name,attachmentIds:n.List([c]),paths:n.List(e.path),order:a,filterTypesByKey:(u={},u[c]=o.RECENT_EVENT_FILTER_TYPE.DOCUMENTS,u)},d=i.createRecentItemJs(l);return d.federatedRecentItem=s,d;var u}t.createRecentItemFromPaperRecentItem=a}),define("modules/clean/recent_activity/recent_activity_federated_model",["require","exports","modules/clean/recent_activity/recent_activity_constants"],function(e,t,n){"use strict";function o(e){return e.paperRecentItem.type===n.PaperRecentItemTypes.DOCUMENT}function r(e){return e.paperRecentItem.type===n.PaperRecentItemTypes.PROJECT}function i(e){return o(e)?e.paperRecentItem.shareUrl||"":""}function a(e,t){return e.paperRecentItem.id===t.id&&e.paperRecentItem.type===t.type}t.isPaperDocument=o,t.isPaperProject=r,t.getPaperShareUrl=i,t.equalsPaperRecentItem=a;var s=(function(){function e(e){this.paperRecentItem=e}return e.prototype.isShareable=function(){return o(this)&&!!i(this)},e.prototype.isArchiveable=function(){return o(this)&&!!this.paperRecentItem.isEditable},e.prototype.hasMenuActions=function(){return this.isArchiveable()},e.prototype.getIdTypePair=function(){return{id:this.paperRecentItem.resource_id,type:this.paperRecentItem.id_type}},e.prototype.getStarredStatus=function(){return{starred:this.paperRecentItem.isFavorite,idTypePair:this.getIdTypePair()}},e.prototype.getIcon=function(){switch(this.paperRecentItem.display_type){case"PAPER_DOCUMENT":return"paper_doc";case"PAPER_FOLDER":return"folder";case"PAPER_PUBLIC_FOLDER":return"folder_team";case"PAPER_PROJECT":return"paper_project";default:return"file"}},e.prototype.getFolderPath=function(){return[""].concat(this.paperRecentItem.path.map(function(e){return e.name})).join("/")},e.prototype.getFqPath=function(){return this.getFolderPath()+"/"+this.paperRecentItem.name},e.prototype.getActivityKey=function(){return"paper_id_"+this.paperRecentItem.id},e.prototype.getUrl=function(){return this.paperRecentItem.url},e})();t.FederatedRecentItem=s}),define("modules/clean/recent_activity/recent_activity_prefetch",["require","exports","jquery","modules/clean/recent_activity/store_utils"],function(e,t,n,o){"use strict";function r(e,t){void 0===t&&(t=!1);var n=window;i(e,n.__REGISTER_RECENTS_PRELOAD_HANDLER),t&&a(e,n.__REGISTER_PAPER_RECENTS_PRELOAD_HANDLER)}function i(e,t){t?t(function(t){var r=n.Deferred();r.resolve({recentActivities:t.payload.recent_activities,cursor:t.payload.cursor,encrypted:t.payload.encrypted}),o.handleAndLogFetchRecentActivitiesPromise(r.promise(),e)},function(){return o.loadRecentItems(e)}):o.loadRecentItems(e)}function a(e,t){t?t(function(t){var r=n.Deferred();r.resolve({items:t.payload.items,hasMore:t.payload.has_more}),o.handleFetchPaperRecentsPromise(r.promise(),e,!0)},function(){return o.loadPaperRecentItems(e,!0)}):o.loadPaperRecentItems(e,!0)}t.preloadRecentItems=r}),define("modules/clean/recent_activity/recent_activity_starred",["require","exports","external/underscore","modules/clean/flux/dispatcher","modules/clean/react/starred/constants","modules/clean/react/starred/id_type_pair","modules/clean/react/starred/actions","modules/clean/recent_activity/recent_activity_federated_model","modules/clean/viewer"],function(e,t,n,o,r,i,a,s,c){"use strict";function l(e){e.length&&o.dispatch({type:r.StarredActionTypes.SET_STATUS,starredStatuses:e.map(function(e){return new s.FederatedRecentItem(e).getStarredStatus()})})}function d(e,t){var n=m(t);if(n.length){var o=c.get_viewer().get_user_by_id(e);a.StarredActions.fetchStatuses(o.role,n,!0)}}function u(e){return e.resource_id&&e.id_type?{id:e.resource_id,type:e.id_type}:null}function m(e){var t={};return e.forEach(function(e){var n=u(e);n&&(t[i.idTypePairToString(n)]=n)}),n.values(t)}t.setStarredStatusOfPaperRecentItems=l,t.fetchStarredStatus=d,t.getIdTypePair=u,t.getIdTypePairsByRecentActivityItems=m}),define("modules/clean/recent_activity/recent_activity_stream",["require","exports","external/underscore"],function(e,t,n){"use strict";function o(e,t){return e.when===t.when?e.order===t.order?t.type-e.type:e.order-t.order:t.when-e.when}function r(e){var t=e.filter(Boolean),r=n.max(t.map(function(e){return e.oldestTimeForOtherStream}));return(i=[]).concat.apply(i,t.map(function(e){return e.getItemsAfter(r)})).sort(o);var i}var i=(function(){function e(e,t){var n=this;this.sortedRecentItems=e,this.hasMore=t,this.activityKeyToRecentItem={},e.forEach(function(e){n.activityKeyToRecentItem[e.id]=e}),this.oldestTimeForOtherStream=this.getOldestItemTimeForOtherStreams()}return e.prototype.getOldestItemTimeForOtherStreams=function(){return this.hasMore&&this.sortedRecentItems.length?this.sortedRecentItems[this.sortedRecentItems.length-1].when:0},e.prototype.getRecentItems=function(){return this.sortedRecentItems.slice()},e.prototype.getRecentItemByActivityKey=function(e){return this.activityKeyToRecentItem[e]||null},e.prototype.getStreamWithoutActivityKey=function(t){return new e(this.sortedRecentItems.filter(function(e){return e.id!==t}),this.hasMore)},e.prototype.getItemsAfter=function(e){if(this.oldestTimeForOtherStream<e){for(var t=[],n=0,o=this.sortedRecentItems;n<o.length;n++){var r=o[n];if(r.when<e)break;t.push(r)}return t}return this.sortedRecentItems},e})();t.RecentActivityStream=i,t.getMergedRecentItems=r}),define("modules/clean/recent_activity/stores/federated_recent_activity_store",["require","exports","tslib","external/underscore","modules/clean/react/home/constants","modules/clean/react/home/util/logging/timing_logger","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_dispatcher","modules/clean/recent_activity/recent_activity_federated_converters","modules/clean/recent_activity/recent_activity_starred","modules/clean/recent_activity/recent_activity_stream","modules/clean/viewer","modules/core/exception","modules/clean/flux/flux_store"],function(e,t,n,o,r,i,a,s,c,l,d,u,m,p){"use strict";var _=(function(e){function t(){var t=e.call(this,s.recentActivityDispatcher)||this;return t.federatedOriginToRecentActivityStream={},t.didReceiveRawRecentActivities=!1,t.activityKeyToPendingDeletion={},t}return n.__extends(t,e),t.prototype.didReceiveItemsFromAllStreams=function(){return this.didReceiveRawRecentActivities&&o.size(this.federatedOriginToRecentActivityStream)>0},t.prototype.getRecentActivityStreams=function(){return o.values(this.federatedOriginToRecentActivityStream)},t.prototype.canArchiveActivityKey=function(e){return this.mapFederatedRecentItem(e,function(e){return e.isArchiveable()},!1)&&!this.activityKeyToPendingDeletion[e]},t.prototype.logTtd=function(){this.didReceiveItemsFromAllStreams()&&i.homeTimingLogger.logTTData(r.LoggingSections.RECENTS)},t.prototype.mapFederatedRecentItem=function(e,t,n){return this.mapRecentItem(e,function(e){return e.federatedRecentItem?t(e.federatedRecentItem):n},n)},t.prototype.mapRecentItem=function(e,t,n){var o=this.getRecentItemByActivityKey(e);return o?t(o):n},t.prototype.accessRecentActivityStream=function(e,t){e in this.federatedOriginToRecentActivityStream&&t(this.federatedOriginToRecentActivityStream[e])},t.prototype.getRecentItemByActivityKey=function(e){var t=this,n=[];return o.values(a.FederatedOrigins).forEach(function(o){t.accessRecentActivityStream(o,function(t){var o=t.getRecentItemByActivityKey(e);o&&n.push(o)})}),m.reportStack("activity key matches multiple items.",{severity:m.SEVERITY.NONCRITICAL,exc_extra:{recentItems:n}}),n.length?n[0]:null},t.prototype.onReceiveRawRecentActivity=function(e){var t=e.userId,n=e.rawRecentActivities;l.fetchStarredStatus(t,o.values(n)),this.didReceiveRawRecentActivities=!0,this.logTtd()},t.prototype.onReceivePaperRecentItems=function(e,t,n){var o=u.get_viewer().get_user_by_id(n),r=e.map(function(e,t){return c.createRecentItemFromPaperRecentItem(e,o,t)});this.federatedOriginToRecentActivityStream[a.FederatedOrigins.PAPER]=new d.RecentActivityStream(r,t),l.setStarredStatusOfPaperRecentItems(e),this.logTtd()},t.prototype.onArchivePaperDocumentPending=function(e){this.activityKeyToPendingDeletion[e]=!0},t.prototype.onArchivePaperDocumentCommit=function(e){var t=this;delete this.activityKeyToPendingDeletion[e],this.accessRecentActivityStream(a.FederatedOrigins.PAPER,function(n){t.federatedOriginToRecentActivityStream[a.FederatedOrigins.PAPER]=n.getStreamWithoutActivityKey(e)})},t.prototype.onArchivePaperDocumentRollback=function(e){delete this.activityKeyToPendingDeletion[e]},t.prototype.__onDispatch=function(e){switch(e.type){case a.RECEIVE_PAPER_RECENT_ITEMS:this.onReceivePaperRecentItems(e.items,e.hasMore,e.userId);break;case a.RECEIVE_RAW_RECENT_ACTIVITIES:this.onReceiveRawRecentActivity(e);break;case a.ARCHIVE_PAPER_DOCUMENT_PENDING:this.onArchivePaperDocumentPending(e.activityKey);break;case a.ARCHIVE_PAPER_DOCUMENT_COMMIT:this.onArchivePaperDocumentCommit(e.activityKey);break;case a.ARCHIVE_PAPER_DOCUMENT_ROLLBACK:this.onArchivePaperDocumentRollback(e.activityKey);break;default:return}this.__emitChange()},t})(p);t.FederatedRecentActivityStoreClass=_,t.FederatedRecentActivityStore=new _}),define("modules/clean/recent_activity/stores/recent_activity_cache",["require","exports","tslib","modules/clean/recent_activity/recent_activity_dispatcher","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/stores/recent_activity_store","modules/clean/recent_activity/stores/federated_recent_activity_store","modules/clean/recent_activity/versions/recent_activity_version_shared","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_stream","modules/clean/flux/flux_store"],function(e,t,n,o,r,i,a,s,c,l,d){"use strict";function u(e){return e.length>c.MAX_RECENT_ITEM_COUNT_ON_RECENTS_V2}var m=(function(e){function t(){var t=e.call(this,o.recentActivityDispatcher)||this;return t.userIdAndFilterTypeToRecentItems={},t}return n.__extends(t,e),t.prototype.getRecentItemsFromAllStreams=function(e,t){var n=a.FederatedRecentActivityStore.getRecentActivityStreams();return n.push(new l.RecentActivityStream(s.getRecentItemsFromAntenna(e,t),!!i.recentActivityStore.cursorForUser(e))),l.getMergedRecentItems(n)},t.prototype.clearCache=function(){this.userIdAndFilterTypeToRecentItems={}},t.prototype.__onDispatch=function(e){switch(e.type){case r.RECEIVE_PAPER_RECENT_ITEMS:case r.RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY:case r.RECEIVE_RAW_RECENT_ACTIVITIES:case r.DELETE_FILES_COMMIT:case r.ARCHIVE_PAPER_DOCUMENT_COMMIT:this.clearCache();break;default:return}this.__emitChange()},t.prototype.getAllRecentItems=function(e,t){var n=e+":"+t;return n in this.userIdAndFilterTypeToRecentItems||(this.userIdAndFilterTypeToRecentItems[n]=this.getRecentItemsFromAllStreams(e,t)),this.userIdAndFilterTypeToRecentItems[n]},t.prototype.getRecentItems=function(e,t){var n=this.getAllRecentItems(e,t);return u(n)?n.slice(0,c.MAX_RECENT_ITEM_COUNT_ON_RECENTS_V2):n},t.prototype.shouldLoadMore=function(e,t){return!u(this.getAllRecentItems(e,t))},t})(d);t.RecentActivityCache=new m}),define("modules/clean/recent_activity/versions/recent_activity_actions_menu_version_2",["require","exports","external/classnames","external/mcl/overflow_button","external/react","modules/core/i18n","modules/clean/react/bubble_menu","modules/clean/react/sprite_div","modules/clean/recent_activity/versions/recent_activity_version_shared"],function(e,t,n,o,r,i,a,s,c){"use strict";function l(e,t,n,o){return r.createElement(a.BubbleMenuItem,{className:"recents-actions-list__item recents-actions-list__item--"+e,key:e,onClick:o},r.createElement(s,{group:"web",name:n,text:t,alt:""}))}function d(e){var t=e.props.permissions;return[e.canOpen()?l("open",c.ACTION_LABELS.OPEN,"open",e.onOpen):null,t.download?l("download",e.getDownloadLabel(),"open",e.onDownload):null,t.comment?l("comment",c.ACTION_LABELS.COMMENT,"s_file_comment",e.onComment):null,t.delete?l("delete",e.getDeleteLabel(),"delete_16",e.onDelete):null,t.archive?l("archive",c.ACTION_LABELS.ARCHIVE,"delete_16",e.onArchive):null,t.versions?l("versions",c.ACTION_LABELS.VERSION,"previous_versions",e.onVersions):null,e.canSelect()?l("select",c.ACTION_LABELS.SELECT,"select",e.onSelectAll):null,e.canDeselect()?l("deselect",c.ACTION_LABELS.DESELECT,"deselect",e.onDeselectAll):null].filter(Boolean)}function u(e){var t=n({"recents-item__actions-button":!0,"button-secondary":!0,disabled:e.props.disableActions});return r.createElement(o.OverflowButton,{className:t,"aria-label":i._("More Actions"),tabIndex:0})}function m(e){return e.props.disableActions?u(e):r.createElement(a.BubbleMenu,{targetButton:u(e),arrow_position:"top",bubbleDropdownShown:e.props.tooltipHandler.onShowTooltip,bubbleDropdownHidden:e.props.tooltipHandler.onHideTooltip,items:d(e),position:a.BubbleMenu.POSITIONS.BOTTOM,ref:"moreActionDropdown"})}t.renderMoreActionsButton=m}),define("modules/clean/recent_activity/versions/recent_activity_version_2",["require","exports","tslib","external/react","modules/clean/recent_activity/actions/federated_recent_activity_actions","modules/clean/browse_interface","modules/clean/recent_activity/stores/attachment_store","modules/clean/recent_activity/react/recent_activity_empty_state","modules/clean/recent_activity/recent_activity_prefetch","modules/clean/recent_activity/stores/recent_activity_cache","modules/clean/recent_activity/store_utils","modules/clean/recent_activity/stores/federated_recent_activity_store","modules/clean/react/home/home_access/recents/actions","modules/clean/recent_activity/recent_activity_logger","modules/clean/react/starred/store","modules/core/exception","modules/clean/react/starred/star","modules/clean/react/home/store","modules/clean/recent_activity/recent_activity_constants","modules/clean/react/home/home_access/onboarding/constants","modules/clean/react/home/home_access/onboarding/store","modules/clean/react/home/home_access/onboarding/helpers","modules/clean/react/home/util/navigation","modules/clean/react/sprite","modules/clean/recent_activity/versions/recent_activity_version_shared","modules/clean/recent_activity/versions/recent_activity_actions_menu_version_2"],function(e,t,n,o,r,i,a,s,c,l,d,u,m,p,_,h,g,E,y,f,S,v,R,T,I,A){"use strict";function N(e,t){return 1===t.length?t[0]:0===t.length&&1===e.attachmentIds.length?a.attachmentStore.getById(e.attachmentIds[0]):null}function O(e,t){return e.fqPath?String(i.browse_uri_for_fq_path(t,e.fqPath)):e.previewInfo?e.previewInfo.href||null:null}function C(e,t,n){var o=a.attachmentStore.getByIds(t.attachmentIds).map(function(e){return e.fqPath}).filter(Boolean);return m.HomeRecentsActions.logEvent(e,n.cellView,o,n.totalCount),Promise.resolve()}function b(e,t,n,o,r){R.logAndNavigate(e,function(){return C(t,n,o)},r,!0)}function L(e,t,n,o){if(e.federatedRecentItem)r.previewItem(e.federatedRecentItem,n);else{var i=E.HomeStore.getUser(),a=N(e,t);a?d.ensureAttachments(i.id,[a.id],function(t){if(1===t.length){var r=O(t[0],i);if(r)return void b(r,p.ActionTypes.VIEW_FILE,e,n)}o()}):o()}}function D(e){return e.resourceId&&e.idType?{id:e.resourceId,type:e.idType}:null}var P=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.renderStar=function(e,t){if(t.onboardingItem)return o.createElement(g.Star,{id:f.HOME_ONBOARDING_FAKE_FILE_DATA.idTypePair.id,idType:f.HOME_ONBOARDING_FAKE_FILE_DATA.idTypePair.type,role:e,overrides:v.getStarOverrides()});var n=D(t);return n?o.createElement(g.Star,{id:n.id,idType:n.type,role:e}):null},t.prototype.renderEmptyState=function(e){return o.createElement(s.RecentActivityEmptyState,null)},t.prototype.maybeRenderSelectAllButton=function(){return null},t.prototype.getRemoveStoreListeners=function(t){var n=e.prototype.getRemoveStoreListeners.call(this,t),o=_.StarredStore.addListener(t),r=S.HomeOnboardingStore.addListener(t),i=u.FederatedRecentActivityStore.addListener(t),a=l.RecentActivityCache.addListener(t);return function(){n(),o(),r(),i(),a()}},t.prototype.getRecentItems=function(e,t){var n=[];return u.FederatedRecentActivityStore.didReceiveItemsFromAllStreams()&&(n=l.RecentActivityCache.getRecentItems(e,t)),S.HomeOnboardingStore.showFakeFileInRecents()&&(n=n.slice(),n.unshift({id:f.HOME_ONBOARDING_FAKE_FILE_DATA.idTypePair.id,when:Date.now(),order:-1,type:1,icon:f.HOME_ONBOARDING_FAKE_FILE_DATA.icon,viewingUserId:e,displayName:f.HOME_ONBOARDING_FAKE_FILE_DATA.fileName,accountDisplayName:"",contextDisplayName:"",attachmentIds:[],paths:[{name:"Dropbox",url:""}],filterTypesByKey:{},onboardingItem:!0})),n},t.prototype.didReceiveRecentActivities=function(){return u.FederatedRecentActivityStore.didReceiveItemsFromAllStreams()},t.prototype.isStoreReadyForUserId=function(e,t){return this.didReceiveRecentActivities()},t.prototype.loadPreFetchedPage=function(e){c.preloadRecentItems(e,!0)},t.prototype.loadPage=function(t,n){void 0===n&&(n=!1),e.prototype.loadPage.call(this,t,n),d.loadPaperRecentItems(t,!0,n)},t.prototype.shareRecentItem=function(t,n,o){t.federatedRecentItem?r.shareItem(t.federatedRecentItem,o):e.prototype.shareRecentItem.call(this,t,n,o)},t.prototype.previewOrOpenRecentItem=function(t,n,o,r){var i=this;L(t,n,r,function(){e.prototype.previewOrOpenRecentItem.call(i,t,n,o,r)})},t.prototype.previewRecentItem=function(t,n,o,r){var i=this;L(t,n,r,function(){e.prototype.previewRecentItem.call(i,t,n,o,r)})},t.prototype.deleteRecentItem=function(t,n,o){t.federatedRecentItem?h.reportStack("Deleting is not supported for federated recent items",{severity:h.SEVERITY.NONCRITICAL,exc_extra:{recentItem:t}}):e.prototype.deleteRecentItem.call(this,t,n,o)},t.prototype.archiveRecentItem=function(t,n){t.federatedRecentItem?r.promptAndArchiveItem(t.federatedRecentItem,t.viewingUserId,n):e.prototype.archiveRecentItem.call(this,t,n)},t.prototype.shouldLoadMore=function(e,t){return l.RecentActivityCache.shouldLoadMore(e,t)},t.prototype.handlePathClick=function(e,t,n){b(e.currentTarget.href,p.ActionTypes.OPEN_PATH,t,n,e)},t.prototype.shouldRenderItemActions=function(e){for(var t in e)if("share"!==t&&e[t])return!0;return!1},t.prototype.getShareButtonVisibility=function(e,t){return e.federatedRecentItem?e.federatedRecentItem.isShareable()?y.RecentElementVisibilities.SHOWN:y.RecentElementVisibilities.HIDDEN:t?y.RecentElementVisibilities.SHOWN:y.RecentElementVisibilities.HIDDEN},t.prototype.maybeInitLoggingAndGetTTILogger=function(){return function(){return null}},t.prototype.renderRecentActivityContainer=function(e,t,n){return e},t.prototype.renderSection=function(e,t,n,r,i){return o.createElement("li",{className:"recents-section",key:e},r,i)},t.prototype.renderItemActionsPlaceholder=function(){return o.createElement(T,{className:"recents-item__more-actions-placeholder",group:"web",name:"overflow-glyph",alt:"…"})},t.prototype.prefetchOnMount=function(e){this.loadPreFetchedPage(e)},t.prototype.renderMoreActionsElement=function(e){return A.renderMoreActionsButton(e)},t})(I.RecentActivityVersionShared);t.RecentActivityVersion2=new P}),define("modules/clean/recent_activity/versions/recent_activity_version_shared",["require","exports","modules/core/i18n","modules/clean/recent_activity/actions/recent_activity_actions","modules/clean/recent_activity/recent_activity_model","modules/clean/recent_activity/store_utils","modules/clean/recent_activity/stores/recent_activity_store","modules/core/exception"],function(e,t,n,o,r,i,a,s){"use strict";function c(e,t){return a.recentActivityStore.filterItemsForUser(e,t)}var l=(function(){function e(){}return e.prototype.getRemoveStoreListeners=function(e){return a.recentActivityStore.addListener(e)},e.prototype.loadPage=function(e,t){void 0===t&&(t=!1),i.loadRecentItems(e,{isBackgroundRequest:t})},e.prototype.shareRecentItem=function(e,t,n){var i=e.viewingUserId;if(1===e.attachmentIds.length||1===t.length)o.shareFile(i,t[0].id,n);else{var a=r.extractAttachmentIds(t);o.shareCollection(i,a,n)}},e.prototype.previewOrOpenRecentItem=function(e,t,n,r){if(n.shouldBrowse){var i=t[0].entityUri;i?o.browseFile(i):s.reportStack("Missing entityUri. Cannot browse/preview",{severity:s.SEVERITY.NONCRITICAL,exc_extra:{recent_item:e,attachments:t}})}else this.previewRecentItem(e,t,n,r)},e.prototype.previewRecentItem=function(e,t,n,i){o.previewFiles(e.viewingUserId,r.extractAttachmentIds(t),{index:n.index||0,shouldFocusCommentInput:n.shouldFocusCommentInput===!0},i)},e.prototype.deleteRecentItem=function(e,t,n){o.promptAndDeleteAttachments(e.viewingUserId,r.extractAttachmentIds(t),n)},e.prototype.archiveRecentItem=function(e,t){s.reportStack("Archiving is not supported",{severity:s.SEVERITY.NONCRITICAL,exc_extra:{recentItem:e}})},e})();t.RecentActivityVersionShared=l,t.getRecentItemsFromAntenna=c,t.ACTION_LABELS={OPEN:n._("Open"),COMMENT:n._("Comment"),ARCHIVE:n._("Archive"),VERSION:n._("Version history"),SELECT:n._("Select all"),DESELECT:n._("Deselect all")}});
//# sourceMappingURL=pkg-maestro-home.min.js-vfllfZStv.map