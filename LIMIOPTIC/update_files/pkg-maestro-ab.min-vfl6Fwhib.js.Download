(function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/captcha",["jquery","external/react","external/react-dom","modules/clean/ajax","modules/clean/react/recaptcha_challenge","modules/core/i18n","modules/core/notify"],function(t,r,i,n,o,s,a){var c,l;return c=s._,l=r.createElement,(function(){function r(t,r,i,n,o,s,a){var c;this.parent_form=t,this.captcha_div=r,this.other_recaptcha_div=i,this.endpoint=n,this.email_name=o,this.variant=s,this.is_v2=a,this.captcha_display_handler=e(this.captcha_display_handler,this),this._hide_other_captcha=e(this._hide_other_captcha,this),this._hide_captcha_v2=e(this._hide_captcha_v2,this),this._hide_captcha=e(this._hide_captcha,this),this._show_captcha_v2=e(this._show_captcha_v2,this),this._show_captcha=e(this._show_captcha,this),this.$recaptcha_container=null!=(c=this.parent_form.find(this.captcha_div))?c[0]:void 0,this.$recaptcha_react_component=null}return r.prototype._show_captcha=function(e,t){var r,n;return null==(null!=(n=this.$recaptcha_container)?n.children:void 0)&&(this.$recaptcha_react_component=null),null==this.$recaptcha_react_component?(r=l(o,{public_key:e,variant:this.variant,error:t}),this.$recaptcha_react_component=i.render(r,this.$recaptcha_container)):this.$recaptcha_react_component.reload(t)},r.prototype._show_captcha_v2=function(e,r){return t("#"+this.captcha_div).parent().show(),t("#"+this.captcha_div).children().length?"undefined"!=typeof grecaptcha&&null!==grecaptcha?grecaptcha.reset():void 0:"undefined"!=typeof grecaptcha&&null!==grecaptcha?grecaptcha.render(this.captcha_div,{sitekey:e}):void 0},r.prototype._hide_captcha=function(){var e;if(null==(null!=(e=this.$recaptcha_container)?e.children:void 0)&&(this.$recaptcha_react_component=null),null!=this.$recaptcha_react_component)return i.unmountComponentAtNode(this.$recaptcha_container),this.$recaptcha_react_component=null},r.prototype._hide_captcha_v2=function(){return t("#"+this.captcha_div).parent().hide()},r.prototype._hide_other_captcha=function(){var e;if(e=t(this.other_recaptcha_div)[0],null!=(null!=e?e.children:void 0))return i.unmountComponentAtNode(e)},r.prototype.captcha_display_handler=function(e){return n.WebRequest({url:this.endpoint,data:{email:this.parent_form.find("input[name='"+this.email_name+"']").val()},success:(function(t){return function(r){var i;try{return i=JSON.parse(r),i.needs_captcha?(t._hide_other_captcha(),t.is_v2?t._show_captcha_v2(i.recaptcha_v2_public_key,e):t._show_captcha(i.recaptcha_public_key,e)):t.is_v2?t._hide_captcha_v2():t._hide_captcha()}catch(e){return e,a.error(c("There was a problem completing this request."))}}})(this)})},r})()})}).call(this),function(){define("modules/clean/form_util/name_parser",[],function(){return(function(){function e(){}return e.splitFullName=function(e){var t,r,i;return i=e.split(" "),t=i[0],r=i.slice(1).join(" "),[t,r]},e})()})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/header_bubble",[],function(){return(function(){function t(t,r){this.$element=t,this.options=r,this.hide=e(this.hide,this),this.$element.parent().addClass("active"),this.$element.find(".confirm-button").on("click",this.hide),this.$element.find(".dismiss-button").on("click",this.hide)}return t.prototype.hide=function(e){return"#"===e.target.getAttribute("href")&&e.preventDefault(),this.$element.parent().removeClass("active")},t})()})}.call(this),function(){define("modules/clean/hi_res",["jquery"],function(e){return(function(){function t(e){var t;this.constructor._show_hi_res()&&(t=e.attr("data-hi-res-no-resize"),this.constructor.set_src(e,e.attr("data-hi-res"),t),this.constructor.set_bg(e,e.attr("data-hi-res-background"),t))}return t.set_src=function(e,t,r){if(this._show_hi_res())return t&&t!==e.attr("src")?this._replace(e,t,!r,this._replace_img):void 0},t.set_bg=function(e,t,r){if(this._show_hi_res())return this._replace(e,t,!r,this._replace_background)},t._show_hi_res=function(){return"devicePixelRatio"in window&&window.devicePixelRatio>1},t._replace=function(t,r,i,n){var o;if(r)return o=new Image,o.src=r,e(o).on("load",function(){return n(t,r,i,o.width,o.height)})},t._replace_img=function(e,t,r,i,n){if(e.attr("src",t),r)return e.width(i/2),e.height(n/2)},t._replace_background=function(e,t,r,i,n){var o;if(o="url('%(src)s')".format({src:t}),e.css("backgroundImage",o),r)return e.css("backgroundSize",i/2+"px "+n/2+"px")},t})()})}.call(this),define("modules/clean/legacy_pyxl_controllers/login_form",["require","exports","external/cyfd","external/pixie","external/u2f-api","jquery","modules/clean/ajax","modules/clean/captcha","modules/clean/legacy_pyxl_controllers/ajax_form","modules/clean/profile_services/profile_services_constants","modules/clean/profile_services/profile_services_link","modules/clean/sso_login_checks","modules/constants/pixie","modules/core/browser","modules/core/html","modules/core/i18n","modules/core/notify","modules/core/uri"],function(e,t,r,i,n,o,s,a,c,l,u,h,_,d,p,f,g,m){"use strict";var v=new i.Pixie(_).get_specter();v.start();var y=(function(){function t(t,r,i,n,s,l,u,_,p,f){void 0===n&&(n=!1),void 0===s&&(s=!0),void 0===l&&(l=!1),void 0===u&&(u=null),void 0===_&&(_=null),void 0===p&&(p=!0),void 0===f&&(f=!0);var g=this;if(this.loginType=r,this.variant=i,this.inlineGoogleLoginErrors=l,this.signupTag=u,this.signupEndpoint=_,this.canRedirect=p,this.keepUrlFragment=f,this.multiLogin="multi"===this.loginType,this.pairing="pairing"===this.loginType,this.$loginForm=t.find(".login-form"),this.$googleAuthContainer=t.find(".login-form-container__google-div"),this.$allTwoFactorForms=t.find(".two-factor-form"),this.$twoFactorPhoneForm=t.find(".two-factor-form.2fa-phone-form"),this.$twoFactorSeckeyForm=t.find(".two-factor-form.2fa-seckey-form"),this.$loginViaEmailForm=t.find(".login-via-email-link"),this.$twoFactorForm=this.$twoFactorPhoneForm,n||e(["modules/clean/unity/features/web_destiny_ui"],function(e){new e(t).maybe_show_web_destiny()}),this.loginController=new c(this.$loginForm,this.beforeSubmit.bind(this),{should_submit_once:!0}),this.$loginForm.find(".recaptcha_v2_challenge").length){var v=o(this.$loginForm.find(".recaptcha_v2_challenge"));this.$captchaComponent=new a(this.$loginForm,v.attr("id"),null,"/needs_captcha","login_email",this.variant,!0)}else this.$captchaComponent=new a(this.$loginForm,"#react-login-recaptcha-challenge-div","#react-signup-recaptcha-challenge-div","/needs_captcha","login_email",this.variant);this.$loginForm.on(c.SUCCESS_EVENT,this.loginSuccess.bind(this)),this.$loginForm.on(c.ERROR_EVENT,function(e,t){var r=null!=t?t.recaptcha_response:void 0;return g.$captchaComponent.captcha_display_handler(r),g.$loginForm.find(".login-via-email-blade-link").click(g.loginViaEmailStart.bind(g))}),this.$loginForm.is(":visible")&&this.$captchaComponent.captcha_display_handler();var y=m.parse(this.$loginForm.find("input[name='cont']").val());this.keepUrlFragment&&y.setFragment(window.location.hash.substr(1)),this.cont=y.toString(),this.twoFactorPhoneController=new c(this.$twoFactorPhoneForm,function(){return null},{should_submit_once:!0}),this.twoFactorSeckeyController=new c(this.$twoFactorSeckeyForm,function(){return null},{should_submit_once:!0}),this.twoFactorController=this.twoFactorPhoneController,this.$twoFactorPhoneForm.on(c.SUCCESS_EVENT,this.twoFactorSuccess.bind(this)),this.$twoFactorSeckeyForm.on(c.SUCCESS_EVENT,this.twoFactorSuccess.bind(this)),this.$twoFactorSeckeyForm.on(c.ERROR_EVENT,function(e,t){return g.$twoFactorSeckeyForm.find(".two-factor-seckey-instructions .error-msg").text(t.u2f.message_text),g.$twoFactorSeckeyForm.find(".two-factor-seckey-instructions").toggle()}),this.$twoFactorPhoneForm.find(".resend-two-factor-code").click(this.resendCode.bind(this)),this.$twoFactorSeckeyForm.find(".two-factor-use-phone-instead").click(this.usePhoneInstead.bind(this)),this.$twoFactorSeckeyForm.find(".two-factor-seckey-retry").click(this.retryU2fChallenge.bind(this)),null!=this.$loginViaEmailForm&&this.$loginViaEmailForm.click(this.loginViaEmailStart.bind(this)),this.$googleAuthContainer.find(".auth-google").click(this.googleLogin.bind(this)),this.$googleAuthContainer.find(".auth-google").prop("disabled",!1);var w=this.$twoFactorSeckeyForm.find("input[name='u2f_challenge']").val();w&&this.signU2fChallenge(w),this.$loginForm.find(".sso-optout a").click(function(){return g.hideSso(!0)}),this.$loginForm.find(".login-button").attr("disabled",null),this.$loginForm.find(".login-button.disabled-button").prop("disabled",!0),s&&t.find(".login-need-help a").click(function(e){e.preventDefault();var t=o(e.target).attr("href"),r=encodeURIComponent(g.$loginForm.find("input[name='login_email']").val());return d.redirect(t+"?email_from_login="+r)}),this.setFocusToPassword(),new h.SsoLoginChecks(this.$loginForm.find("input[name='login_email']"),this.showSso.bind(this),this.hideSso.bind(this))}return t.prototype.ie8SafeFocus=function(e){try{e.focus()}catch(e){}},t.prototype.setFocusToPassword=function(){this.$loginForm.find("input[name='login_email']").first().val()&&this.ie8SafeFocus(this.$loginForm.find("input[name='login_password']")[0])},t.prototype.setFocusToTwofactor=function(){this.ie8SafeFocus(this.$twoFactorForm.find("input[name='code']").val(""))},t.prototype.googleLogin=function(){c.clear_errors(this.$loginForm);var e="on"===this.$loginForm.find("input[name='remember_me']").val(),t=new u.ProfileServicesLinkingHandler,r=this.$googleAuthContainer.find(".auth-google").data("is-popup");t.auth_service_login_web(l.GOOGLE,this.googleLoginCallback.bind(this),"login_form",r,e,this.cont,this.pairing)},t.prototype.googleLoginCallback=function(e){if(e.success)g.success(f._("Log in successful! Your browser will be redirected in a few seconds.")),s.SilentBackgroundRequest({url:"/profile_services/log",data:{event_name:"login_callback_success"}}),d.redirect(this.cont?this.cont:"/home");else if(s.SilentBackgroundRequest({url:"/profile_services/log",data:{event_name:"login_callback_error"}}),"emails_do_not_match_redirect"===e.err_msg){var t=this.getThirdPartyAuthUrl(e,!0);d.redirect(t)}else"emails_do_not_match"===e.err_msg&&this.inlineGoogleLoginErrors&&!this.pairing?this.handleEmailsDoNotMatch(e):"tfa_required"===e.err_msg?this.redirectToPath(e,"/verify_code"):"not_verified"===e.err_msg?this.redirectToPath(e,"/show_password_form"):(e.localized_error&&g.error(e.localized_error),"google_login_not_allowed"!==e.err_msg&&"sso_required"!==e.err_msg||this.fillInEmail(e.profile.email))},t.prototype.handleEmailsDoNotMatch=function(e){var t=this.getThirdPartyAuthUrl(e,!1);this.$googleAuthContainer.find(".third-party-signup-link").attr("href",t),this.$googleAuthContainer.find(".google-login-error").removeClass("u-l-dn")},t.prototype.getThirdPartyAuthUrl=function(e,t){var r={fname:e.profile.given_name,lname:e.profile.family_name,email:e.profile.email,picture_url:e.profile.picture_url,refresh_token:e.refresh_token,email_sig:e.email_sig,automatic_redirect:t.toString(),cont:this.cont};return this.signupTag&&(r.signup_tag=this.signupTag),this.signupEndpoint&&(r.signup_endpoint=this.signupEndpoint),String(new m({path:"/third_party_signup"}).updateQuery(r))},t.prototype.fillInEmail=function(e){this.$loginForm.find("input[name='login_email']").val(e),this.$loginForm.find("input[name='login_email']").trigger("input"),this.setFocusToPassword()},t.prototype.redirectToPath=function(e,t){var r=new m({path:t}).updateQuery({cont:this.cont,remember_me:e.remember_me.toString(),pair_user:e.pair_user.toString()});d.redirect(r.toString())},t.prototype.beforeSubmit=function(){r.cfsubmit(),this.loginController.add_additional_data({specter_login_tm:v.dump()})},t.prototype.showSso=function(e){this.$loginForm.find("input[name='login_password']").val(""),this.$loginForm.addClass("sso-required"),e&&this.$loginForm.addClass("sso-optional")},t.prototype.hideSso=function(e){if(void 0===e&&(e=!1),this.$loginForm.removeClass("sso-required sso-optional"),e)try{this.$loginForm.find("input[name='login_password']").focus()}catch(e){}},t.prototype.browserSupportsU2F=function(){return void 0!==MessageChannel},t.prototype.showLogin=function(){this.$twoFactorForm.hide(),o(".login-register-header, .login-register-switch").show(),this.$loginForm.show(),this.$loginForm.find("input[name='login_password']").val(""),this.$googleAuthContainer.show()},t.prototype.setupTwoFactor=function(e){e.u2f_challenge&&this.browserSupportsU2F()&&(this.$twoFactorForm=this.$twoFactorSeckeyForm,this.twoFactorController=this.twoFactorSeckeyController,this.signU2fChallenge(e.u2f_challenge)),e.last_four_digits?(this.$allTwoFactorForms.addClass("hide-authenticator"),this.$twoFactorPhoneForm.find(".last-four-digits").text(e.last_four_digits)):this.$allTwoFactorForms.addClass("hide-sms"),this.$twoFactorForm.find("input[name='remember_me']").val(e.remember_me),this.showTwoFactor()},t.prototype.showTwoFactor=function(){o(".login-register-header, .login-register-switch").hide(),this.$loginForm.hide(),this.$googleAuthContainer.hide(),this.$twoFactorForm.show(),this.setFocusToTwofactor()},t.prototype.loginSuccess=function(e,t){switch(t.status){case"OK":return this.finishLogin(t);case"TWOFACTOR":return this.setupTwoFactor(t);case"TWOFACTOR_REQUIRED":return d.redirect(t.cont);case"LOGIN_VIA_EMAIL_REQUIRED":var r=t.email,i=new m({path:t.cont}).updateQuery({email:r});return d.redirect(i.toString());case"SSO":return d.unsafeRedirect(t.sso_url);case"RATELIMIT":return this.fillLoginError(f._("You’ve tried to log in too many times. Please try again in a few minutes."));case"ERROR":var n=t.html_response?new p(t.message):t.message;return g.error(n),this.loginController._clear_pending(!0);case"EXPIRED":return d.redirect(t.cont);default:return g.error(f._("There was a problem completing this request."))}},t.prototype.twoFactorSuccess=function(e,t){switch(t.status){case"OK":return this.$twoFactorSeckeyForm.find(".seckey-loading-status").toggle(),this.finishLogin(t);case"EXPIRED":return this.switchFromTwoFactorToLoginError(t.message);case"REQUIRES_ROLE":return this.switchFromTwoFactorToLoginError(t.message);case"ERROR":return g.error(t.message);default:return g.error(f._("There was a problem completing this request."))}},t.prototype.switchFromTwoFactorToLoginError=function(e){this.twoFactorController._clear_pending(!0),this.loginController._clear_pending(!0),this.showLogin(),this.fillLoginError(e),this.setFocusToPassword()},t.prototype.resendCodeSuccess=function(e){switch(e){case"OK":return g.success(f._("We sent you a code. It may take a few minutes to arrive."));case"RATELIMIT":return this.fillTwoFactorError(f._("You’ve tried to log in too many times. Please try again in a few minutes."));case"UNREACHABLE":return this.fillTwoFactorError(f._("We couldn’t reach your phone number. Are you sure it’s correct?"));case"EXPIRED":return this.fillTwoFactorError(f._("Sorry, your phone code has expired. Please log in again."));case"BADCARRIER":return this.fillTwoFactorError(f._("Unfortunately, your carrier isn’t supported at this time."));case"INVALIDNUMBER":return this.fillTwoFactorError(f._("That isn’t a valid phone number."));case"NOTAMOBILE":return this.fillTwoFactorError(f._("That phone number doesn’t appear to be a valid mobile number."));default:return g.error(f._("There was a problem completing this request."))}},t.prototype.resendCode=function(){return s.WebRequest({url:"/twofactor_resend",data:{backup:this.$twoFactorForm.find("input[name='backup']").val()},success:this.resendCodeSuccess.bind(this),error:function(){return g.error(f._("There was a problem completing this request."))}}),!1},t.prototype.usePhoneInstead=function(){return this.$twoFactorSeckeyForm.hide(),this.$twoFactorPhoneForm.show(),this.$twoFactorForm=this.$twoFactorPhoneForm,this.$twoFactorPhoneForm.hasClass("hide-authenticator")&&this.resendCode(),this.setFocusToTwofactor(),!1},t.prototype.retryU2fChallenge=function(){var e=this;return s.WebRequest({url:"/account/twofactor/u2f_start_authentication",success:function(t){e.$twoFactorSeckeyForm.find(".two-factor-seckey-instructions").toggle(),e.signU2fChallenge(t)},error:function(){g.error(f._("There was a problem completing this request."))}}),!1},t.prototype.signU2fChallenge=function(e){var t=this;if(this.browserSupportsU2F()){var r=JSON.parse(e);return n.sign(r.authenticateRequests,function(e){t.$twoFactorSeckeyForm.find(".text-input-input").val(JSON.stringify(e)),t.$twoFactorSeckeyForm.submit()})}},t.prototype.loginViaEmailStart=function(){var e=this;return c.clear_errors(this.$loginForm),s.WebRequest({url:"/ajax_login_via_email_start",data:{login_email:this.$loginForm.find("input[name='login_email']").val(),remember_me:"on"===this.$loginForm.find("input[name='remember_me']").val()},success:function(){g.success(f._("We emailed you a sign in link. Please check your inbox."))},error:function(t,r,i){return c.fill_errors(e.$loginForm,JSON.parse(i))}}),!1},t.prototype.fillLoginError=function(e){c.fill_errors(this.$loginForm,{login_email:{message_text:e}})},t.prototype.fillTwoFactorError=function(e){c.fill_errors(this.$twoFactorForm,{code:{message_text:e}})},t.prototype.finishLogin=function(e){var r=this.$loginForm.find("input[type='hidden'][name=refresh_token]").val(),i=this.$loginForm.find("input[type='hidden'][name=email_sig]").val();r&&i&&s.WebRequest({url:"/profile_services/link_google_service_with_user",subject_user:e.id,data:{service:l.GOOGLE,refresh_token:r,email_sig:i}});var n=this.multiLogin?t.MULTI_LOGIN_SUCCESS:t.LOGIN_SUCCESS;this.$loginForm.trigger(n,e),this.cont&&this.canRedirect&&d.redirect(this.cont)},t})();return y.LOGIN_SUCCESS="db:login:success",y.MULTI_LOGIN_SUCCESS="db:multilogin:success",y}),function(){define("modules/clean/legacy_pyxl_controllers/login_or_register",["jquery","modules/clean/register_form"],function(e,t){return(function(){function r(r){this.$login_form=r.find(".login-register-login-part"),this.$register_form=r.find(".login-register-register-part"),r.click((function(t){return function(r){if(e(r.target).hasClass("login-register-switch-link"))return r.preventDefault(),t._toggle_forms(),t.$login_form.find(".text-input input:visible").first().focus(),t.$register_form.find(".text-input input:visible").first().focus()}})(this)),this.$register_form.on(t.USER_EXISTS,(function(e){return function(t){var r,i,n;e._toggle_forms(),i=t.prefill;for(r in i)n=i[r],e.$login_form.find(r).val(n);return e.$login_form.find(t.focus).focus()}})(this))}return r.prototype._toggle_forms=function(){return this.$login_form.toggle(),this.$register_form.toggle()},r})()})}.call(this),function(){var e=function(e,r){function i(){this.constructor=e}for(var n in r)t.call(r,n)&&(e[n]=r[n]);return i.prototype=r.prototype,e.prototype=new i,e.__super__=r.prototype,e},t={}.hasOwnProperty;define("modules/clean/legacy_pyxl_controllers/tooltip",["jquery","external/underscore","modules/core/controller_helpers"],function(t,r,i){var n,o,s;return s=[],n=(function(){function e(e,t,n){var o,s,a,c;this.$wrapper=e,this.prompt=this.$wrapper.find(".tooltip-prompt"),this.tooltip=this.$wrapper.find(".tooltip-tooltip"),this.hover_target=this.find_hover_target(),this.position_global=t,this.tooltip_location=n,this.listen(),o=i.clone_element(this.tooltip).appendTo("body"),o.css({position:"static",display:"inline-block"}),s=500,c=o.width()+1,c>s&&(c=s),this.tooltip.css({width:c,position:"absolute",display:"none"}),o.remove(),this.position_global&&this.tooltip.remove().appendTo("body"),this.is_focusable()&&(a=r.uniqueId("tooltip-tooltip-"),this.tooltip.attr({role:"tooltip",id:a}),this.hover_target.attr({tabindex:0,"aria-describedby":a}))}return e.prototype.tooltip_shown=!1,e.prototype.position_global=!1,e.prototype.listen=function(){var e,t,r,i,n;for(i=[this.hover_target,this.tooltip],n=[],t=0,r=i.length;t<r;t++)e=i[t],e.mouseenter((function(e){return function(){return clearTimeout(e.tooltip.data("timeout_id")),e.show_tooltip()}})(this)),e.mouseleave((function(e){return function(){var t;return t=setTimeout(function(){return e.hide_tooltip()},200),e.tooltip.data("timeout_id",t)}})(this)),this.is_focusable()?(e.focusin((function(e){return function(){return clearTimeout(e.tooltip.data("timeout_id")),e.show_tooltip()}})(this)),n.push(e.focusout((function(e){return function(){var t;return t=setTimeout(function(){return e.hide_tooltip()},200),e.tooltip.data("timeout_id",t)}})(this)))):n.push(void 0);return n},e.prototype.find_hover_target=function(){return this.prompt},e.prototype.is_focusable=function(){return!1},e.prototype.show_tooltip=function(e){var t,r,i,n,o,a,c;if(!this.tooltip_shown){for(o=this.position_global?this.hover_target.offset():this.hover_target.position(),r=0,n=s.length;r<n;r++)c=s[r],c.hide_tooltip();return s.push(this),"top"===this.tooltip_location?(a=o.top-this.tooltip.outerHeight()-this.hover_target.height()/2,i=o.left-this.tooltip.outerWidth()/2,t={top:"-=7"}):"left"===this.tooltip_location?(a=o.top-this.tooltip.outerHeight()/2+this.hover_target.outerHeight()/2,i=o.left-this.tooltip.outerWidth()-2,t={left:"-=7"}):"bottom"===this.tooltip_location?(a=o.top+this.hover_target.outerHeight(),i=o.left-this.tooltip.outerWidth()/2+this.hover_target.outerWidth()/2,t={top:"+=7"}):(a=o.top-this.tooltip.outerHeight()/2+this.hover_target.outerHeight()/2,i=o.left+this.hover_target.width()+2,t={left:"+=7"}),this.tooltip.css({top:a,left:i}).show().animate(t,50),this.tooltip_shown=!0}},e.prototype.hide_tooltip=function(){var e;if(this.tooltip_shown)return clearTimeout(this.tooltip.data("timeout_id")),this.tooltip.hide(),this.tooltip_shown=!1,e=s.indexOf(this),e!==-1?s.splice(e,1):void 0},e})(),o=(function(t){function r(){return r.__super__.constructor.apply(this,arguments)}return e(r,t),r.prototype.find_hover_target=function(){return this.prompt.find(".sprite")},r.prototype.is_focusable=function(){return!0},r})(n),{DBTooltip:n,InfoTooltip:o}})}.call(this),function(){define("modules/clean/legacy_ui_button",["jquery"],function(e){return function(){var t;return t=e(document),e(document).on("mouseover.ui-button",".ui-button",function(){return e(this).addClass("over")}).on("mouseout.ui-button",".ui-button",function(){return e(this).removeClass("over")}).on("mousedown.ui-button",".ui-button",function(){return e(this).addClass("down")}).on("click.ui-button",".ui-button",function(){var r;return r=e(this),r.hasClass("ui-button-dropdown")&&(r.hasClass("active")?t.trigger("dropdownClosed",[1]):t.trigger("dropdownOpened",[1])),r.toggleClass("active")}),t.on("click.ui-button",function(r){var i,n,o;return i=e(r.target),n=i.closest(".ui-button.active"),o=0,e(".ui-button.active").not(n).each(function(){var t;return t=e(this),t.hasClass("active")&&t.hasClass("ui-button-dropdown")&&(o+=1),t.removeClass("active")}),t.trigger("dropdownClosed",[o])}).on("mouseup.ui-button",function(){return e(".ui-button.down").removeClass("down")})}})}.call(this),function(){define("modules/clean/mailcheck",["jquery","modules/core/html","modules/core/i18n"],function(e,t,r){var i;return i=r._,(function(){function e(e,t,r){var i;this.$input=e,this.$suggestion_container=t,null==r&&(r={}),this.checkInput(),i=r.livecheck===!0?"keyup blur":"blur",this.$input.on(i,this.checkInput.bind(this))}return e.DOMAINS=["gmail.com","hotmail.com","yahoo.com","aol.com","web.de","gmx.de","googlemail.com","me.com","live.com","msn.com","mail.ru","comcast.net","google.com","mac.com"],e.WHITELIST_REGEXS=[/ymail.com/,/yahoo\.co\./,/yahoo\.com\./,/hotmail\.co\./,/hotmail\.com\./,/gmx\.net/,/gmx\.at/,/gmx\.ch/,/gmx\.com/,/mail\.com/,/web\.com/],e.THRESHOLD=2,e.prototype.checkInput=function(){var e;e=this.suggest(this.$input.val()),e?this.populate(e):this.clear()},e.prototype.populate=function(e){var r,n,o;return o=t.escape(e.local).toHTML(),r=t.escape(e.domain).toHTML(),n=o+"@<span class='email_warning_area'>"+r+"</span>",this.$suggestion_container.html(new t(i("Did you mean <a>%(suggested_email)s</a>?").format({suggested_email:n})).toHTML()),this.$suggestion_container.show(),this.$suggestion_container.on("click",(function(t){return function(){return t.$input.val(e.full),t.clear()}})(this))},e.prototype.clear=function(){return this.$suggestion_container.empty(),this.$suggestion_container.hide()},e.prototype.suggest=function(e){var t,r,i,n;if(null==e&&(e=""),e.length)return e=e.toLowerCase(),!!(n=this.splitEmail(e))&&(i=n.local,r=n.domain,!this.whitelistedDomain(r)&&(t=this.findClosestDomain(r),!!t&&{local:i,domain:t,full:i+"@"+t}))},e.prototype.whitelistedDomain=function(t){var r,i,n,o;for(o=e.WHITELIST_REGEXS,r=0,i=o.length;r<i;r++)if(n=o[r],n.test(t))return!0;return!1},e.prototype.splitEmail=function(e){var t;return t=e.split("@"),2===t.length&&{local:t[0],domain:t[1]}},e.prototype.findClosestDomain=function(t){var r,i,n,o,s,a,c;for(a=99,i=null,c=e.DOMAINS,o=0,s=c.length;o<s;o++)r=c[o],n=this.stringDistance(t,r),n<a&&(a=n,i=r);return!!(i&&i!==t&&a<=e.THRESHOLD)&&i},e.prototype.stringDistance=function(e,t){var r,i,n,o,s,a;if(null==e||0===e.length)return null==t||0===t.length?0:t.length;if(null==t||0===t.length)return e.length;for(r=0,s=0,a=0,n=0,o=5;r+s<e.length&&r+a<t.length;){if(e.charAt(r+s)===t.charAt(r+a))n++;else for(s=0,a=0,i=0;i<o;){if(r+i<e.length&&e.charAt(r+i)===t.charAt(r)){s=i;break}if(r+i<t.length&&e.charAt(r)===t.charAt(r+i)){a=i;break}i++}r++}return(e.length+t.length)/2-n},e})()})}.call(this),define("modules/clean/marketing_tracker",["require","exports","modules/core/exception"],function(e,t,r){"use strict";var i=(function(){function e(){var t=this;this.push=function(i){var n=i.dataLayer;return t.src=i.src,r.assert(!!t.src,"MarketingTracker.push requires src"),e.el||(e.el=t.load(t.src)),!e.ready&&e.el?e.el.addEventListener("load",function(){if(e.ready=!0,e&&e.el)return e.el.contentWindow.postMessage(n,"https://marketing.dropbox.com")}):e.el.contentWindow.postMessage(n,"https://marketing.dropbox.com"),t},this.load=function(e){var t=document.createElement("iframe");return t.style.display="none",t.hidden=!0,t.src=e,t.setAttribute("sandbox","allow-scripts allow-same-origin"),document.body.appendChild(t),t},e.el=null,e.ready=!1}return e})();i.ready=!1,t.MarketingTracker=new i}),function(){define("modules/clean/photos/legacy_thumb_loader",["jquery","modules/clean/photos/batch_thumb_loader","modules/clean/sprite"],function(e,t,r){return{MAX_THUMB_BATCH_REQUESTS:24,batch_load_thumbs:function(i,n,o,s){var a,c,l,u,h,_,d,p,f,g;for(g=e.grep(i,function(t){return e(t).data("src")}),this.img_map={},u=0,_=g.length;u<_;u++)l=g[u],p=String(e(l).data("src")),null==(c=this.img_map)[p]&&(c[p]=[]),this.img_map[p].push(l);for(this.instance?this.instance.reset({batch_size:n,batch_logger:s}):this.instance=new t({batch_size:n,max_parallel_requests:this.MAX_THUMB_BATCH_REQUESTS,on_batch:(function(t){return function(r){var i,n,o,s,a;for(s=[],n=0,o=r.length;n<o;n++)a=r[n],i=e(t.img_map[a]),i.data("src",null),s.push(i.data("loading-src",a));return s}})(this),batch_logger:s}),[],h=0,d=g.length;h<d;h++)l=g[h],a=e(l),f=a.data("src"),this.instance.queue_thumb(f,function(e,t,i,n){if(n||t.data("loading-src"))return t.data("loading-src",null),0===i.indexOf("data:image")?(t.attr("src",i),"function"==typeof o?o(t[0]):void 0):(t.error(function(){return t.attr("src",t.data("fail-src")||r.SPACER)}),t.load(function(){return"function"==typeof o?o(t[0]):void 0}),t.attr("src",i))}.bind(this,f,a));return this.instance.flush(),g.length},clear_all_pending_batches:function(){var e;return null!=(e=this.instance)?e.clear():void 0}}})}.call(this),define("modules/clean/profile_services/auth_callback_handler",["require","exports","modules/core/browser","modules/core/notify","modules/core/uri","modules/clean/ajax","modules/core/i18n"],function(e,t,r,i,n,o,s){"use strict";function a(e,t,r){e.success&&e.user_id?l(t.cont):e.success?u({emailSig:e.email_sig,refreshToken:e.refresh_token,profile:e.profile},t,r):_({errMsg:e.err_msg,rememberMe:e.remember_me,pairUser:e.pair_user,profile:e.profile,emailSig:e.email_sig,refreshToken:e.refresh_token},t.cont,r)}function c(e,t){if(e.success)i.success(s._("Log in successful!")),o.SilentBackgroundRequest({url:"/profile_services/log",data:{event_name:"login_callback_success",value:"success"}}),t.onSuccess(),t.redirectOnSuccess&&r.redirect(t.cont);else if(o.SilentBackgroundRequest({url:"/profile_services/log",data:{event_name:"login_callback_error",value:e.err_msg}}),"access_denied"===e.err_msg)i.error(s._("You need to accept Google’s request in order to log in."));else if("emails_do_not_match"===e.err_msg)i.error(s._("We couldn’t find a Dropbox account matching that email."));else if("google_login_not_allowed"===e.err_msg)i.error(s._("Google sign in is disabled. Sign in with your Dropbox password or ask your                      Dropbox admin for help."));else if("sso_required"===e.err_msg)i.error(s._("Your team has single sign-on. Sign in with your Dropbox password or ask your                      Dropbox admin for help."));else if("tfa_required"===e.err_msg){var a=new n({path:"/verify_code",query:{cont:t.cont,remember_me:String(e.remember_me),pair_user:String(e.pair_user)}}).toString();r.redirect(a)}else if("disabled_account"===e.err_msg)i.error(s._("This account is disabled."));else if("invalid_pair_target"===e.err_msg)i.error(s._("That account can’t be paired. Paired account must be a personal account."));else if("already_paired"===e.err_msg)i.error(s._("That account is already paired to another account."));else if("error_pairing"===e.err_msg)i.error(s._("There was an error pairing."));else if("not_verified"===e.err_msg){var a=new n({path:"/show_password_form",query:{cont:t.cont,remember_me:String(e.remember_me),pair_user:String(e.pair_user)}}).toString();r.redirect(a)}else i.error(s._("We couldn’t log you in with Google.  Try again?"))}function l(e){r.redirect(e)}function u(e,t,i){var o={fname:e.profile.given_name,lname:e.profile.family_name,email:e.profile.email,picture_url:e.profile.picture_url,email_sig:e.emailSig,refresh_token:e.refreshToken,cont:t.cont,signup_tag:t.signupTag};null!=t.k&&(o.k=t.k),null!=t.eh&&(o.eh=t.eh),null!=t.signupEndpoint&&(o.signup_endpoint=t.signupEndpoint),i&&h(i.form,i.newAccount,o),t.canRedirect&&r.redirect(new n({path:"/third_party_signup",query:o}).toString())}function h(e,t,r){e.trigger(t,r)}function _(e,t,o){if("tfa_required"===e.errMsg){var a={cont:t};null!=e.pairUser&&(a.pair_user=e.pairUser.toString()),null!=e.rememberMe&&(a.remember_me=e.rememberMe.toString()),r.redirect(new n({path:"/verify_code",query:a}).toString())}else if("sso_required"===e.errMsg){var a={email:e.profile.email,cont:t};r.redirect(new n({path:"/login",query:a}).toString())}else"user_exists"===e.errMsg?(o&&h(o.form,o.userExists,{focus:"input[name=login_password]",prefill:{".login-email":e.profile.email,"input[type='hidden'][name=refresh_token]":e.refreshToken,"input[type='hidden'][name=email_sig]":e.emailSig}}),i.error(s._("This email address is already taken. Please sign in."))):i.error(s._("Unable to link to Google. Please refresh the page to try again."))}t.handleRegisterResponse=a,t.handleLoginResponse=c}),function(){define("modules/clean/react/recaptcha_challenge",["jquery","external/react","modules/clean/react/form_error_mixin","modules/clean/react/input","modules/core/i18n","modules/clean/static_urls"],function(e,t,r,i,n,o){var s,a,c,l,u;return a=n._,u=o.static_url,s=i.text,l=t.DOM,c=t.createElement,t.createClass({displayName:"RecaptchaChallenge",mixins:[r],getDefaultProps:function(){return{public_key:"",errorWrapperClassName:"text-input-error-wrapper",variant:"standard",onInputChange:null}},componentDidMount:function(){var t;return t=this.props.public_key,e.getScript("https://www.google.com/recaptcha/api/js/recaptcha_ajax.js",function(){return Recaptcha.create(t,"recaptcha_widget",{theme:"custom"})})},handleReloadLinkClick:function(){return Recaptcha.reload()},handleSwitchTypeToAudioLinkClick:function(){return Recaptcha.switch_type("audio")},
handleSwitchTypeToImageLinkClick:function(){return Recaptcha.switch_type("image")},handleHelpLinkClick:function(){return Recaptcha.showhelp()},_renderButtons:function(){return l.div({className:this.props.variant+" recaptcha-buttons"},l.a({className:"recaptcha-button recaptcha-reload",onClick:this.handleReloadLinkClick},l.img({src:u("/static/images/icons/captcha-reload-vflqH90Ce.png")})),l.a({className:"recaptcha-button recaptcha_only_if_image",onClick:this.handleSwitchTypeToAudioLinkClick},l.img({src:u("/static/images/icons/captcha-audio-vfl_VBPgQ.png")})),l.a({className:"recaptcha-button recaptcha_only_if_audio",onClick:this.handleSwitchTypeToImageLinkClick},l.img({src:u("/static/images/icons/captcha-words-vfl-bt9Xw.png")})),l.a({className:"recaptcha-button recaptcha-show-help",onClick:this.handleHelpLinkClick},l.img({src:u("/static/images/icons/captcha-help-vfleUYtSD.png")})))},_renderRecaptchaResponseInput:function(){return c(s,{id:"recaptcha_response",name:"recaptcha_response",className:"login-text-input","disable-errors":!0,placeholder:a("Type the text"),onChange:this.props.onInputChange})},_renderDummyInput:function(){return l.input({type:"hidden",id:"recaptcha_response_field"})},_renderStandard:function(){var e;return e=this.renderErrorIfEnabled(),l.div({id:"recaptcha_widget",className:"standard recaptcha-container"},e,l.div({id:"recaptcha_image",className:"standard login-recaptcha-challenge-container"}),this._renderRecaptchaResponseInput(),this._renderButtons(),this._renderDummyInput())},_renderSmall:function(){var e;return e=this.renderErrorIfEnabled(),l.div({id:"recaptcha_widget",className:"small recaptcha-container"},e,l.div({id:"recaptcha_image",className:"small login-recaptcha-challenge-container"}),this._renderButtons(),this._renderRecaptchaResponseInput(),this._renderDummyInput())},render:function(){return"standard"===this.props.variant?this._renderStandard():"small"===this.props.variant?this._renderSmall():void 0},reload:function(){return Recaptcha.reload()}})})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/register_form",["jquery","external/cyfd","external/pixie","external/underscore","modules/clean/ajax","modules/clean/captcha","modules/clean/legacy_pyxl_controllers/ajax_form","modules/clean/em_string","modules/clean/form_util/name_parser","modules/clean/mailcheck","modules/clean/profile_services/auth_callback_handler","modules/clean/profile_services/profile_services_constants","modules/clean/profile_services/profile_services_link","modules/constants/pixie","modules/constants/subgrowth_experiments","modules/core/accessible_announce","modules/core/browser","modules/core/i18n","modules/core/notify","modules/core/uri"],function(t,r,i,n,o,s,a,c,l,u,h,_,d,p,f,g,m,v,y,w){var b,k,$,S,F,C,T;return C=h.handleRegisterResponse,k=d.ProfileServicesLinkingHandler,b=g.AccessibleAnnounce,v._,T=new i.Pixie(p).get_specter(),T.start(),F=function(){return r.cfsubmit()},S=(function(){function e(e,r,i){var n,o,a;this.$form=t(r),(null!=(a=this.$form.find(".recaptcha_v2_challenge"))?a.length:void 0)?(n=t(this.$form.find(".recaptcha_v2_challenge")),this.$captcha_component=new s(this.$form,n.attr("id"),null,"/ajax_needs_business_signup_captcha","email",e,!0)):this.$captcha_component=new s(this.$form,"#react-signup-recaptcha-challenge-div","#react-login-recaptcha-challenge-div","/ajax_needs_business_signup_captcha","email",e),i&&(o={message_text:i}),this.$captcha_component.captcha_display_handler(o),this.$form.on("submit",(function(e){return function(e){return F()}})(this))}return e})(),$=(function(){function r(r,i,n,o,l,h,d,p,f){var g,m,v,y,w,b,$,S;this.$register_form_container=r,this.can_redirect=n,this.show_form=o,this.client_side_validation=l,this.custom_error_handler=h,this.combined_name=d,this.last_name_goes_first=p,this.signup_endpoint=f,this._combined_name_handler=e(this._combined_name_handler,this),this._index_error_handler=e(this._index_error_handler,this),this._animate_form=e(this._animate_form,this),this._on_register_error=e(this._on_register_error,this),this._on_register_success=e(this._on_register_success,this),this._before_submit=e(this._before_submit,this),this._handle_google_callback=e(this._handle_google_callback,this),this.$register_form=this.$register_form_container.find(".register-form"),w={client_side_validation:this.client_side_validation,error_handler:!1},"index"===this.custom_error_handler&&(w.error_handler=this._index_error_handler,this.$register_form.on("click change","input",this._index_clear_error_handler)),this.register_controller=new a(this.$register_form,this._before_submit,w),this.cont=this.$register_form.find("input[name='cont']").val(),this.$register_form.find(".login-button, .auth-google").prop("disabled",!1),this.$register_form.find(".login-button.disabled-button").prop("disabled",!0),(null!=(S=this.$register_form.find(".recaptcha_v2_challenge"))?S.length:void 0)?(v=t(this.$register_form.find(".recaptcha_v2_challenge")),this.$captcha_component=new s(this.$register_form,v.attr("id"),null,"/ajax_needs_signup_captcha","email",i,!0)):this.$captcha_component=new s(this.$register_form,"#react-signup-recaptcha-challenge-div","#react-login-recaptcha-challenge-div","/ajax_needs_signup_captcha","email",i),g=this.$register_form.find("label[for='tos_agree']"),y=parseInt(g.css("font-size")),$=200,new c(g.text()).length*y>$&&this.$register_form.find(".checkbox").removeClass("checkbox-inline"),this.$register_form.on(a.SUCCESS_EVENT,this._on_register_success),this.$register_form.on(a.ERROR_EVENT,this._on_register_error),this.show_form?(m=this.$register_form.find("input[type='hidden'][name='is_third_party_auth']").val(),m&&(b=function(e,r){return!t(r).val()},this.$register_form_container.find("input").filter(":visible").filter(b).first().focus()),this.$register_form.is(":visible")&&this.$captcha_component.captcha_display_handler()):this.$register_form.find(".login-button").on("click",(function(e){return function(t){if(!e.$register_form_container.hasClass("form_shown"))return t.preventDefault(),e._animate_form()}})(this)),this.$register_form.find(".auth-google").click((function(e){return function(t){var r,i,n;return r=function(t){return e._handle_google_callback(t)},n="true"===t.target.getAttribute("data-third-party-no-popup"),i=new k,i.auth_service_create_user_if_needed(_.GOOGLE,r,"register_form",!n)}})(this)),"small"===i?(this.$register_form.find(".bubble-dropdown-container .bubble-dropdown").css({visibility:"hidden"}),this.$register_form.find(".password-input-meter").css({cursor:"default"})):new u(this.$register_form.find(".input-email"),this.$register_form.find(".email-suggestion"),{livecheck:!1})}return r.REGISTER_SUCCESS="db:register:success",r.NEW_ACCOUNT_FROM_3RD_PARTY="db:register:new_account_from_3rd_party",r.USER_EXISTS="db:register:user_exists",r.prototype._handle_google_callback=function(e){var t,i,n,o,s,a;return i="/home","V1"===f.SUBGROWTH_USER_TRIALS?i="/pro-upgrade":"V4"!==(s=f.SUBGROWTH_USER_TRIALS)&&"V5"!==s||(i="/select-upgrade"),t=this.$register_form.find("input[type='hidden'][name='cont']").val()||i,a=this.$register_form.find("input[type='hidden'][name='signup_tag']").val(),o=this.$register_form.find("input[type='hidden'][name='k']").val(),n=this.$register_form.find("input[type='hidden'][name='eh']").val(),C(e,{cont:t,signupTag:a,canRedirect:this.can_redirect,k:o,eh:n,signupEndpoint:this.signup_endpoint},{form:this.$register_form,newAccount:r.NEW_ACCOUNT_FROM_3RD_PARTY,userExists:r.USER_EXISTS})},r.prototype._before_submit=function(){return this.combined_name===!0&&this._combined_name_handler(),F(),this.register_controller.add_additional_data({specter_signup_tm:T.dump(),signup_endpoint:this.signup_endpoint})},r.prototype._on_register_success=function(e,t){if(this.$register_form.trigger(r.REGISTER_SUCCESS,t),this.can_redirect){if(this.cont)return m.redirect(this.cont);if(t.redirect_url)return m.redirect(t.redirect_url)}},r.prototype._on_register_error=function(e,t){return this.$captcha_component.captcha_display_handler(null!=t?t.recaptcha_response:void 0)},r.prototype._animate_form=function(){if(!this.$register_form_container.hasClass("form_shown"))return t.when(this.$register_form_container.animate({height:this.$register_form.height()},{easing:"easeInOutCubic",duration:500})).done((function(e){return function(){return e.$register_form_container.addClass("form_shown"),e.$register_form_container.filter(":input").filter(":visible").first().focus(),e.$captcha_component.captcha_display_handler()}})(this))},r.prototype.fill=function(e){return n.each(e,(function(e){return function(t,r){return e.$register_form.find("[name="+r+"]").val(t)}})(this))},r.prototype._index_error_handler=function(e){var r,i,n,o,s;this.$register_form_container.find(".register-form__errors").remove(),r=t("<ul />").addClass("register-form__errors"),s=[];for(n in e)i=e[n],o=i.message_text||i.message_html,s.push(o),t("<li />").addClass("register-form__error").html(o).appendTo(r),this.$register_form.find(".input-"+n).addClass("text-input--error"),"tos_agree"===n&&this.$register_form.find(".checkbox-inline.agree").addClass("checkbox-inline--error"),this.combined_name&&"fname"===n&&(this.$register_form.find(".input-fullname").addClass("text-input--error"),this.$register_form.find("input[name='fullname']").addClass("input-error")),this.$register_form.find("input[name='"+n+"']").addClass("input-error");return this.$register_form_container.append(r),b.assertive(s.join(". "))},r.prototype._index_clear_error_handler=function(e){var r;return r=t(e.target),r.removeClass("input-error"),"checkbox"===r.attr("type")?r.parents(".checkbox-inline--error").removeClass("checkbox-inline--error"):r.parents(".text-input--error").removeClass("text-input--error")},r.prototype._combined_name_handler=function(){var e,t,r,i,n,o;if(e=this.$register_form_container.find('input[name="fullname"]'),t=this.$register_form_container.find('input[name="fname"]'),r=this.$register_form_container.find('input[name="lname"]'),n=l.splitFullName(e.val()),i=n[0],o=n[1],this.last_name_goes_first!==!0){if(t.val(i),void 0!==o&&o!==i)return r.val(o)}else if(r.val(i),void 0!==o&&o!==i)return t.val(o)},r})(),{RegisterNamesAndCredentialsWithCaptcha:S,RegisterForm:$}})}.call(this),function(){define("modules/clean/shared_link_error",["jquery","modules/clean/ajax"],function(e,t){return(function(){function r(){e("#broken-share-article").on("click",function(){return t.WebRequest({url:"/shared_link_error_log",data:{evt:i}})})}var i;return i="click-sharing-article",r})()})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/sso_login_checks",["modules/clean/ajax"],function(t){var r;return r=(function(){function r(t,r,i,n){this.$email_input=t,this.show_sso_fn=r,this.hide_sso_fn=i,this.should_trigger_check=null==n||n,this.check_sso_state=e(this.check_sso_state,this),this._trigger_check_sso_state=e(this._trigger_check_sso_state,this),this.should_trigger_check&&(this._trigger_check_sso_state(),this.$email_input.on("input keyup change",this._trigger_check_sso_state))}return r._sso_check_in_flight={},r._sso_check_cache={},r.prototype._trigger_check_sso_state=function(){var e;return e=this.$email_input.val(),this.check_sso_state(e)},r.prototype.check_sso_state=function(e){var i,n;return n=e.trim(),n.match(/^[^@\s]+@[^@\s]+\.[A-Za-z]{2,}$/)?(i=n.toLowerCase(),i in r._sso_check_cache?this._handle_sso_state(r._sso_check_cache[i]):r._sso_check_in_flight[i]?void 0:(r._sso_check_in_flight[i]=!0,t.WebRequest({url:"/sso_state",data:{email:n},success:(function(t){return function(n){return n=JSON.parse(n),delete r._sso_check_in_flight[i],r._sso_check_cache[i]=n.user_sso_state,t.should_trigger_check&&t.$email_input.val()!==e?t._trigger_check_sso_state():t._handle_sso_state(n.user_sso_state)}})(this),error:(function(e){return function(){return delete r._sso_check_in_flight[i],e.hide_sso_fn()}})(this)}))):this.hide_sso_fn()},r.prototype._handle_sso_state=function(e){return"required"===e?this.show_sso_fn(!1):"optional"===e?this.show_sso_fn(!0):this.hide_sso_fn()},r})(),{SsoLoginChecks:r}})}.call(this),function(){var e=function(e,r){function i(){this.constructor=e}for(var n in r)t.call(r,n)&&(e[n]=r[n]);return i.prototype=r.prototype,e.prototype=new i,e.__super__=r.prototype,e},t={}.hasOwnProperty;define("modules/clean/upsell/header_bubble_or_link",["modules/clean/header_bubble","modules/clean/upsell/exception","modules/clean/upsell/upsell_controller"],function(t,r,i){return(function(t){function n(e,t){var o,s;this.$el=e,this.options=t;try{s=new i(this.$el.find(".confirm-button"),this.$el.find(".dismiss-button"),this.options),s.log_impression(),n.__super__.constructor.apply(this,arguments)}catch(e){o=e,r.reportJsControllerException({err:o,js_controller_options:this.options})}}return e(n,t),n})(t)})}.call(this),define("modules/clean/ux_analytics",["require","exports"],function(e,t){"use strict";function r(){return(new Date).getTime()}function i(){var e=document.documentElement;return(window.pageYOffset||e.scrollTop)-(e.clientTop||0)}function n(e){return void 0===e&&(e=window),e.location.href}function o(e){return void 0===e&&(e=window),e.location.search}function s(e,t,i){void 0===i&&(i={});var n=null,o=0;return function(){var s=r();o||i.leading!==!1||(o=s);var a=t-(s.valueOf()-o.valueOf()),c=arguments;if(a<=0||a>t)n&&(clearTimeout(n),n=null),o=s,e.apply(null,c),c=null;else if(!n&&i.trailing!==!1){var l=function(){o=i.leading===!1?0:r(),n=null,e.apply(null,c),c=null};n=setTimeout(l,a)}}}function a(){var e={},t=o();if(t.length)for(var r=t.substring(1).replace(/&amp;/g,"&").split("&"),i=0,n=r;i<n.length;i++){var s=n[i],a=s.split("="),c=a[0],l=a[1];c&&l&&(c=c.trim(),l=l.trim(),c.length&&l.length&&(e[c]=decodeURIComponent(l.replace(/\+/g," "))))}return e}function c(e){return e&&"A"===e.nodeName}function l(e){return e&&e.getAttribute("data-trackingid")}function u(e){return e&&"BODY"===e.nodeName}function h(e){for(var t=e,r=0;r<6&&(!c(t)&&!l(t))&&!u(t);r++){var i=t.parentNode;if(!(i instanceof HTMLElement))break;t=i}return t}var _,d=(function(){var e=null,t="uxa.onedoesnotsimplyusesessionstorage";try{e=window.sessionStorage,e&&(e.setItem(t,t),e.removeItem(t))}catch(t){e=null}return e})(),p=(function(){var e=window;return e.hasOwnProperty("JSON")?e.JSON:null})();(function(e){function t(e){return"uxa."+e}function r(){return!!a}function i(e){if(!a||!c)return null;try{var r=a.getItem(t(e));return null===r?null:c.parse(r)}catch(e){return null}}function n(e,r){if(!a||!c)return null;try{return null===r?o(e):(a.setItem(t(e),c.stringify(r)),null)}catch(e){return null}}function o(e){return a?(a.removeItem(t(e)),null):null}function s(e){return a?(a.clear(),null):null}var a=d,c=p;e.isEnabled=r,e.get=i,e.set=n,e.remove=o,e.clear=s})(_=t.UXStorage||(t.UXStorage={}));var f={heartbeat:"heartbeat",linkClick:"link_click",linkNoSessionStorage:"link_no_session_storage",modalClose:"modal_close",modalOpen:"modal_open",pageView:"page_view",scroll:"scroll_event"},g=Object.keys(f).map(function(e){return f[e]}),m={linkClick:"clicked_link",trackingParams:"tracking_params"},v=(function(){function e(e,t,n,o){void 0===o&&(o={});var s=this;this.currentModalId=null,this.lastScrollOffset=0,this.scrollTimer=null,this.startHeartbeat=function(){for(var e=0,t=[2,5,10,15,30];e<t.length;e++){var r=t[e];setTimeout(s.logOnPage.bind(s,f.heartbeat),1e3*r)}for(var i=0,n=[1,2,4,9];i<n.length;i++){var r=n[i];setTimeout(s.logOnPage.bind(s,f.heartbeat),60*r*1e3)}},this.delayedInit=function(){s.saveTrackingParams(),s.logPageView(),s.logDelayedClickEvent(),s.setupListeners()},this.trackScrolling=function(){s.scrollTimer&&clearTimeout(s.scrollTimer),s.scrollTimer=setTimeout(s.onScroll,500)},this.onScroll=function(){var e=i();s.lastScrollOffset!==e&&(s.lastScrollOffset=e,s.logOnPage(f.scroll,{vertical_offset:e}))},this.handleLinkClick=function(e){var t=h(e.target);if(c(t)||l(t)){var r=t.getBoundingClientRect(),n=s.createEvent(f.linkClick,{left:Math.round(r.left),link_id:t.getAttribute("data-trackingid"),link_rank:s.getLinkRank(t),origin_href:t.getAttribute("href"),time_on_page:s.getTimeOnPage(),top:Math.round(r.top),vertical_offset:i(),tag_name:t.tagName.toLowerCase()});s.delayedLinkClickLogging&&c(t)?s.storeDelayedLinkClick(n):s.logEvent(n)}},this.handleLinkKeyboardEnter=function(e){13===e.keyCode&&s.handleLinkClick(e)},this.trackModalShow=function(){var e=document.querySelector(s.modalClass);e&&(e.offsetWidth>0||e.offsetHeight>0)&&(s.currentModalId=e.id,s.logModal(f.modalOpen,s.currentModalId))},this.trackModalHide=function(){s.currentModalId&&(s.logModal(f.modalClose,s.currentModalId),s.currentModalId=null)},this.requestId=e,this.orgReferrer=t,this.logger=n,void 0!==o.delayed_link_click_logging?this.delayedLinkClickLogging=o.delayed_link_click_logging:this.delayedLinkClickLogging=!0,void 0!==o.modal_class?this.modalClass=o.modal_class:this.modalClass=".ui-modal",this.initTime=r(),this.startHeartbeat(),setTimeout(this.delayedInit,200)}return e.resetStorage=function(){for(var e=0,t=Object.keys(m);e<t.length;e++){var r=t[e];_.remove(m[r])}},e.prototype.setupListeners=function(){window.addEventListener("scroll",s(this.trackScrolling,2e3,{leading:!0})),document.body.addEventListener("mousedown",this.handleLinkClick),document.body.addEventListener("keydown",this.handleLinkKeyboardEnter),document.addEventListener("modalOpened",this.trackModalShow),document.addEventListener("modalClosed",this.trackModalHide)},e.prototype.logPageView=function(){this.logEvent(this.createEvent(f.pageView))},e.prototype.logModal=function(e,t){var r={modal:t};this.logOnPage(e,r)},e.prototype.logDelayedClickEvent=function(){if(!_.isEnabled())return null;var e=_.get(m.linkClick);if(e)try{e.destination_url=n();var t={eventName:f.linkClick,extra:e};this.logEvent(t),_.remove(m.linkClick)}catch(e){}return null},e.prototype.logOnPage=function(e,t){void 0===t&&(t={}),t.vertical_offset=t.vertical_offset||i(),t.time_on_page=t.time_on_page||this.getTimeOnPage(),this.getTimeOnPage()<600&&this.logEvent(this.createEvent(e,t))},e.prototype.logEvent=function(e){try{if(g.indexOf(e.eventName)===-1)throw new Error("UXAnalytics.log: trying to log an invalid event ("+e.eventName+")");this.logger.log(e.eventName,e.extra)}catch(e){throw e}},e.prototype.createEvent=function(e,t){if(void 0===t&&(t={}),this.orgReferrer&&(t.org_referrer=this.orgReferrer),t.request_id=t.request_id||this.requestId,t.url=t.url||n(),t.uxa_v=2.2,this.trackingParams)for(var r=0,i=Object.keys(this.trackingParams);r<i.length;r++){var o=i[r],s=o.replace(/^_/,""),a=this.trackingParams[o];t["param_"+s]=a}return{eventName:e,extra:t}},e.prototype.storeDelayedLinkClick=function(e){if(!_.isEnabled())return this.logOnPage(f.linkNoSessionStorage),!1;try{_.set(m.linkClick,e.extra)}catch(e){return!1}return!0},e.prototype.saveTrackingParams=function(){var e=this.getTrackingParams();Object.keys(e).length?(_.set(m.trackingParams,e),this.trackingParams=e):this.trackingParams=null},e.prototype.getTrackingParams=function(){for(var e=_.get(m.trackingParams)||{},t=["gclid","oqa","trigger","_tk","_camp","_ad","_net","_kw","utm_source","utm_medium"],r=a(),i=0,n=t;i<n.length;i++){var o=n[i];r.hasOwnProperty(o)&&(e[o]=r[o])}return e},e.prototype.getTimeOnPage=function(){return Math.round((r()-this.initTime)/1e3)},e.prototype.getLinkRank=function(e){var t=e.getAttribute("href"),r=document.querySelectorAll('a[href="'+t+'"]');if(1===r.length)return 1;for(var i=0;i<r.length;i++)if(r[i]===e)return i+1;return-1},e})();t.UXAnalytics=v}),function(){define("modules/core/ordered_dictionary",[],function(){return(function(){function e(e,t){this.list=e,this.dict=t}return e.list=[],e.dict={},e.prototype.push=function(e,t){this.list.push(e),this.dict[e]=t},e.prototype.remove=function(e){this.list.removeItem(e),delete this.dict[e]},e.prototype.indexOfKey=function(e){return this.list.indexOf(e)},e.prototype.keyAtIndex=function(e){return this.list[e]},e.prototype.valueFromKey=function(e){return this.dict[e]},e.prototype.valueAtIndex=function(e){return this.dict[this.list[e]]},e.prototype.getValues=function(){var e;return function(){var t,r,i,n;for(i=this.list,n=[],t=0,r=i.length;t<r;t++)e=i[t],n.push(this.dict[e]);return n}.call(this)},e.prototype.length=function(){return this.list.length},e.prototype.insertAtIndex=function(e,t,r){return this.list.splice(e,0,t),this.dict[t]=r},e})()})}.call(this);
//# sourceMappingURL=pkg-maestro-ab.min.js-vflEQwyz9.map