(function(e,t,i){function n(e){function t(e,t,i){var r={chunks:"slice_blob",resize:"send_binary_string",jpgresize:"send_binary_string",pngresize:"send_binary_string",progress:"report_upload_progress",multi_selection:"select_multiple",max_file_size:"access_binary",dragdrop:"drag_and_drop",drop_element:"drag_and_drop",headers:"send_custom_headers",canSendBinary:"send_binary",triggerDialog:"summon_file_dialog"};r[e]?n[r[e]]=t:i||(n[e]=t)}var i=e.required_features,n={};return"string"==typeof i?a.each(i.split(/\s*,\s*/),function(e){t(e,!0)}):"object"==typeof i?a.each(i,function(e,i){t(i,e)}):i===!0&&(e.multipart||(n.send_binary_string=!0),e.chunk_size>0&&(n.slice_blob=!0),a.each(e,function(e,i){t(i,!!e,!0)})),n}var r=e.setTimeout,s={},a={VERSION:"2.0.0beta",STOPPED:1,STARTED:2,QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,FILE_DUPLICATE_ERROR:-602,IMAGE_FORMAT_ERROR:-700,IMAGE_MEMORY_ERROR:-701,IMAGE_DIMENSIONS_ERROR:-702,mimeTypes:t.mimes,ua:t.ua,typeOf:t.typeOf,extend:t.extend,guid:t.guid,each:t.each,getPos:t.getPos,getSize:t.getSize,xmlEncode:function(e){var t={"<":"lt",">":"gt","&":"amp",'"':"quot","'":"#39"};return e?(""+e).replace(/[<>&\"\']/g,function(e){return t[e]?"&"+t[e]+";":e}):e},toArray:t.toArray,inArray:t.inArray,addI18n:t.addI18n,translate:t.translate,isEmptyObj:t.isEmptyObj,hasClass:t.hasClass,addClass:t.addClass,removeClass:t.removeClass,getStyle:t.getStyle,addEvent:t.addEvent,removeEvent:t.removeEvent,removeAllEvents:t.removeAllEvents,cleanName:function(e){var t,i;for(i=[/[\300-\306]/g,"A",/[\340-\346]/g,"a",/\307/g,"C",/\347/g,"c",/[\310-\313]/g,"E",/[\350-\353]/g,"e",/[\314-\317]/g,"I",/[\354-\357]/g,"i",/\321/g,"N",/\361/g,"n",/[\322-\330]/g,"O",/[\362-\370]/g,"o",/[\331-\334]/g,"U",/[\371-\374]/g,"u"],t=0;t<i.length;t+=2)e=e.replace(i[t],i[t+1]);return e=e.replace(/\s+/g,"_"),e=e.replace(/[^a-z0-9_\-\.]+/gi,"")},buildUrl:function(e,t){var i="";return a.each(t,function(e,t){i+=(i?"&":"")+encodeURIComponent(t)+"="+encodeURIComponent(e)}),i&&(e+=(e.indexOf("?")>0?"&":"?")+i),e},formatSize:function(e){return void 0===e||/\D/.test(e)?a.translate("N/A"):e>1099511627776?Math.round(e/1099511627776,1)+" "+a.translate("tb"):e>1073741824?Math.round(e/1073741824,1)+" "+a.translate("gb"):e>1048576?Math.round(e/1048576,1)+" "+a.translate("mb"):e>1024?Math.round(e/1024,1)+" "+a.translate("kb"):e+" "+a.translate("b")},parseSize:t.parseSizeStr,predictRuntime:function(e,t){var i,n;return t&&(e.runtimes=t),i=new a.Uploader(e),n=i.runtime,i.destroy(),n},addFileFilter:function(e,t){s[e]=t}};a.addFileFilter("mime_types",(function(){function e(e){var t=[];return a.each(e,function(e){a.each(e.extensions.split(/,/),function(e){/^\s*\*\s*$/.test(e)?t.push("\\.*"):t.push("\\."+e.replace(new RegExp("["+"/^$.*+?|()[]{}\\".replace(/./g,"\\$&")+"]","g"),"\\$&"))})}),new RegExp("("+t.join("|")+")$","i")}var t,i;return function(n,r,s){i&&n==t||(i=e(n),t=[].slice.call(n)),i.test(r.name)?s(!0):(this.trigger("Error",{code:a.FILE_EXTENSION_ERROR,message:a.translate("File extension error."),file:r}),s(!1))}})()),a.addFileFilter("max_file_size",function(e,t,i){void 0!==t.size&&e&&t.size>e?(this.trigger("Error",{code:a.FILE_SIZE_ERROR,message:a.translate("File size error."),file:t}),i(!1)):i(!0)}),a.addFileFilter("prevent_duplicates",function(e,t,i){if(e)for(var n=this.files.length;n--;)if(t.name===this.files[n].name&&t.size===this.files[n].size)return this.trigger("Error",{code:a.FILE_DUPLICATE_ERROR,message:a.translate("Duplicate file error."),file:t}),void i(!1);i(!0)}),a.Uploader=function(e){function i(){var e,t,i=0;if(this.state==a.STARTED){for(t=0;t<m.length;t++)e||m[t].status!=a.QUEUED?i++:(e=m[t],this.trigger("BeforeUpload",e)&&(e.status=a.UPLOADING,this.trigger("UploadFile",e)));i==m.length&&(this.state!==a.STOPPED&&(this.state=a.STOPPED,this.trigger("StateChanged")),this.trigger("UploadComplete",m))}}function o(e){e.percent=e.size>0?Math.ceil(e.loaded/e.size*100):100,l()}function l(){var e,t;for(g.reset(),e=0;e<m.length;e++)t=m[e],void 0!==t.size?(g.size+=t.origSize,g.loaded+=t.loaded*t.origSize/t.size):g.size=void 0,t.status==a.DONE?g.uploaded++:t.status==a.FAILED?g.failed++:g.queued++;void 0===g.size?g.percent=m.length>0?Math.ceil(g.uploaded/m.length*100):0:(g.bytesPerSec=Math.ceil(g.loaded/((+new Date-f||1)/1e3)),g.percent=g.size>0?Math.ceil(g.loaded/g.size*100):0)}function u(){var i=this,n=0,r={accept:e.filters.mime_types,runtime_order:e.runtimes,required_caps:b,swf_url:e.flash_swf_url,xap_url:e.silverlight_xap_url};a.each(e.runtimes.split(/\s*,\s*/),function(t){e[t]&&(r[t]=e[t])}),t.inSeries([function(s){e.browse_button?(p=new t.FileInput(a.extend({},r,{name:e.file_data_name,multiple:e.multi_selection,container:e.container,browse_button:e.browse_button})),p.onready=function(){var e=t.Runtime.getInfo(this.ruid);t.extend(i.features,{chunks:e.can("slice_blob"),multipart:e.can("send_multipart"),multi_selection:e.can("select_multiple")}),n++,s()},p.onchange=function(){i.addFile(this.files)},p.bind("mouseenter mouseleave mousedown mouseup",function(i){if(!v){var n=t.get(e.browse_button);n&&(e.browse_button_hover&&("mouseenter"===i.type?t.addClass(n,e.browse_button_hover):"mouseleave"===i.type&&t.removeClass(n,e.browse_button_hover)),e.browse_button_active&&("mousedown"===i.type?t.addClass(n,e.browse_button_active):"mouseup"===i.type&&t.removeClass(n,e.browse_button_active)),n=null)}}),p.bind("mousedown",function(){i.trigger("Browse")}),p.bind("error runtimeerror",function(){p=null,s()}),p.init()):s()},function(s){e.drop_element?(h=new t.FileDrop(a.extend({},r,{drop_zone:e.drop_element})),h.onready=function(){var e=t.Runtime.getInfo(this.ruid);i.features.dragdrop=e.can("drag_and_drop"),n++,s()},h.ondrop=function(){i.trigger("DragAndDrop"),i.addFile(this.files)},h.bind("error runtimeerror",function(){h=null,s()}),h.init()):s()}],function(){"function"==typeof e.init?e.init(i):a.each(e.init,function(e,t){i.bind(t,e)}),n?i.trigger("PostInit"):i.trigger("Error",{code:a.INIT_ERROR,message:a.translate("Init error.")})})}function d(e,i){if(e.ruid){var n=t.Runtime.getInfo(e.ruid);if(n)return n.can(i)}return!1}function c(e,i,n){var r=new t.Image;try{r.onload=function(){r.downsize(i.width,i.height,i.crop,i.preserve_headers)},r.onresize=function(){n(this.getAsBlob(e.type,i.quality)),this.destroy()},r.onerror=function(){n(e)},r.load(e)}catch(t){n(e)}}var f,g,p,h,_,m=[],E={},b={},v=!1;g=new a.QueueProgress,e=a.extend({runtimes:t.Runtime.order,max_retries:0,multipart:!0,multi_selection:!0,file_data_name:"file",flash_swf_url:"js/Moxie.swf",silverlight_xap_url:"js/Moxie.xap",send_chunk_number:!0},e),e.resize&&(e.resize=a.extend({preserve_headers:!0,crop:!1},e.resize)),"array"===a.typeOf(e.filters)&&(e.filters={mime_types:e.filters}),e.filters=a.extend({mime_types:[],prevent_duplicates:!!e.prevent_duplicates,max_file_size:e.max_file_size},e.filters),e.filters.max_file_size=a.parseSize(e.filters.max_file_size)||0,e.chunk_size=a.parseSize(e.chunk_size)||0,e.required_features=b=n(a.extend({},e)),a.extend(this,{id:a.guid(),state:a.STOPPED,features:{},runtime:t.Runtime.thatCan(b,e.runtimes),files:m,settings:e,total:g,init:function(){var n=this;if(e.browse_button=t.get(e.browse_button),e.drop_element=t.get(e.drop_element),"function"==typeof e.preinit?e.preinit(n):a.each(e.preinit,function(e,t){n.bind(t,e)}),!e.browse_button||!e.url)return void this.trigger("Error",{code:a.INIT_ERROR,message:a.translate("Init error.")});n.bind("FilesAdded",function(e,t){[].push.apply(m,t),r(function(){n.trigger("QueueChanged"),n.refresh()},1)}),n.bind("CancelUpload",function(){_&&_.abort()}),e.unique_names&&n.bind("BeforeUpload",function(e,t){var i=t.name.match(/\.([^.]+)$/),n="part";i&&(n=i[1]),t.target_name=t.id+"."+n}),n.bind("UploadFile",function(i,n){function s(){507!==_.status&&p-- >0?r(o,1):(n.loaded=h,i.trigger("Error",{code:a.HTTP_ERROR,message:a.translate("HTTP Error."),file:n,response:_.responseText,status:_.status,responseHeaders:_.getAllResponseHeaders()}))}function o(){var d,c,m,E;n.status!=a.DONE&&n.status!=a.FAILED&&i.state!=a.STOPPED&&(m={name:n.target_name||n.name},g&&f.chunks&&l.size>g?(E=Math.min(g,l.size-h),d=l.slice(h,h+E)):(E=l.size,d=l),g&&f.chunks?e.send_chunk_number?(m.chunk=Math.ceil(h/g),m.chunks=Math.ceil(l.size/g)):(m.offset=h,m.total=l.size):(m.chunk=0,m.chunks=1),_=new t.XMLHttpRequest,_.withCredentials=!0,_.upload&&(_.upload.onprogress=function(e){n.loaded=Math.min(n.size,h+e.loaded),i.trigger("UploadProgress",n)}),_.onload=function(){if(_.status>=400)return void s();E<l.size?(d.destroy(),h+=E,n.loaded=Math.min(h,l.size),i.trigger("ChunkUploaded",n,{offset:n.loaded,total:l.size,response:_.responseText,status:_.status,responseHeaders:_.getAllResponseHeaders()}),"Android Browser"===t.Env.browser&&i.trigger("UploadProgress",n)):n.loaded=n.size,d=c=null,!h||h>=l.size?(n.size!=n.origSize&&(l.destroy(),l=null),i.trigger("UploadProgress",n),n.status=a.DONE,i.trigger("FileUploaded",n,{response:_.responseText,status:_.status,responseHeaders:_.getAllResponseHeaders()})):(p=e.max_retries,r(o,1))},_.onerror=function(){s()},_.onloadend=function(){this.destroy(),_=null},i.settings.multipart&&f.multipart?(m.name=n.target_name||n.name,_.open("post",u,!0),a.each(i.settings.headers,function(e,t){_.setRequestHeader(t,e)}),c=new t.FormData,a.each(a.extend(m,i.settings.multipart_params),function(e,t){c.append(t,e)}),c.append(i.settings.file_data_name,d),_.send(c,{runtime_order:i.settings.runtimes,required_caps:b,swf_url:i.settings.flash_swf_url,xap_url:i.settings.silverlight_xap_url})):(u=a.buildUrl(i.settings.url,a.extend(m,i.settings.multipart_params)),_.open("post",u,!0),_.setRequestHeader("Content-Type","application/octet-stream"),a.each(i.settings.headers,function(e,t){_.setRequestHeader(t,e)}),_.send(d,{runtime_order:i.settings.runtimes,required_caps:b,swf_url:i.settings.flash_swf_url,xap_url:i.settings.silverlight_xap_url})))}var l,u=i.settings.url,f=i.features,g=e.chunk_size,p=e.max_retries,h=0;n.loaded&&(h=n.loaded=g*Math.floor(n.loaded/g)),l=n.getSource(),!t.isEmptyObj(i.settings.resize)&&d(l,"send_binary_string")&&~t.inArray(l.type,["image/jpeg","image/png"])?c.call(this,l,i.settings.resize,function(e){l=e,n.size=e.size,o()}):o()}),n.bind("UploadProgress",function(e,t){o(t)}),n.bind("StateChanged",function(e){if(e.state==a.STARTED)f=+new Date;else if(e.state==a.STOPPED)for(var t=e.files.length-1;t>=0;t--)e.files[t].status==a.UPLOADING&&(e.files[t].status=a.QUEUED,l())}),n.bind("QueueChanged",l),n.bind("Error",function(e,t){t.file&&(t.file.status=a.FAILED,o(t.file),e.state==a.STARTED&&r(function(){i.call(n)},1))}),n.bind("FileUploaded",function(){l(),r(function(){i.call(n)},1)}),n.trigger("Init",{runtime:this.runtime}),u.call(this)},refresh:function(){p&&p.trigger("Refresh"),this.trigger("Refresh")},start:function(){this.state!=a.STARTED&&(this.state=a.STARTED,this.trigger("StateChanged"),i.call(this))},stop:function(){this.state!=a.STOPPED&&(this.state=a.STOPPED,this.trigger("StateChanged"),this.trigger("CancelUpload"))},disableBrowse:function(){v=void 0===arguments[0]||arguments[0],p&&p.disable(v),this.trigger("DisableBrowse",v)},getFile:function(e){var t;for(t=m.length-1;t>=0;t--)if(m[t].id===e)return m[t]},addFile:function(e,i){function n(){var e=h||p;return!!e&&e.getRuntime().uid}function o(e,i){var n=[];t.each(d.settings.filters,function(t,i){s[i]&&n.push(function(n){s[i].call(d,t,e,function(e){n(!e)})})}),t.inSeries(n,i)}function l(e){var n=t.typeOf(e);if(e instanceof t.File){if(!e.ruid&&!e.isDetached()){if(!u)return!1;e.ruid=u,e.connectRuntime(u)}l(new a.File(e))}else e instanceof t.Blob?(l(e.getSource()),e.destroy()):e instanceof a.File?(i&&(e.name=i),c.push(function(t){o(e,function(i){i||f.push(e),r(t,1)})})):t.inArray(n,["file","blob"])!==-1?l(new t.File(null,e)):"node"===n&&"filelist"===t.typeOf(e.files)?t.each(e.files,l):"array"===n&&(i=null,t.each(e,l))}var u,d=this,c=[],f=[];u=n(),l(e),c.length&&t.inSeries(c,function(){f.length&&d.trigger("FilesAdded",f)})},removeFile:function(e){for(var t="string"==typeof e?e:e.id,i=m.length-1;i>=0;i--)if(m[i].id===t)return this.splice(i,1)[0]},splice:function(e,t){var i=m.splice(void 0===e?0:e,void 0===t?m.length:t);return this.trigger("FilesRemoved",i),this.trigger("QueueChanged"),a.each(i,function(e){e.destroy()}),i},trigger:function(e){var t,i,n=E[e.toLowerCase()];if(n)for(i=Array.prototype.slice.call(arguments),i[0]=this,t=0;t<n.length;t++)if(n[t].func.apply(n[t].scope,i)===!1)return!1;return!0},hasEventListener:function(e){return!!E[e.toLowerCase()]},bind:function(e,t,i){var n;e=e.toLowerCase(),n=E[e]||[],n.push({func:t,scope:i||this}),E[e]=n},unbind:function(e){e=e.toLowerCase();var t,i=E[e],n=arguments[1];if(i){if(void 0!==n){for(t=i.length-1;t>=0;t--)if(i[t].func===n){i.splice(t,1);break}}else i=[];i.length||delete E[e]}},unbindAll:function(){var e=this;a.each(E,function(t,i){e.unbind(i)})},destroy:function(){this.stop(),a.each(m,function(e){e.destroy()}),m=[],p&&(p.destroy(),p=null),h&&(h.destroy(),h=null),b={},f=g=v=_=null,this.trigger("Destroy"),this.unbindAll(),E={}}})},a.File=(function(){function e(e){a.extend(this,{id:a.guid(),name:e.name||e.fileName,type:e.type||"",size:e.size||e.fileSize,origSize:e.size||e.fileSize,loaded:0,percent:0,status:a.QUEUED,lastModifiedDate:e.lastModifiedDate||(new Date).toLocaleString(),getNative:function(){var e=this.getSource().getSource();return t.inArray(t.typeOf(e),["blob","file"])!==-1?e:null},getSource:function(){return i[this.id]?i[this.id]:null},destroy:function(){var e=this.getSource();e&&(e.destroy(),delete i[this.id])}}),i[this.id]=e}var i={};return e})(),a.QueueProgress=function(){var e=this;e.size=0,e.loaded=0,e.uploaded=0,e.failed=0,e.queued=0,e.percent=0,e.bytesPerSec=0,e.reset=function(){e.size=e.loaded=e.uploaded=e.failed=e.queued=e.percent=e.bytesPerSec=0}},e.plupload=a})(window,mOxie);
//# sourceMappingURL=plupload_dev.min.js-vflQlaLFO.map