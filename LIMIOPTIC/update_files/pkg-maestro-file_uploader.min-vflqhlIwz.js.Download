(function(){var e=[].indexOf||function(e){for(var t=0,o=this.length;t<o;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/file_uploader/actions",["modules/core/i18n","modules/core/exception","modules/clean/flux/dispatcher","modules/clean/filepath","modules/clean/react/file_uploader/store","modules/clean/react/file_uploader/plu_wrapper"],function(t,o,a,r,s,n){var i,l,d,u,p,c,m,f,assert,h;return f=t._,assert=o.assert,h=r.file_extension,m=s.UploaderStore,p=s.UploaderActionTypes,l=s.FileStatus,d=s.FileUpload,u=s.UploadErrorType,i=["pages","key","app","numbers","band","photolibrary","rcproject","rtfd","graffle","logic","logicx","lpdf","sketch","screenflow","scriv","dvdproj","mindnode","cmproj","xcodeproj","imovielibrary","mpkg","imovieproject","1password","agilekeychain","fcpbundle","abbu","mindnode","theater","gameproj","aplibrary","itlp","lrdata","ydevice","bundle","framework","plugin","kext","pkg"],c=(function(){function t(){}return t.prototype.initPLU=function(t){if(!n.isInitialized)return this.sendNS=!1,n.init(t),n.onFilesAdded((function(t){return function(o){var r,s,n,l,d,c,m,_,g,E;for(s=(function(){var e,t,a;for(a=[],e=0,t=o.length;e<t;e++)n=o[e],null==n.size&&a.push(n);return a})(),o=(function(){var e,t,a;for(a=[],e=0,t=o.length;e<t;e++)n=o[e],null!=n.size&&a.push(n);return a})(),l=0,c=s.length;l<c;l++)r=s[l],a.dispatch({type:p.ADD_NEW_FAILED_FILE,data:{file:r,errorType:u.EMPTY_OR_FOLDER,errorMessage:f("This folder or empty file could not be uploaded because of browser limitations. Try zipping up the content before uploading it, or use the Dropbox desktop client to sync it.")}});for(_=function(t){var o;return o=h(t.name),e.call(i,o)>=0&&t.size%34===0},E=(function(){var e,t,a;for(a=[],e=0,t=o.length;e<t;e++)n=o[e],_(n)&&a.push(n);return a})(),o=(function(){var e,t,a;for(a=[],e=0,t=o.length;e<t;e++)n=o[e],_(n)||a.push(n);return a})(),d=0,m=E.length;d<m;d++)g=E[d],a.dispatch({type:p.ADD_NEW_FAILED_FILE,data:{file:g,errorType:u.PACKAGE_FILE,errorMessage:f("This file is a package file and can’t be uploaded directly. To upload a package file via the web, try zipping it first.")}});return s.length&&t.cancelUploads({files:s}),E.length&&t.cancelUploads({files:E}),a.dispatch({type:p.QUEUE_UPLOADS,data:{files:o}}),t._frobPLU()}})(this)),n.onUploadProgress(function(e){var t,o,r,s,i;if(!m.isUploadCancelled(e.uploadId))return s=e.percentUploaded,o=s*m.currentUpload().size/100,i=o+m.totalSizeOfCompletedUploads(),t=n.bytesPerSec(),r=m.fileList().count(function(e){var t;return(t=e.status)===l.PENDING||t===l.UPLOADING}),a.dispatch({type:p.SET_CURRENT_UPLOAD_PROGRESS,data:{percentComplete:s,numSecondsLeft:(m.totalSize()-i)/t+r}})}),n.onFileUploaded((function(e){return function(t,o){var r;if(!m.isUploadCancelled(t.uploadId))return r=JSON.parse(o.response),"error"in r?(n.removeFiles({files:[t]}),"ignored"===r.error?a.dispatch({type:p.UPLOAD_ERROR,data:{uploadId:t.uploadId,errorType:u.IGNORED,errorMessage:f("This file was skipped because it’s an internal system file.")}}):a.dispatch({type:p.UPLOAD_ERROR,data:{uploadId:t.uploadId,errorType:u.GENERIC}})):(assert("complete"===r.status),assert(r.total_size===t.size),assert(r.upload_id===t.uploadId),a.dispatch({type:p.COMPLETE_UPLOAD,data:{uploadId:t.uploadId}})),e._frobPLU()}})(this)),n.onError((function(e){return function(t,o,r){return m.fileList().has(t.uploadId)?a.dispatch({type:p.UPLOAD_ERROR,data:{uploadId:t.uploadId,errorType:o,errorMessage:r}}):a.dispatch({type:p.ADD_NEW_FAILED_FILE,data:{file:t,errorType:o,errorMessage:r}}),e._frobPLU()}})(this))},t.prototype.setPath=function(e){var t,o,r;if(o=e.path,t=null==(r=e.hasPermissionToUploadToFolder)||r,o!==m.path()||t!==m.hasPermissionToUploadToFolder())return a.dispatch({type:p.SET_PATH,data:{path:o,hasPermissionToUploadToFolder:t}})},t.prototype.setUser=function(e){var t;return t=e.user,a.dispatch({type:p.SET_USER,data:{user:t}})},t.prototype.setNumDraggingFiles=function(e){var t,o,r;return o=e.numDraggingFiles,t=null!=(r=e.isInternalTransfer)&&r,a.dispatch({type:p.SET_NUM_DRAGGING_FILES,data:{numDraggingFiles:o,isInternalTransfer:t}})},t.prototype.addFilesToPLU=function(e){var t;return t=e.files,n.addFiles({files:t}),this.setIsInlineStatusDismissed({isInlineStatusDismissed:!1})},t.prototype.addDirectoriesToPLU=function(t){var o,r,s,n,l,d,c,_,g,E,T,v;for(r=t.directoryEntries,o=m.path(),n=[],_=0,l=(function(e){return function(){var t;return(t=function(){var o,a,r;if(n.length>0)return r=n.pop(),a=r.entry,o=r.dest,a.file(function(a){return e.setPath({path:o}),e.addFilesToPLU({files:[a]}),t()})})()}})(this),g=function(e){var t,a;return _+=1,a=e.createReader(),(t=function(){return a.readEntries(function(a){var r,s,i,d;if(a.length>0){for(s=0,i=a.length;s<i;s++)d=a[s],d.isDirectory?g(d):(r=o+e.fullPath,r=r.split("//").join("/"),n.push({entry:d,dest:r}));return t()}if(_-=1,0===_)return l()})})()},T=[],d=0,c=r.length;d<c;d++)v=r[d],E=h(v.name),e.call(i,E)>=0?(s=new File({name:v.name,dest:o}),T.push(a.dispatch({type:p.ADD_NEW_FAILED_FILE,data:{file:s,errorType:u.PACKAGE_FILE,errorMessage:f('Due to browser limitations, OSX package files files cannot be uploaded using drag-and-drop. Please try using the "Upload…" dialog.')}}))):T.push(g(v));return T},t.prototype.setIsUploadModalOpen=function(e){var t;return t=e.isUploadModalOpen,a.dispatch({type:p.SET_IS_UPLOAD_MODAL_OPEN,data:{isUploadModalOpen:t}})},t.prototype.setIsInlineStatusDismissed=function(e){var t;return t=e.isInlineStatusDismissed,a.dispatch({type:p.SET_IS_INLINE_STATUS_DISMISSED,data:{isInlineStatusDismissed:t}})},t.prototype.setSendNS=function(e){return this.sendNS=e,n.setSendNS(e)},t.prototype.cancelUploads=function(e){var t;return t=e.files,n.removeFiles({files:t}),a.dispatch({type:p.CANCEL_UPLOADS,data:{files:t}}),this._frobPLU()},t.prototype.manuallySetInErrorState=function(e){var t,o,r;return r=e.file,o=e.errorType,t=e.errorMessage,n.removeFiles({files:[r]}),a.dispatch({type:p.UPLOAD_ERROR,data:{uploadId:r.uploadId,errorType:o,errorMessage:t}}),this._frobPLU()},t.prototype._startUpload=function(e){var t,o,r,s;return o=e.file,a.dispatch({type:p.START_UPLOAD,data:{file:o}}),s="url"===(r=h(o.name))||"webloc"===r||"website"===r?0:1,t={dest:o.dest,reported_total_size:o.size,uploadId:o.uploadId,_subject_uid:o.userId,offset:0,overwrite:s},this.sendNS&&(t.ns_id=o.ns_id,t.ns_path=o.ns_path),n.setAjaxParams(t),n.start(),!0},t.prototype._frobPLU=function(){var e;if(e=m.nextUpload(),null!=e&&null==m.currentUpload())return assert(e instanceof d),this._startUpload({file:e})},t})(),{UploaderDispatcher:a,UploaderActions:new c}})}).call(this),define("modules/clean/react/file_uploader/exp_oq_drag_drop_modal_v4",["require","exports","tslib","external/react","modules/clean/react/css","modules/core/i18n","modules/clean/react/modal","modules/clean/react_format","modules/clean/react_logger"],function(e,t,o,a,r,s,n,i,l){"use strict";var d=(function(e){function t(t){var o=e.call(this,"ExpOQDragDropModalComponentV4",t)||this;return o.handleCloseModal=o.handleCloseModal.bind(o),o}return o.__extends(t,e),t.prototype.render=function(){return a.createElement("div",{className:"drag-drop-oq"},a.createElement(n.Modal,{title:s._("Your Dropbox is full"),className:"drag-drop-oq--modal",buttonComponent:this.renderButtons(),width:480},a.createElement("div",{className:"drag-drop-oq--copy"},i.reactFormat(s._("In order to finish uploading %(filename)s, you need to add more storage to your Dropbox."),{filename:this.props.oqFilename}))))},t.prototype.renderButtons=function(){return a.createElement(n.ModalButtons,null,a.createElement("div",{className:"drag-drop-oq--buttons"},a.createElement(n.ModalButton,{onClick:this.handleCloseModal,className:"drag-drop-oq--button",importance:"tertiary"},s._("Cancel")),a.createElement("a",{href:"/pro/out-of-space?oqa=upl_dd",className:"drag-drop-oq--button c-btn c-btn--primary"},s._("Get more space"))))},t.prototype.handleCloseModal=function(){n.Modal.close()},t})(l.ReactLogger);t.ExpOQDragDropModalV4=r(d,["/static/css//browse/exp_oq_drag_drop_upsell_v4.css"])}),define("modules/clean/react/file_uploader/exp_oq_drag_drop_modal_v5",["require","exports","tslib","external/react","modules/clean/react/css","modules/clean/react/image","modules/core/i18n","modules/clean/react/modal","modules/clean/react_format","modules/clean/static_urls","modules/clean/react_logger"],function(e,t,o,a,r,s,n,i,l,d,u){"use strict";var p=(function(e){function t(t){return e.call(this,"ExpOQDragDropModalComponentV5",t)||this}return o.__extends(t,e),t.prototype.render=function(){return a.createElement("div",{className:"drag-drop-oq"},a.createElement(i.Modal,{style:"clean",className:"drag-drop-oq--modal",buttonComponent:this.renderButtons(),width:480},a.createElement("div",null,a.createElement(s,{src:d.static_url("/static/images/pro/overquota/overquota-folder-vflgFxxXj.png"),srcHiRes:d.static_url("/static/images/pro/overquota/overquota-folder@2x-vfloUmya6.png")})),a.createElement("div",{className:"drag-drop-oq--header"},n._("Your Dropbox is full")),a.createElement("div",{className:"drag-drop-oq--copy"},l.reactFormat(n._("In order to finish uploading %(filename)s, you need to add more storage to your Dropbox."),{filename:this.props.oqFilename}))))},t.prototype.renderButtons=function(){return a.createElement("div",{className:"drag-drop-oq--buttons"},a.createElement("a",{href:"/pro/out-of-space?oqa=upl_dd",className:"drag-drop-oq--button c-btn c-btn--primary"},n._("Get more space")))},t})(u.ReactLogger);t.ExpOQDragDropModalV5=r(p,["/static/css/browse/exp_oq_drag_drop_upsell_v5-vfliUOCI_.css"])}),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/react/file_uploader/plu_wrapper",["jquery","modules/core/exception","external/plupload_dev","external/react","external/underscore","modules/clean/static_urls","modules/core/cookies","modules/clean/react/browse/action_logger","modules/clean/react/browse/store","modules/clean/react/file_uploader/store","modules/clean/sharing/ui_util","modules/core/i18n"],function(t,o,a,r,s,n,i,l,d,u,p,c){var m,f,h,_,g,E,T,v,assert,U,b,y,I;return assert=o.assert,I=n.static_url,m=l.BrowseLogger,U=d.browseStore,E=u.UploaderStore,f=u.FileUpload,g=u.UploadErrorType,b=u.generateUploadId,h=p.GoldenGate,T=c._,y=window.plupload,v=function(e,t){var o,a;return null==t&&(t={}),o=s.extend({},t,e),new f({uploadId:o.uploadId,dest:o.dest,ns_id:o.ns_id,ns_path:o.ns_path,name:o.name,size:o.size,userId:o.userId,percentUploaded:null!=(a=o.percent)?a:0})},_=(function(){function o(){this.removeFiles=e(this.removeFiles,this),this.bytesPerSec=e(this.bytesPerSec,this),this.onError=e(this.onError,this),this.onFileUploaded=e(this.onFileUploaded,this),this.onUploadProgress=e(this.onUploadProgress,this),this.onFilesAdded=e(this.onFilesAdded,this),this.setBrowseButton=e(this.setBrowseButton,this),this.setAjaxParams=e(this.setAjaxParams,this),this.start=e(this.start,this),this.addFiles=e(this.addFiles,this),this.init=e(this.init,this),this.isInitialized=!1,this.sendNS=!1}return o.prototype.idToUploadIdMap={},o.prototype.PLU_CONTAINER_ID="flash-upload-container",o.prototype.setSendNS=function(e){return this.sendNS=e},o.prototype.init=function(e){var o,a;if(!this.isInitialized)return this.isInitialized=!0,this.$secretBrowseButton=t("<button>").addClass("secret-file-uploader-button").hide().appendTo(t("body")),this.$pluContainer=t("<div>").attr("id",this.PLU_CONTAINER_ID).css({position:"absolute",left:-2e3}).appendTo(t("body")),this.$currentExternalBrowseButton=t(),a="html5",e||(a=this._runtimes),o={url:"https://dl-web.dropbox.com/chunked_upload",file_data_name:"file",runtimes:a,multipart_params:{},multipart:!1,max_retries:2,browse_button:this.$secretBrowseButton[0],init:{ChunkUploaded:(function(e){return function(t,o,a){var r,s,n;return n=e.idToUploadIdMap[o.id],assert(JSON.parse(a.response).upload_id===n),s=E.fileList().get(n),r={dest:s.dest,reported_total_size:s.size,uploadId:n,_subject_uid:s.userId,offset:a.offset,overwrite:1},e.sendNS&&(r.ns_id=s.ns_id,r.ns_path=s.ns_path),e.setAjaxParams(r)}})(this)}},e||s.extend(o,{max_file_size:"50000mb",chunk_size:"8mb",flash_swf_url:I("/static/swf/Moxie-vflz978zN.swf"),container:this.PLU_CONTAINER_ID}),this.uploader=new y.Uploader(o),this.uploader.init()},o.prototype._runtimes=(function(){var e,t,o,a,r;a={"MSIE 8.0":"flash","MSIE 9.0":"flash"},o="html5";for(e in a)r=a[e],(null!=(t=navigator.userAgent)?t.indexOf(e):void 0)!==-1&&(o=r);return o})(),o.prototype.addFiles=function(e){var t;return t=e.files,this.isInitialized||this.init(),this.uploader.addFile(t)},o.prototype.start=function(){return this.isInitialized||this.init(),this.uploader.start()},o.prototype.setAjaxParams=function(e){var t,o,a,r,s,n,l,d;if(l=e.reported_total_size,o=e.dest,d=e.uploadId,s=e.offset,t=e._subject_uid,n=e.overwrite,a=e.ns_id,r=e.ns_path,this.isInitialized||this.init(),null==l||null==o||null==d||null==s||null==t||null==n)throw new Error("A required parameter to setAjaxParams was not given.");return this.uploader.settings.multipart_params={t:i.read("__Host-js_csrf"),reported_total_size:l,dest:o,upload_id:d,offset:s,_subject_uid:t,overwrite:n,ns_id:a,ns_path:r}},o.prototype.setBrowseButton=function(e){var o;return this.isInitialized||this.init(),"flash"===this.uploader.runtime?(this.$currentExternalBrowseButton=t(e),this.$currentExternalBrowseButton.length?(t("#"+this.PLU_CONTAINER_ID).show().css({"z-index":1e3,position:"absolute",top:this.$currentExternalBrowseButton.offset().top,left:this.$currentExternalBrowseButton.offset().left,width:this.$currentExternalBrowseButton.outerWidth(),height:this.$currentExternalBrowseButton.outerHeight()}),o=t("#"+this.PLU_CONTAINER_ID+" > .moxie-shim"),o[0].style.top="0px",o[0].style.left="0px",o[0].style.width="100%",o[0].style.height="100%"):t("#"+this.PLU_CONTAINER_ID).hide()):(this.$currentExternalBrowseButton.off("click.PLUBrowseButton"),this.$currentExternalBrowseButton=t(e),this.$currentExternalBrowseButton.on("click.PLUBrowseButton",(function(e){return function(){return e.$secretBrowseButton.click()}})(this)))},o.prototype.onFilesAdded=function(e){return this.isInitialized||this.init(),this.uploader.bind("FilesAdded",(function(t){return function(o,a){var r;return m.logUploadFile({uid:E.user().id,num_files:a.length,uploader_type:"enhanced",upload_method:"chooser"}),r=a.map(function(e){var o,a,r,s;return s=b(),t.idToUploadIdMap[e.id]=s,a=null,r=null,t.sendNS&&(o=t.getNsIdAndPath(E.path(),e.name),a=o[0],r=o[1]),v(e,{uploadId:s,dest:E.path(),userId:E.user().id,ns_id:a,ns_path:r})}),e(r)}})(this))},o.prototype.getNsIdAndPath=function(e,t){var o,a,r,s,n,i,l;return s=U.context().currentNSID,r=U.context().currentMountPoint,h.hasContentManagerCdmInTSD(E.user().id)?a=e:(i=e.split("/"),l="/"+i.slice(2).join("/"),a=l),o=a.replace(r,""),"/"===o&&(o=""),n=o+"/"+t,[s,n]},o.prototype.onUploadProgress=function(e){return this.isInitialized||this.init(),this.uploader.bind("UploadProgress",(function(t){return function(o,a){var r,s;return s=t.idToUploadIdMap[a.id],r=E.fileList().get(s),e(r.set("percentUploaded",a.percent))}})(this))},o.prototype.onFileUploaded=function(e){return this.isInitialized||this.init(),this.uploader.bind("FileUploaded",(function(t){return function(o,a,r){var s,n;return n=t.idToUploadIdMap[a.id],s=E.fileList().get(n),e(s,r)}})(this))},o.prototype.onError=function(e){return this.isInitialized||this.init(),this.uploader.bind("Error",(function(t){return function(o,a){var r,s,n,i,l,d,u;if(null==a.file)throw new Error("PLU error without an associated file.");return s=(function(){switch(a.code){case y.FILE_SIZE_ERROR:return g.FILE_SIZE_ERROR;case y.HTTP_ERROR:return 0===a.status?g.CONNECTION_ERROR:507===a.status?g.OVER_QUOTA_ERROR:g.HTTP_ERROR;default:return g.GENERIC}})(),r=(function(){switch(s){case g.OVER_QUOTA_ERROR:return T("This file can’t be uploaded because you are over your storage quota. If you believe this message to be in error, try refreshing the page.");case g.FILE_SIZE_ERROR:return T("This file is too large to upload using the Dropbox website. Please use the desktop client.");case g.HTTP_ERROR:return T("Something went wrong while uploading this file. There was a server error during the upload request. If the problem persists, please try the basic uploader.");case g.CONNECTION_ERROR:return T("Something went wrong while uploading this file. Check your connection to the internet and try again.");default:return T("Something went wrong while uploading this file. If the problem persists, please try the basic uploader.")}})(),u=t.idToUploadIdMap[a.file.id],E.fileList().has(u)?n=E.fileList().get(u):(l=null,d=null,t.sendNS&&(i=t.getNsIdAndPath(E.path(),a.file.name),l=i[0],d=i[1]),n=v(a.file,{uploadId:b(),dest:E.path(),ns_id:l,ns_path:d})),e(n,s,r)}})(this))},o.prototype.bytesPerSec=function(){var e;return this.isInitialized||this.init(),null!=(e=this.uploader.total)?e.bytesPerSec:void 0},o.prototype.removeFiles=function(e){var t,o,a,r,n;for(o=e.files,this.isInitialized||this.init(),a=0,r=o.length;a<r;a++)t=o[a],n=s.find(this.uploader.files,(function(e){return function(o){return e.idToUploadIdMap[o.id]===t.uploadId}})(this)),this.uploader.removeFile(n);return this.uploader.stop(),this.uploader.start()},o})(),new _})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,o=this.length;t<o;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/file_uploader/uploader",["jquery","external/immutable","external/classnames","external/react","external/react-dom","external/underscore","modules/clean/analytics","modules/clean/ajax","modules/clean/browse_interface","modules/clean/browse/browse_drag_utils","modules/clean/datetime","modules/clean/display_format","modules/clean/em_string","modules/clean/filepath","modules/clean/flux/store_mixin","modules/clean/react/button","modules/clean/react/browse/actions","modules/clean/react/browse/action_logger","modules/clean/react/browse/store","modules/clean/react/file_uploader/actions","modules/clean/react/file_uploader/constants","modules/clean/react/file_uploader/exp_oq_drag_drop_modal_v4","modules/clean/react/file_uploader/exp_oq_drag_drop_modal_v5","modules/clean/react/file_uploader/store","modules/clean/react/file_uploader/plu_wrapper","modules/clean/react/flag","modules/clean/react/image","modules/clean/react/modal","modules/clean/react_format","modules/clean/react/sprite","modules/clean/react/tooltip","modules/clean/react_logger","modules/clean/static_urls","modules/clean/viewer","modules/constants/python","modules/constants/payments","modules/core/browser","modules/core/cookies","modules/core/html","modules/core/i18n","modules/core/notify","modules/core/uri"],function(t,o,a,r,s,n,i,l,d,u,p,c,m,f,h,_,g,E,T,v,U,b,y,I,N,D,O,L,A,S,P,w,M,R,F,x,C,k,B,q,Q,V){var z,G,j,H,Y,W,$,Z,K,X,J,ee,te,oe,ae,re,se,ne,ie,le,de,ue,pe,ce,me,fe,he,_e,ge,Ee,Te,ve,Ue,be,ye;return re=i.TeamsWebActionsLogger,Ee=d.get_browse_root_name,fe=d.browse_uri_for_fq_path,_.button,Te=_.link_button,ce=g.browseActions,G=E.BrowseLogger,z=E.BrowseLogEventSources,me=T.browseStore,le=v.UploaderActions,K=U.INTERNAL_FILE_DATA_TRANSFER_TYPE,Y=U.FileStatus,ie=U.UploadErrorType,j=b.ExpOQDragDropModalV4,H=y.ExpOQDragDropModalV5,de=I.UploaderStore,W=I.FileUpload,J=L.Modal,ve=A.reactFormat,se=P.Tooltip,ne=P.TooltipPosition,oe=w.ReactLogger,be=M.static_url,ae=F.TRADEMARK_BUSINESS,ue=q._,ye=q.ungettext,he=r.createElement,Ue=r.DOM,Ue.div,Ue.a,Ue.form,_e=r.DOM,pe=function(e){var t,o,a,r,s,n,i;return null==e&&(e={}),n=e.user,a=e.path,o=null!=(r=e.maxLength)?r:1e3,i=R.get_viewer(),i.is_paired&&n.is_team&&(s=i.team_name),"/"===a?i.is_paired?n.is_team?ue(" upload to your %(team_name)s Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({team_name:s}):ue(" upload to your personal Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}):ue(" upload to your Dropbox"):(t=m.em_snippet(f.filename(a),o),i.is_paired?n.is_team?ue(" upload to the folder ‘%(folder)s’ in your %(team_name)s Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({folder:t,team_name:s}):ue(" upload to the folder ‘%(folder)s’ in your personal Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({folder:t}):ue(" upload to the folder ‘%(folder)s’",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({folder:t}))},te=r.createClass({displayName:"OutOfQuotaModal",mixins:[h(de)],propTypes:{expProDragDropOverquotaModal:r.PropTypes.string},_get_state_from_stores:function(){return{fileList:de.fileList()}},componentWillMount:function(){return oe.start(this.constructor.displayName)},componentDidMount:function(){return oe.end(this.constructor.displayName)},render:function(){var e,t,o;return t=this._outOfQuotaErrorFile(),e=(null!=t&&null!=(o=t.errorMessage)?o.length:void 0)>0?t.errorMessage:ue("Something went wrong while uploading this file. If the problem persists, please try the basic uploader."),_e.div({ref:"container"},he(J,{ref:"modal",title:ue("Your Dropbox is full"),showX:!0,className:"upload-overquota-modal--pro-variant",buttonComponent:this._renderButton()},_e.div({className:"upload-overquota-modal--pro-variant__content"},null!=t?_e.div({className:"filename-col"},he(S,{className:"file-image",group:"web",name:f.file_icon(t.name),alt:""}),_e.span({className:"filename"},m.em_snippet(t.name,this.FILENAME_SNIPPET_LENGTH)),null!=t.size?_e.span({className:"size"}," - ",c.format_bytes(t.size)):void 0,_e.span({className:"error-msg"},ue("Upload Error")),_e.span({className:"error-details error-status"},he(se,{position:ne.RIGHT,tooltip_contents:_e.div({},e),tooltip_classname:"upload-error-tooltip"},he(S,{className:"error-icon",group:"web",name:"information",alt:ue("More information")})))):void 0,_e.button({className:"upload-overquota-modal--pro-variant__add_more_files_button c-btn c-btn--secondary c-btn--disabled",disabled:!0},ue("Add more files")),_e.div({className:"upload-overquota-modal--pro-variant__out-of-space"},ue("You can’t upload files because you’re out of space.")))))},_renderButton:function(){var e;return e=x.BUY_URL,"V2"===this.props.expProDragDropOverquotaModal?e="/upgrade":"V3"===this.props.expProDragDropOverquotaModal&&(e="/pro/out-of-space"),_e.div({className:"upload-overquota-modal--pro-variant__button-container"},_e.div({className:"upgrade-text"},ue("In order to finish uploading, you need to get more space")),he(Te,{importance:"primary",className:"upgrade-button",href:V({path:e,query:{oqa:"upl_b"}})},ue("Upgrade for more space")))},_outOfQuotaErrorFile:function(){var e,t,o,a;if(this.state.fileList.last().errorType===ie.OVER_QUOTA_ERROR)return this.state.fileList.last();for(a=this.state.fileList.toArray(),t=0,o=a.length;t<o;t++)if(e=a[t],e.errorType===ie.OVER_QUOTA_ERROR)return e}}),ee={NONE:"NONE",BASIC_OVER_QUOTA:"BASIC_OVER_QUOTA",BASIC_NEAR_QUOTA:"BASIC_NEAR_QUOTA",LIMITED_TEAM_USER_OVER_QUOTA:"LIMITED_TEAM_USER_OVER_QUOTA",LIMITED_TEAM_TSD_OVER_QUOTA:"LIMITED_TEAM_TSD_OVER_QUOTA"},Z=r.createClass({displayName:"FileUploaderModal",mixins:[h(de)],DROPZONE_ID:"upload-modal-dropzone",propTypes:{dragAndDropEnabled:r.PropTypes.bool,shouldShowDestinationLink:r.PropTypes.bool,onModalDismissed:r.PropTypes.func,clickOutToClose:r.PropTypes.bool,sendNS:r.PropTypes.bool,isTeamOnboarding:r.PropTypes.bool,expProNearquotaModal:r.PropTypes.string,expProOqUploadModal:r.PropTypes.string,userQuotaUsageRatio:r.PropTypes.number,tsdQuotaUsageRatio:r.PropTypes.number,numTeamMembers:r.PropTypes.number,numTeamAdmins:r.PropTypes.number,teamAdminEmail:r.PropTypes.string,teamAdminFname:r.PropTypes.string,promptAdminToUpgradeEmailTemplateUrl:r.PropTypes.object},getDefaultProps:function(){return{dragAndDropEnabled:!0,shouldShowDestinationLink:!0,onModalDismissed:function(){},clickOutToClose:!0,sendNS:!1,isTeamOnboarding:!1,numTeamMembers:0,numTeamAdmins:0}},getInitialState:function(){return{usingBasicUploader:!1,basicUploaderFile:null,overQuotaStatus:ee.NONE}},_get_state_from_stores:function(){return{path:de.path(),ns_id:me.context().currentNSID,ns_path:me.context().currentNSPath,user:de.user(),fileList:de.fileList(),numDraggingFiles:de.numDraggingFiles(),currentUpload:de.currentUpload(),numSecondsLeft:de.numSecondsLeft(),hasPermissionToUploadToFolder:de.hasPermissionToUploadToFolder()}},componentWillMount:function(){return oe.start(this.constructor.displayName)},componentDidMount:function(){var e;return this._setBrowseButton(),t(window).on("resize.uploaderModal",(function(e){return function(){return e._setBrowseButton()}})(this)),oe.end(this.constructor.displayName),e=ee.NONE,0===this.state.user.paid&&("personal"===this.state.user.role?this.props.userQuotaUsageRatio>1?e=ee.BASIC_OVER_QUOTA:this.props.userQuotaUsageRatio>.9&&(e=ee.BASIC_NEAR_QUOTA):this.state.user.is_team&&R.get_viewer().team_is_limited&&(this.state.user.is_cdm_member&&!this.state.path.startsWith(this.state.user.cdm_tmf_path)?this.props.tsdQuotaUsageRatio>1&&(e=ee.LIMITED_TEAM_TSD_OVER_QUOTA):this.props.userQuotaUsageRatio>1&&(e=ee.LIMITED_TEAM_USER_OVER_QUOTA))),this.setState({overQuotaStatus:e})},componentDidUpdate:function(e,o){var a,r,n,i;if(this._setBrowseButton(),this.state.numDraggingFiles?this.state.usingBasicUploader?Q.error("You can‖t drag and drop upload right now."):(a=t(s.findDOMNode(this.refs.modal.refs.modalBox)).find("#"+this.DROPZONE_ID),a.length||t("#"+this.DROPZONE_ID).clone().prependTo(t(s.findDOMNode(this.refs.modal.refs.modalBox))).css({width:"100%",height:"100%",position:"absolute",opacity:0}).show().fadeTo(500,1)):t(s.findDOMNode(this.refs.modal)).find("#"+this.DROPZONE_ID).remove(),this.state.fileList.count()>o.fileList.count()&&(n=t(s.findDOMNode(this.refs.uploadFilesList)),r=null!=(i=n.find(".upload-file"))?i.eq(o.fileList.count()):void 0,r.length))return n.scrollTop(n.scrollTop()+r.position().top)},componentWillUnmount:function(){return N.setBrowseButton(null),t(window).off("resize.uploaderModal")},FILENAME_SNIPPET_LENGTH:15,DEST_SNIPPET_LENGTH:13,_renderToggleButton:function(){var e,t;return this.state.usingBasicUploader?(t=ue("Switch to the advanced file uploader"),e="enhanced-uploader-link"):(t=ue("Switch to the basic file uploader"),e="basic-uploader-link"),_e.button({onClick:(function(e){return function(t){return e.setState({usingBasicUploader:!e.state.usingBasicUploader})}})(this),className:a("button-as-link","button-as-link--inline",e),"aria-label":t})},_setBrowseButton:function(){var e;return e=s.findDOMNode(this.refs.pluFileChooseButton),N.setBrowseButton(e),t(e).focus()},_handleClose:function(){var e,t;t=this.state.fileList.find(function(e){var t;return(t=e.status)===Y.PENDING||t===Y.UPLOADING}),t||le.setIsInlineStatusDismissed({isInlineStatusDismissed:!0}),le.setIsUploadModalOpen({isUploadModalOpen:!1}),J.close(),"function"==typeof(e=this.props).onModalDismissed&&e.onModalDismissed()},_handleCancel:function(e){return le.cancelUploads({files:[e]})},_handleBasicChooseButtonMouseClick:function(e){if(null!=this.refs.fileInput)return t(s.findDOMNode(this.refs.fileInput)).click()},_handleBasicFileInputChange:function(e){var t,o,a,r,n,i;return G.logUploadFile({uid:this.state.user.id,num_files:1,num_dirs:0,uploader_type:"basic",upload_method:"chooser"}),a=s.findDOMNode(this.refs.fileInput),o=null!=(r=a.files)&&"function"==typeof r.item?r.item(0):void 0,i=a.value,null!=o?(n={name:o.name,size:o.size,userId:this.state.user.id,percentUploaded:100,status:Y.UPLOADING},this.props.sendNS?(n.ns_id=this.state.ns_id,n.ns_path=this.state.ns_path+"/"+o.name):n.dest=this.state.path,this.setState({basicUploaderFile:new W(n)},(function(e){return function(){return s.findDOMNode(e.refs.basicUploadForm).submit()}})(this))):null!=i?(t="C:\\fakepath\\",0===i.indexOf(t)?this.setState({basicUploaderFile:new W({name:i.slice(t.length),size:null,dest:this.state.path,userId:this.state.user.id,percentUploaded:100,status:Y.UPLOADING})},(function(e){return function(){return s.findDOMNode(e.refs.basicUploadForm).submit()}})(this)):s.findDOMNode(this.refs.basicUploadForm).submit()):void 0},_limitedTeamOverquotaLink:function(e){var t;return this.state.user.is_cdm_member&&!this.state.user.is_team_admin&&this.props.numTeamAdmins>0?this.props.promptAdminToUpgradeEmailTemplateUrl:(t=1===this.props.numTeamMembers?"/plans":"/team/upgrade",V({path:t,query:{_tk:"over_quota",_camp:"upload_modal",oqa:e?"upl":"upl_b"}}))},_renderIntroModalButtons:function(){var e,t,o,a,r,s,n,i,l,d;return t=_e.div({className:"u-font-medium"},this.state.overQuotaStatus===ee.BASIC_OVER_QUOTA?ve(ue("Before you can upload files, you need to <overQuotaLink>get more space</overQuotaLink>."),{overQuotaLink:_e.a({className:"overquota-uploader-link",href:"/upgrade?oqa=upl"})}):!this.state.user.is_cdm_member||(r=this.state.overQuotaStatus)!==ee.LIMITED_TEAM_USER_OVER_QUOTA&&r!==ee.LIMITED_TEAM_TSD_OVER_QUOTA?this.state.overQuotaStatus===ee.LIMITED_TEAM_USER_OVER_QUOTA?ve(ue("Before you can upload files, you need to <overQuotaLink>get more space</overQuotaLink>."),{overQuotaLink:_e.a({className:"overquota-uploader-link",href:this._limitedTeamOverquotaLink(!0)})}):null!=this.state.basicUploaderFile?ue("This may take a while depending on the size of the file."):this.state.usingBasicUploader?ve(ue("Uploading multiple files? Try our <enhancedUploaderLink>enhanced uploader</enhancedUploaderLink>."),{enhancedUploaderLink:this._renderToggleButton()}):ve(ue("Having problems? Try the <basicUploaderLink>basic uploader</basicUploaderLink>."),{basicUploaderLink:this._renderToggleButton()}):""),a=null,l=null,d=ue(this.state.user.is_cdm_member?this.state.user.is_team_admin||0===this.props.numTeamAdmins?"Get more space":"Ask for more space":"Upgrade to Upload"),this.state.overQuotaStatus===ee.BASIC_OVER_QUOTA?(o=x.BUY_URL+"?oqa=upl_b","V1"!==(s=this.props.expProOqUploadModal)&&"V3"!==s||(d=ue("Upgrade to Add")),a=_e.a({className:"dbmodal-button c-btn c-btn--primary",href:o},d)):(n=this.state.overQuotaStatus)===ee.LIMITED_TEAM_USER_OVER_QUOTA||n===ee.LIMITED_TEAM_TSD_OVER_QUOTA?a=_e.a({className:"dbmodal-button c-btn c-btn--primary",href:this._limitedTeamOverquotaLink(!1)},d):this.state.usingBasicUploader?null==this.state.basicUploaderFile&&(a=_e.button({className:"dbmodal-button c-btn c-btn--primary",onClick:this._handleBasicChooseButtonMouseClick},ue("Choose a file"))):a=_e.button({ref:"pluFileChooseButton",className:"dbmodal-button c-btn c-btn--primary"},ue("Choose files")),null==this.state.basicUploaderFile&&(l=_e.button({importance:"tertiary",className:"dbmodal-button c-btn c-btn--secondary u-mar-left-s",onClick:this._handleClose},ue("Cancel"))),this.state.overQuotaStatus===ee.BASIC_OVER_QUOTA||this.state.overQuotaStatus===ee.LIMITED_TEAM_USER_OVER_QUOTA&&!this.state.user.is_cdm_member?(e="c-banner c-banner--warning upload-overquota-banner__content","V2"!==(i=this.props.expProOqUploadModal)&&"V3"!==i||(e="c-banner c-banner--error"),_e.div({className:"u-mar-vertical-l clearfix"},_e.div({className:"u-l-fr"},a,l),_e.div({className:"upload-overquota-banner__container"},_e.div({id:"upload-overquota-banner",className:e},t)))):this.state.overQuotaStatus===ee.BASIC_NEAR_QUOTA&&"V1"===this.props.expProNearquotaModal?_e.div({className:"u-mar-top-l"},he(D.Flag,{spacing:"s",rightAttachment:_e.div({},a,l)},t),_e.div({className:"c-banner upload-nearquota-banner"},ve(ue("You’re almost out of space. To make sure you have enough storage for all your files, <overQuotaLink>upgrade now</overQuotaLink>."),{overQuotaLink:_e.a({className:"overquota-uploader-link",href:"/upgrade?oqa=upl"})}))):_e.div({className:"u-mar-top-l"},he(D.Flag,{spacing:"s",rightAttachment:_e.div({},a,l)},t))},_renderFileListModalButtons:function(){var e,t,o,a;return o=this.state.fileList.find(function(e){var t;return(t=e.status)===Y.PENDING||t===Y.UPLOADING}),t=o?"tertiary":"primary",a=_e.button({ref:"pluFileChooseButton",
className:"dbmodal-button c-btn c-btn--secondary"},ue("Add more files")),e=_e.button({className:"dbmodal-button c-btn c-btn--"+t,onClick:this._handleClose},ue(o?"Hide":"Done")),_e.div({className:"u-mar-top-s"},he(D.Flag,{leftAttachment:a,rightAttachment:e,spacing:"s"},_e.div({className:"u-font-small"},o?void 0:ve(ue("Having problems? Try the <basicUploaderLink>basic uploader</basicUploaderLink>."),{basicUploaderLink:this._renderToggleButton()}))),this.state.overQuotaStatus===ee.BASIC_NEAR_QUOTA&&"V1"===this.props.expProNearquotaModal?_e.div({className:"c-banner upload-nearquota-banner"},ve(ue("You’re almost out of space. To make sure you have enough storage for all your files, <overQuotaLink>upgrade now</overQuotaLink>."),{overQuotaLink:_e.a({className:"overquota-uploader-link",href:"/upgrade?oqa=upl"})})):void 0)},_renderIntroMessage:function(){var e,t,o,a,r;return r=pe({user:this.state.user,path:this.state.path}),a=R.get_viewer().team_name,_e.span({},!this.state.user.is_cdm_member||(t=this.state.overQuotaStatus)!==ee.LIMITED_TEAM_USER_OVER_QUOTA&&t!==ee.LIMITED_TEAM_TSD_OVER_QUOTA?(o=this.state.overQuotaStatus)===ee.BASIC_OVER_QUOTA||o===ee.LIMITED_TEAM_USER_OVER_QUOTA?ue("You can’t upload files because you’re out of space. Before you can upload to Dropbox, you need to get more space."):this.state.usingBasicUploader?ue("Choose a file to %(upload_folder_name)s. The basic uploader can only upload one file at a time.",{comment:'upload_folder_name contains a snippet such as " upload to your Dropbox"'}).format({upload_folder_name:r}):this.props.isTeamOnboarding?ue("Choose files to add to the %(team_name)s team folder. You can also drag and drop files onto this page to upload them. Anyone who joins the %(team_name)s Dropbox will have access to files in the team folder.").format({team_name:a}):this.props.dragAndDropEnabled?ue("Choose files to %(upload_folder_name)s. You can select more than one file at a time. You can also drag and drop files anywhere on this page to start uploading.",{comment:'upload_folder_name contains a snippet such as " upload to your Dropbox"'}).format({upload_folder_name:r}):ue("Choose files to %(upload_folder_name)s. You can select more than one file at a time.",{comment:'upload_folder_name contains a snippet such as " upload to your Dropbox"'}).format({upload_folder_name:r}):(e=this.state.overQuotaStatus===ee.LIMITED_TEAM_USER_OVER_QUOTA?ue("Your member folder is full, so no new files can be added"):ue("The %(team_name)s shared workspace is full, so no new files can be added").format({team_name:a}),this.state.user.is_team_admin||!this.props.numTeamAdmins?ve(ye("%(dropbox_full_message)s. To get more space, <upgradeLink>upgrade your account </upgradeLink>.","%(dropbox_full_message)s. To get more space, <upgradeLink>upgrade to %(trademark_business)s</upgradeLink>.",this.props.numTeamMembers),{dropbox_full_message:e,trademark_business:ae,upgradeLink:_e.a({href:this._limitedTeamOverquotaLink(!1)})}):ye("%(dropbox_full_message)s. To get more space, ask your Dropbox admin (%(admin_email)s).","%(dropbox_full_message)s. To get more space, ask your Dropbox admins (%(admin_email)s and %(num_other_admins)s others).",this.props.numTeamAdmins).format({dropbox_full_message:e,admin_email:this.props.teamAdminEmail,num_other_admins:this.props.numTeamAdmins-1})))},_renderDropzone:function(){return _e.div({ref:"dropzone",id:this.DROPZONE_ID,style:{display:"none"}},_e.div({},ye("Drop your file to %(upload_action)s","Drop your files to %(upload_action)s",this.state.numDraggingFiles,{comment:"upload_action is a phrase like 'upload to folder 'XYZ'"}).format({upload_action:pe({user:this.state.user,path:this.state.path,maxLength:20})})))},_renderFileListRowStatus:function(e){var t;return _e.div({className:"status-col"},e.status===Y.UPLOADING&&100===e.percentUploaded?he(O,{src:be("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),srcHiRes:be("/static/images/icons/ajax-loading-small@2x-vflAxdZTP.gif")}):(t=e.status)===Y.PENDING||t===Y.UPLOADING?_e.button({className:"button-as-link",onClick:(function(t){return function(o){return o.preventDefault(),t._handleCancel(e)}})(this)},he(S,{group:"web",name:"xclose",alt:ue("Cancel")})):e.status===Y.COMPLETE?he(S,{group:"web",name:"s_check",alt:ue("Upload successful")}):e.status===Y.CANCELLED?he(O,{src:be("/static/images/cancelsync-vflGFIEUK.png"),srcHiRes:be("/static/images/cancelsync@2x-vflzmHGI0.png"),alt:ue("Upload cancelled")}):e.status===Y.FAILED?he(O,{src:be("/static/images/nosync-vfl18cuTS.png"),srcHiRes:be("/static/images/nosync@2x-vflgS4F07.png"),alt:ue("Error")}):void 0)},_renderFileListRowError:function(e){var t,o;return t=(null!=(o=e.errorMessage)?o.length:void 0)>0?e.errorMessage:ue("Something went wrong while uploading this file. If the problem persists, please try the basic uploader."),_e.div({className:"error-col"},_e.span({className:"error-msg"},ue(e.errorType===ie.FILE_SIZE_ERROR?"File too large":"Upload Error")),_e.span({className:"error-details"},he(se,{position:ne.RIGHT,tooltip_contents:_e.div({},t),tooltip_classname:"upload-error-tooltip"},he(S,{group:"web",name:"information",alt:ue("More information")}))))},_renderFileListRowDest:function(e){var t,o;return _e.div({className:"dest-col"},e.status===Y.CANCELLED?ue("Canceled"):(o=R.get_viewer().get_user_by_id(e.userId),t=me.context().isNonUserRelativeContext?"":Ee(o),_e.a({href:fe(o,e.dest).toString()},m.em_snippet(""+t+e.dest,this.DEST_SNIPPET_LENGTH,0))))},_renderFileListRow:function(e,t){var o,r;return o=e.status===Y.UPLOADING?e.percentUploaded:e.status===Y.PENDING?0:100,r={"upload-file":!0,complete:e.status===Y.COMPLETE,cancelled:e.status===Y.CANCELLED,error:e.status===Y.FAILED},_e.li({className:a(r),key:e.uploadId},_e.div({className:"upload-progress-bar",style:{width:o+"%"}}),_e.div({className:"upload-file-info",style:{overflow:"hidden"}},_e.div({className:"filename-col"},he(S,{group:"web",name:f.file_icon(e.name),alt:""}),_e.span({className:"filename"},m.em_snippet(e.name,this.FILENAME_SNIPPET_LENGTH)),null!=e.size?_e.span({className:"size"}," - ",c.format_bytes(e.size)):void 0),e.status!==Y.FAILED?t?this._renderFileListRowDest(e):void 0:this._renderFileListRowError(e),this._renderFileListRowStatus(e)))},_renderFileList:function(e,t){var o,a,r;return r=null==(a=(null!=t?t:{}).shouldShowDestinationLink)||a,_e.ol({ref:"uploadFilesList",id:"upload-files-list",style:{margin:0,padding:0,maxHeight:228,overflowY:"auto",position:"relative"}},function(){var t,a,s;for(s=[],t=0,a=e.length;t<a;t++)o=e[t],s.push(this._renderFileListRow(o,r));return s}.call(this))},_renderTimeLeft:function(){var e;if(e=this.state.currentUpload,null!=e&&e.status===Y.UPLOADING)return _e.div({style:{marginTop:8,textAlign:"right"}},ue("%(time_left)s left").format({time_left:p.format_time(this.state.numSecondsLeft)}))},_renderBasicUploaderForm:function(){return _e.form({id:"basic-upload-form",ref:"basicUploadForm",encType:"multipart/form-data",noValidate:"novalidate",method:"post",action:"https://dl-web.dropbox.com/upload"},_e.input({type:"hidden",name:"t",value:k.read("__Host-js_csrf")}),_e.input({type:"hidden",name:"_subject_uid",value:this.state.user.id}),_e.input({type:"hidden",name:"plain",value:"yes"}),_e.input({type:"hidden",name:"dest",value:this.state.path}),this.props.sendNS?[_e.input({type:"hidden",name:"ns_id",value:this.state.ns_id}),_e.input({type:"hidden",name:"ns_path",value:this.state.ns_path})]:void 0,_e.input({type:"file",name:"file","aria-label":ue("Upload files"),tabIndex:"-1",style:{display:"none"},ref:"fileInput",onChange:this._handleBasicFileInputChange}))},render:function(){var e,t;return t=ue(this.props.isTeamOnboarding?"Which files would you like to add?":!this.state.user.is_cdm_member||(e=this.state.overQuotaStatus)!==ee.LIMITED_TEAM_USER_OVER_QUOTA&&e!==ee.LIMITED_TEAM_TSD_OVER_QUOTA?"Upload to Dropbox":"More space needed"),_e.div({ref:"container"},this._renderDropzone(),he(J,{ref:"modal",title:t,showX:!1,clickOutToClose:this.props.clickOutToClose,buttonComponent:0===this.state.fileList.count()||this.state.usingBasicUploader?this._renderIntroModalButtons():this._renderFileListModalButtons(),onDismiss:(function(e){return function(t){return null!=e.state.basicUploaderFile?void t.preventDefault():le.setIsUploadModalOpen({isUploadModalOpen:!1})}})(this)},this.state.usingBasicUploader?this._renderBasicUploaderForm():void 0,null!=this.state.basicUploaderFile?this._renderFileList([this.state.basicUploaderFile],{shouldShowDestinationLink:!1}):0===this.state.fileList.count()||this.state.usingBasicUploader?this._renderIntroMessage():this._renderFileList(this.state.fileList.toArray(),{shouldShowDestinationLink:this.props.shouldShowDestinationLink}),this._renderTimeLeft()))}}),X=r.createClass({displayName:"InlineUploadStatus",propTypes:{fileList:r.PropTypes.instanceOf(o.OrderedMap).isRequired,currentUpload:r.PropTypes.instanceOf(W),numSecondsLeft:r.PropTypes.number,onViewDetails:r.PropTypes.func,expProDragDropOverquotaModal:r.PropTypes.string},FILENAME_SNIPPET_LENGTH:30,_getOverallUploadState:function(){return this.props.fileList.find(function(e){var t;return(t=e.status)===Y.PENDING||t===Y.UPLOADING})?"uploading":this.props.fileList.find(function(e){return e.status===Y.FAILED})?"error":"complete"},_getProgressBarWidth:function(){var e;return e=this._getOverallUploadState(),"uploading"===e&&null!=this.props.currentUpload?this.props.currentUpload.percentUploaded:"complete"===e||"error"===e?100:0},_getNumPendingFiles:function(){return this.props.fileList.count(function(e){return e.status===Y.PENDING})},_getNumCompletedFiles:function(){return this.props.fileList.count(function(e){return e.status===Y.COMPLETE})},_getNumNoncancelledFiles:function(){return this.props.fileList.count(function(e){return e.status!==Y.CANCELLED})},_getNumErrors:function(){return this.props.fileList.count(function(e){return e.status===Y.FAILED})},_renderIcon:function(){var e;return e=this._getOverallUploadState(),"uploading"===e?he(S,{group:"web",name:"s_sync",alt:ue("Uploading")}):"complete"===e?he(S,{group:"web",name:"s_check",alt:ue("Upload successful")}):he(O,{src:be("/static/images/nosync-vfl18cuTS.png"),srcHiRes:be("/static/images/nosync@2x-vflgS4F07.png"),alt:ue("Error")})},_renderCloseButton:function(){return _e.button({className:"button-as-link",onClick:function(e){return e.preventDefault(),le.setIsInlineStatusDismissed({isInlineStatusDismissed:!0})}},he(S,{group:"web",name:"xclose",alt:ue("Close")}))},_renderViewDetailsLink:function(){var e,t;return e=this._getNumPendingFiles(),"V1"===(t=this.props.expProDragDropOverquotaModal)||"V2"===t||"V3"===t||"V4"===t||"V5"===t?e>0?_e.span({className:"details"},ye(" - %(num_pending_files)d file left"," - %(num_pending_files)d files left",e).format({num_pending_files:e})):void 0:_e.span({className:"details"}," - ",_e.button({className:"view-details button-as-link",onClick:(function(e){return function(t){var o;return t.preventDefault(),"function"==typeof(o=e.props).onViewDetails?o.onViewDetails():void 0}})(this)},e>0?ye("%(num_pending_files)d file left","%(num_pending_files)d files left",e).format({num_pending_files:e}):ue("View details")))},_renderFileDescription:function(){var e,t,o,a;return a=this._getOverallUploadState(),o=this._getNumNoncancelledFiles(),t=this._getNumErrors(),_e.span({className:"file-desc"},null!=this.props.currentUpload?ue("Uploading %(filename)s").format({filename:m.em_snippet(this.props.currentUpload.name,this.FILENAME_SNIPPET_LENGTH)}):"uploading"===a?ue("Starting upload..."):"complete"===a?o>1?ue("Uploaded %(num_files)d files").format({num_files:o}):ue("Uploaded %(filename)s").format({filename:m.em_snippet(this.props.fileList.last().name,this.FILENAME_SNIPPET_LENGTH)}):"error"===a?o>1?[ue("Uploaded %(num_completed)d of %(num_files)d files").format({num_completed:this._getNumCompletedFiles(),num_files:o})," ",_e.span({className:"num-errors"},ye("- %d error","- %d errors",t).format(t))]:(e=this.props.fileList.last().errorType,e===ie.GENERIC?ue("Unable to upload %(filename)s").format({filename:m.em_snippet(this.props.fileList.last().name,this.FILENAME_SNIPPET_LENGTH)}):ue("Unable to upload %(filename)s: %(reason)s").format({filename:m.em_snippet(this.props.fileList.last().name,this.FILENAME_SNIPPET_LENGTH),reason:(function(){switch(e){case ie.OVER_QUOTA_ERROR:return ue("over quota");case ie.FILE_SIZE_ERROR:return ue("file too large");case ie.CONNECTION_ERROR:return ue("lost connection");case ie.HTTP_ERROR:return ue("server error");case ie.EMPTY_OR_FOLDER:return ue("can’t upload folders or empty files");case ie.PACKAGE_FILE:return ue("OSX package file")}})()})):void 0)},render:function(){var e,t;return e=this._getOverallUploadState(),t={"upload-file":!0,error:"error"===e,complete:"complete"===e},_e.div({id:"inline-upload-status",className:a(t)},_e.div({className:"inline-upload-info"},_e.div({className:"icon"},this._renderIcon()),_e.div({className:"files-info"},this._renderFileDescription(),_e.span({className:"num-errors"}),this._renderViewDetailsLink()),_e.div({className:"status"},"uploading"===e&&null!=this.props.numSecondsLeft?ue("%(time_left)s left").format({time_left:p.format_time(this.props.numSecondsLeft)}):this._renderCloseButton())),_e.div({className:"inline-upload-bar"},_e.div({className:"inline-upload-progress",style:{width:this._getProgressBarWidth()+"%"}})))}}),ge=null,$=r.createClass({displayName:"FileUploader",mixins:[h(de)],propTypes:{dragAndDropEnabled:r.PropTypes.bool,shouldShowDestinationLink:r.PropTypes.bool,onFileUploadComplete:r.PropTypes.func,onAllFileUploadsComplete:r.PropTypes.func,onModalDismissed:r.PropTypes.func,clickOutToClose:r.PropTypes.bool,sendNS:r.PropTypes.bool,expProDragDropOverquotaModal:r.PropTypes.string,loadNewUploader:r.PropTypes.bool},statics:{showModal:function(){return ge?ge.showModal():void console.warn("Tried to show the file upload modal, but no FileUploader component has been instantiated on the page yet.")},showOOQVariantModal:function(){return ge?ge.showOOQVariantModal():void console.warn("Tried to show the out of quota modal, but no FileUploader component has been instantiated on the page yet.")},showModalWithTeamOnboarding:function(){if(ge)return ge.setState({isTeamOnboarding:!0},ge.showModal)}},getDefaultProps:function(){return{dragAndDropEnabled:!0,shouldShowDestinationLink:!0,onFileUploadComplete:function(){},onAllFileUploadsComplete:function(){},onModalDismissed:function(){},clickOutToClose:!0,sendNS:!1,loadNewUploader:!1}},getInitialState:function(){return{isTeamOnboarding:!1,hasOverquotaError:!1,userQuotaUsageRatio:0,tsdQuotaUsageRatio:0,numTeamMembers:0,numTeamAdmins:0,teamAdminEmail:"",teamAdminFname:"",promptAdminToUpgradeEmailTemplateUrl:""}},_get_state_from_stores:function(){return{path:de.path(),ns_id:me.context().currentNSID,ns_path:me.context().currentNSPath,user:de.user(),fileList:de.fileList(),numDraggingFiles:de.numDraggingFiles(),isInternalTransfer:de.isInternalTransfer(),currentUpload:de.currentUpload(),isUploadModalOpen:de.isUploadModalOpen(),numSecondsLeft:de.numSecondsLeft(),isInlineStatusDismissed:de.isInlineStatusDismissed(),hasPermissionToUploadToFolder:de.hasPermissionToUploadToFolder()}},INLINE_STATUS_CONTAINER_CLASS:"inline-upload-status-container",showModal:function(){return J.showInstance(he(Z,{dragAndDropEnabled:this.props.dragAndDropEnabled,shouldShowDestinationLink:this.props.shouldShowDestinationLink,onModalDismissed:this.props.onModalDismissed,clickOutToClose:this.props.clickOutToClose,isTeamOnboarding:this.state.isTeamOnboarding,sendNS:this.props.sendNS,expProNearquotaModal:this.props.expProNearquotaModal,expProOqUploadModal:this.props.expProOqUploadModal,userQuotaUsageRatio:this.state.userQuotaUsageRatio,tsdQuotaUsageRatio:this.state.tsdQuotaUsageRatio,numTeamMembers:this.state.numTeamMembers,numTeamAdmins:this.state.numTeamAdmins,teamAdminEmail:this.state.teamAdminEmail,teamAdminFname:this.state.teamAdminFname,promptAdminToUpgradeEmailTemplateUrl:this.state.promptAdminToUpgradeEmailTemplateUrl})),le.setIsUploadModalOpen({isUploadModalOpen:!0})},showOOQVariantModal:function(){var e,t,o,a,r;if("V1"===(o=this.props.expProDragDropOverquotaModal)||"V2"===o||"V3"===o)return J.showInstance(he(te,{expProDragDropOverquotaModal:this.props.expProDragDropOverquotaModal}));if("V4"===(a=this.props.expProDragDropOverquotaModal)||"V5"===a){if(e=this.state.fileList.toArray().filter(function(e){return e.errorType===ie.OVER_QUOTA_ERROR||e.errorType===ie.GENERIC}),t=(null!=e&&null!=(r=e[e.length-1])?r.name:void 0)||ue("this file"),"V4"===this.props.expProDragDropOverquotaModal)return J.showInstance(he(j,{oqFilename:t}));if("V5"===this.props.expProDragDropOverquotaModal)return J.showInstance(he(H,{oqFilename:t}))}},componentWillMount:function(){if(oe.start(this.constructor.displayName),ge)throw new Error("Only one FileUploader component may be rendered to the page at any time. You have tried to instantiate multiple uploaders.");return ge=this},componentDidMount:function(){var o;return le.initPLU(this.props.loadNewUploader),le.setSendNS(this.props.sendNS),this.dragEnterCount=0,this.lastEnteredElement=null,o=t(document),o.on("dragover.fileUploader",function(e){return e.preventDefault(),e.stopPropagation()}).on("dragenter.fileUploader",(function(t){return function(o){var a,r,s,i;if(o.preventDefault(),o.stopPropagation(),o.target!==t.lastEnteredElement)return t.lastEnteredElement=o.target,t.dragEnterCount+=1,s=(function(){var e;try{return null!=(e=o.originalEvent.dataTransfer.mozItemCount)?e:Object.keys(o.originalEvent.dataTransfer.items).length}catch(e){return 1}})(),i=o.originalEvent.dataTransfer.types,a=["Files","application/x-moz-file",K,"text/x-moz-url","text/uri-list","Url"],null!=i&&(null!=i.indexOf&&n.intersection(i,a).length>0||i instanceof DOMStringList&&(i.contains("Files")||i.contains("text/x-moz-url")||i.contains(K)||C.msie&&(i.contains("Text")||i.contains("text/plain"))))?(r=e.call(i,K)>=0||e.call(i,"text/plain")>=0||i instanceof DOMStringList&&(i.contains("Text")||i.contains("text/plain")),le.setNumDraggingFiles({numDraggingFiles:s,isInternalTransfer:r})):void 0}})(this)).on("dragleave.fileUploader",(function(e){return function(t){if(t.preventDefault(),t.stopPropagation(),e.lastEnteredElement=null,e.dragEnterCount-=1,e.dragEnterCount<1)return e.dragEnterCount=0,le.setNumDraggingFiles({numDraggingFiles:0})}})(this)).on("drop.fileUploader",this._handleFileDrop),t("<div>").addClass(this.INLINE_STATUS_CONTAINER_CLASS).prependTo(t("#page-content")),t(window).on("beforeunload.fileUploader",(function(e){return function(t){var o,a;return o=null!=e.state.fileList.find(function(e){var t;return(t=e.status)===Y.PENDING||t===Y.UPLOADING}),o&&e.state.fileList.count()>0?(a=ue("Leaving this page will cancel your uploads."),t.returnValue=a,a):void 0}})(this)),this.state.user&&this.fetchQuotaUpsellInfo(),oe.end(this.constructor.displayName)},updateInlineStatus:function(){var e,o,a,r;return r=null!=this.state.fileList.find(function(e){var t;return(t=e.status)===Y.PENDING||t===Y.UPLOADING}),a=!this.state.isUploadModalOpen&&(r||this.state.fileList.count()>0&&!r&&!this.state.isInlineStatusDismissed),e=t("."+this.INLINE_STATUS_CONTAINER_CLASS),a?s.render(he(X,{fileList:this.state.fileList,currentUpload:this.state.currentUpload,onViewDetails:this._handleInlineStatusViewDetails,numSecondsLeft:this.state.numSecondsLeft,expProDragDropOverquotaModal:this.props.expProDragDropOverquotaModal}),e[0]):(o=e[0])?s.unmountComponentAtNode(o):void 0},componentWillReceiveProps:function(e){var t;if(("V1"===(t=this.props.expProDragDropOverquotaModal)||"V2"===t||"V3"===t||"V4"===t||"V5"===t)&&this.showOverquotaError())return this.setState({hasOverquotaError:!0,isInlineStatusDismissed:!0})},componentWillUpdate:function(e,t){var o,a,r,s;if(null==t.currentUpload&&null!=this.state.currentUpload&&("function"==typeof(o=this.props).onFileUploadComplete&&o.onFileUploadComplete(this.state.currentUpload),this.state.isTeamOnboarding&&re.log("uploaded_file")),t.fileList!==this.state.fileList&&(r=null!=t.fileList.find(function(e){var t;return(t=e.status)===Y.PENDING||t===Y.UPLOADING}),!r&&t.fileList.count()>0&&"function"==typeof(a=this.props).onAllFileUploadsComplete&&a.onAllFileUploadsComplete(this.state.fileList)),("V1"===(s=this.props.expProDragDropOverquotaModal)||"V2"===s||"V3"===s||"V4"===s||"V5"===s)&&!this.state.hasOverquotaError&&t.hasOverquotaError)return this.showOOQVariantModal()},componentDidUpdate:function(e,o){var a,r;if(a=t(".external-drop-indicator"),this.state.numDraggingFiles&&!this.state.isInternalTransfer?(o.numDraggingFiles||a.css("opacity",0).fadeTo(500,.6),this.state.hasPermissionToUploadToFolder?a.removeClass("external-drop-indicator--uploads-disabled"):a.addClass("external-drop-indicator--uploads-disabled"),this.state.isUploadModalOpen||(this.state.hasPermissionToUploadToFolder?(r=ue("Drop your files to %(upload_action)s",{comment:"upload_action is a phrase like 'upload to folder 'XYZ'"}).format({upload_action:pe({user:this.state.user,path:this.state.path})}),Q.success(r,60)):Q.error(ue("You don’t have permission to add to this folder.")))):!this.state.numDraggingFiles&&o.numDraggingFiles&&(a.hide().removeClass("external-drop-indicator--uploads-disabled"),Q.clear()),this.updateInlineStatus(),!o.user&&this.state.user)return this.fetchQuotaUpsellInfo()},fetchQuotaUpsellInfo:function(){return l.SilentBackgroundRequest({url:"/get_info_for_quota_upsell",data:{_subject_uid:this.state.user.id},success:(function(e){return function(t){return t=JSON.parse(t),e.setState({userQuotaUsageRatio:t.user_quota_usage_ratio,tsdQuotaUsageRatio:t.tsd_quota_usage_ratio,promptAdminToUpgradeEmailTemplateUrl:t.prompt_admin_to_upgrade_email_template_url,numTeamMembers:t.num_team_members,numTeamAdmins:t.num_team_admins,teamAdminEmail:t.team_admin_email,teamAdminFname:t.team_admin_fname})}})(this)})},componentWillUnmount:function(){return t(document).off("dragover.fileUploader").off("dragenter.fileUploader").off("dragleave.fileUploader").off("drop.fileUploader"),t("."+this.INLINE_STATUS_CONTAINER_CLASS).remove(),t(window).off("beforeunload.fileUploader"),ge=null},_handleFileDrop:function(e){var t,o,a,r,s,n,i,l,d,p,c,m,f,h,_,g,E,T,v,U,b,y,I,N,D,O,L,A;if(e.preventDefault(),e.stopPropagation(),this.dragEnterCount=0,this.lastEnteredElement=null,le.setNumDraggingFiles({numDraggingFiles:0}),t=e.originalEvent.dataTransfer,o=C.msie?"text":"application/x-dropbox-file-list",_=t.getData(o),null!=_)try{if(D=JSON.parse(_),A=D.userId,f=D.fromPath,p=D.filePaths,(null!=p?p.length:void 0)>0&&null!=f&&null!=A){if(me.context().isNonUserRelativeContext)return;return this.state.hasPermissionToUploadToFolder?A!==this.state.user.id?void Q.error(ue("You can’t move or copy files here from another Dropbox.")):(L=e.ctrlKey||e.altKey,L?ce.copyFiles({files:p.map(function(e){return{fq_path:e}}),newPath:this.state.path}):f!==this.state.path&&(G.logMoveFiles({uid:A,path:f,files:p,newPath:this.state.path,source:z.DRAG}),ce.moveFiles({path:f,files:p.map(function(e){return{fq_path:e}}),newPath:this.state.path})),void le.setPath({path:me.path()})):void Q.error(ue("You don’t have permission to add to this folder."))}}catch(e){}if(this.state.hasPermissionToUploadToFolder){if(r=u.getDraggedLink(t),null!=r)return N=u.buildUrlLinkfileContents(r),I=new Blob([N],{type:"text/plain"}),y=V.parse(r).getAuthority(),I.name=y+".url",I.overwrite=!1,G.logUploadFile({uid:this.state.user.id,num_files:1,num_dirs:0,uploader_type:"drag",upload_method:"drag"}),void le.addFilesToPLU({files:[I]});if(E=t.items,c=t.files,C.chrome&&null!=(null!=E&&null!=(O=E[0])?O.webkitGetAsEntry:void 0)){for(n=(function(){var e,t,o;for(o=[],h=e=0,t=E.length;0<=t?e<t:e>t;h=0<=t?++e:--e)o.push(E[h].webkitGetAsEntry());return o})(),l=(function(){var e,t,o;for(o=[],e=0,t=n.length;e<t;e++)s=n[e],(null!=s?s.isFile:void 0)&&o.push(s);return o})(),a=(function(){var e,t,o;for(o=[],e=0,t=n.length;e<t;e++)s=n[e],(null!=s?s.isDirectory:void 0)&&o.push(s);return o})(),G.logUploadFile({uid:this.state.user.id,num_files:l.length,num_dirs:a.length,uploader_type:"drag",upload_method:"drag"}),T=0,U=l.length;T<U;T++)d=l[T],d.file(function(e){return le.addFilesToPLU({files:[e]})});if(a.length>0)return le.addDirectoriesToPLU({directoryEntries:a})}else if(null!=(null!=c?c.length:void 0)){for(g=function(e){return null!=e&&null!=e.type&&null!=e.size&&""===e.type&&e.size%4096===0},c=(function(){var e,t,o;for(o=[],h=e=0,t=c.length;0<=t?e<t:e>t;h=0<=t?++e:--e)o.push(c.item(h));return o})(),m=(function(e){return function(){var t;if(g(i))return t=new FileReader,t.onerror=function(){var t,o;if(t=null!=(o=e.state.fileList.find(function(e){var t;return((t=e.status)===Y.PENDING||t===Y.UPLOADING)&&e.name===i.name}))?o.toJS():void 0,null!=t)return le.manuallySetInErrorState({file:t,errorType:ie.EMPTY_OR_FOLDER,errorMessage:ue("This folder or empty file could not be uploaded because of browser limitations. Try zipping up the content before uploading it, or use the Dropbox desktop client to sync it.")})},t.readAsArrayBuffer(i)}})(this),v=0,b=c.length;v<b;v++)i=c[v],m();return G.logUploadFile({uid:this.state.user.id,num_files:c.length,num_dirs:0,uploader_type:"drag",upload_method:"drag"}),le.addFilesToPLU({files:c})}}},_handleInlineStatusViewDetails:function(){return this.showModal()},showOverquotaError:function(){var e,t;return(null!=(e=this.state.fileList)&&null!=(t=e.last())?t.errorType:void 0)===ie.OVER_QUOTA_ERROR},render:function(){return _e.div({})}}),{FileUploader:$}})}.call(this);
//# sourceMappingURL=pkg-maestro-file_uploader.min.js-vflYTlNzI.map